<md-content class="md-padding" layout="row" layout-wrap layout-align="center start">
    <div flex-gt-md="75" flex-gt-lg="50" flex="grow" layout="column">
        <md-card class="profile-card md-whiteframe-z3">
            <md-card-title>
                <md-card-title-text>
                    <span class="md-headline">Editar perfil</span>
                </md-card-title-text>
            </md-card-title>
            <md-card-content class="without-padding">
                <md-tabs class="md-info" md-border-bottom="true" md-stretch-tabs="auto" md-swipe-content="true"
                md-enable-disconnect="true" md-selected="selectedProfileTab" md-align-tabs="top"
                md-dynamic-height md-border-bottom>
                    <md-tab label="Datos personales" md-on-select="loadPersonalData()">
                        <form name="form" role="form" ng-submit="save()">
                            <div layout="column" layout-wrap layout-gt-sm="row">
                                <md-content flex="nogrow" class="md-padding">
                                    <md-input-container class="md-has-no-icon-left">
                                        <h4><md-icon class="material-icons">panorama</md-icon> * Foto principal</h4>
                                        <input type="hidden" ng-required="true" name="avatar" ng-model="user.avatar.id" aria-label="Foto principal">
                                    </md-input-container>
                                    <div layout="row" layout-align="center center">
                                        <md-button class="img-container" ng-click="selectAvatar($event)">
                                            <md-tooltip>Haz click en la imagen para elegir otra</md-tooltip>
                                            <img src="{{ user | userImage:user }}"  id="image-main" class="image-avatar" />
                                        </md-button>
                                    </div>
                                </md-content>
                                <md-content flex class="md-padding">
                                    <div class="md-block without-input">
                                        <label>Nombre del usuario</label>
                                        <div class="value">{{ user.username }}</div>
                                    </div>
                                    <div class="md-block without-input">
                                        <label>Email</label>
                                        <div class="value">{{ user.email }}</div>
                                    </div>
                                    <md-input-container class="md-block">
                                        <label>Nombre completo</label>
                                        <input type="text" name="first_name" ng-model="user.first_name" />
                                    </md-input-container>
                                    <md-input-container class="md-block">
                                        <label>Apellidos</label>
                                        <input type="text" name="last_name" ng-model="user.last_name" />
                                    </md-input-container>
                                    <div class="md-card-subtitle">Cambiar contraseña</div>
                                    <md-input-container class="md-block">
                                        <label>Contraseña</label>
                                        <input type="password" name="password" ng-model="user.password">
                                    </md-input-container>
                                    <md-input-container class="md-block">
                                        <label>Confirmar contraseña</label>
                                        <input type="password" name="passwordRepeat" ng-model="user.passwordRepeat" data-password-verify="password">
                                        <div ng-messages="form.passwordRepeat.$error" role="alert" multiple>
                                            <div ng-message="passwordVerify">Las contraseñas deben coincidir</div>
                                        </div>
                                    </md-input-container>
                                </md-content>
                            </div>
                            <div class="md-card-actions" layout="column" layout-align="space-around stretch">
                                <div layout="column" layout-align="space-around stretch" layout-wrap layout-padding>
                                    <md-button type="submit" class="md-raised md-profile-button zoomAnimation" ng-disabled="form.$invalid" ng-hide="progressBarActivated || delay2">Guardar perfil</md-button>
                                    <div flex layout="row" layout-align="center center">
                                        <md-progress-circular md-mode="indeterminate" ng-show="progressBarActivated && !delay1" class="md-profile zoomAnimation" md-diameter="100"></md-progress-circular>
                                    </div>
                                </div>
                            </div>
                        </form>
                    </md-tab>
                    <md-tab label="Tus recetas" md-on-select="nextPageRecipes()">
                        <div infinite-scroll="nextPageRecipes()" infinite-scroll-disabled="infiniteScroll.recipes.loadingNextPage || errorMsg" infinite-scroll-distance="3" layout-wrap>
                            <md-content class="md-padding">
                                <div class="animation-card-recipes" ng-repeat="recipe in infiniteScroll.recipes.data" flex="100">
                                    <md-card class="card-recipe-profile">
                                        <a ng-href="/recipes/{{ recipe.slug }}">
                                        <md-card-title>
                                            <md-card-title-media>
                                                <div class="md-media-md card-media">
                                                    <img class="recipe-photo-main" data-ng-src="{{ recipe.image_main | srcImage:recipe.user }}" />
                                                </div>
                                            </md-card-title-media>
                                            <md-card-title-text>
                                                    <span class="md-headline">{{ recipe.title }}</span>
                                                    <span class="md-subhead">
                                                        <div data-ng-bind-html="description(recipe.steps)"></div>
                                                    </span>
                                            </md-card-title-text>
                                        </md-card-title>
                                    </a>
                                        <div layout="row" layout-align="end center">
                                            <md-button aria-label="Edit" class="md-edit" ng-href="/recipes/{{ recipe.slug }}/edit"><md-icon class="material-icons md-dark">edit</md-icon> Editar</md-button>
                                            <md-button aria-label="Remove" class="md-remove" ng-click="removeRecipe(recipe, $event)"><md-icon class="material-icons md-dark">delete</md-icon> Borrar</md-button>
                                        </div>
                                    </md-card>
                                </div>
                            </md-content>
                        </div>
                    </md-tab>
                    <md-tab label="Tus recetas favoritas" md-on-select="nextPageRecipesFavorites()">
                        <div infinite-scroll="nextPageRecipesFavorites()" infinite-scroll-disabled="infiniteScroll.recipesFavorites.loadingNextPage || errorMsg" infinite-scroll-distance="3" layout-wrap>
                            <md-content class="md-padding">
                                <div class="animation-card-recipes" ng-repeat="recipe in infiniteScroll.recipesFavorites.data" flex="100">
                                    <md-card class="card-recipe-profile">
                                        <a ng-href="/recipes/{{ recipe.slug }}">
                                        <md-card-title>
                                            <md-card-title-media>
                                                <div class="md-media-md card-media">
                                                    <img class="recipe-photo-main" data-ng-src="{{ recipe.image_main | srcImage:recipe.user }}" />
                                                </div>
                                            </md-card-title-media>
                                            <md-card-title-text>
                                                    <span class="md-headline">{{ recipe.title }}</span>
                                                    <span class="md-subhead">
                                                        <div data-ng-bind-html="description(recipe.steps)"></div>
                                                    </span>
                                            </md-card-title-text>
                                        </md-card-title>
                                    </a>
                                        <div layout="row" layout-align="end center">
                                            <md-button ng-click="removeFavorite(recipe, $event)" class="md-icon-button" aria-label="Favoritos">
                                                <md-icon class="material-icons md-red">favorite</md-icon>
                                            </md-button>
                                        </div>
                                    </md-card>
                                </div>
                            </md-content>
                        </div>
                    </md-tab>
                    <md-tab label="Tus imagenes" md-on-select="loadUserImages()">
                        <md-content class="md-padding">
                            <div ng-repeat="image in images | orderBy:'-created_at'" flex="100">
                                <md-card class="image-list-card">
                                    <md-card-title>
                                        <md-card-title-media>
                                            <div class="md-media-md card-media" layout="row" layout-align="center center">
                                                <a layout="row" layout-align="center center" class="image-recipe-zoomable fancybox" rel="gallery" title="{{ image.title }}" ng-href="{{ image | srcImage:user }}">
                                                    <img ng-src="{{ image | srcImage:user }}" />
                                                </a>
                                            </div>
                                        </md-card-title-media>
                                        <md-card-title-text>
                                            <span class="md-headline">{{ image.title }}</span>
                                            <span class="md-subhead"><strong>Imagen subida el </strong> {{ image.created_at | date:'medium' }}</span>
                                            <div layout="row" layout-align="space-between strech">
                                                <md-content layout="column" layout-wrap>
                                                    <div flex><strong>Nº veces usada como principal:</strong> {{ image.recipesImageMain }}</div>
                                                    <div flex><strong>Nº veces usada como extra:</strong> {{ image.recipes }}</div>
                                                    <div flex><strong>Nº total de veces usada:</strong> {{ image.recipes + image.recipesImageMain }}</div>
                                                </md-content>
                                                <div layout="row" layout-align="end end">
                                                    <md-tooltip ng-if="image.recipesImageMain > 0">La imagen se usa en alguna receta como principal</md-tooltip>
                                                    <md-button ng-disabled="image.recipesImageMain > 0" aria-label="Remove" class="md-remove" ng-click="remove(image, $event)">
                                                        <md-icon class="material-icons md-dark">delete</md-icon> Borrar
                                                    </md-button>
                                                </div>
                                            </div>
                                        </md-card-title-text>
                                    </md-card-title>
                                </md-card>
                            </div>
                        </md-content>
                    </md-tab>
                    <md-tab label="Tus amigos" md-on-select="nextPageFriends()">
                        <div infinite-scroll="nextPageFriends()" infinite-scroll-disabled="infiniteScroll.friends.loadingNextPage || errorMsg" infinite-scroll-distance="3" layout-wrap>
                            <md-content class="md-padding" layout="row" layout-wrap layout-align="space-around start">
                                <div class="animation-card-users" ng-repeat="user in infiniteScroll.friends.data" flex="100">
                                    <md-card class="card-user-main">
                                        <a ng-href="/users/{{ user.id }}">
                                            <md-card-title>
                                                <md-card-title-media>
                                                    <div class="md-media-md card-media">
                                                        <img ng-src="{{ user | userImage }}" />
                                                    </div>
                                                </md-card-title-media>
                                                <md-card-title-text>
                                                    <div layout="row" layout-align="space-between end">
                                                        <div>
                                                            <div class="md-headline">{{ user | fullname }}</div>
                                                            <div class="md-subhead">{{ user.username }}</div>
                                                            <div class="md-subhead">{{ user.email }}</div>
                                                        </div>
                                                        <div ng-if="isMe(user)"></div>
                                                        <div ng-else-if="checkFriend(user)">
                                                            <md-button class="md-remove" ng-click="deleteFriend(user, $event)">
                                                                <md-icon class="material-icons md-dark">delete</md-icon> Borrar de tus amigos
                                                            </md-button>
                                                        </div>
                                                        <div ng-else>
                                                            <md-button class="md-edit" ng-click="addFriend(user, $event)">
                                                                <md-icon class="material-icons md-dark">plus</md-icon> Añadir a amigos
                                                            </md-button>
                                                        </div>
                                                    </div>
                                                </md-card-title-text>
                                            </md-card-title>
                                        </a>
                                    </md-card>
                                </div>
                            </md-content>
                        </div>
                    </md-tab>
                </md-tabs>
            </md-card-content>
        </md-card>
    </div>
</md-content>
<md-button ng-show="selectedProfileTab == 0 || selectedProfileTab == 3" class="md-fab md-fixed-bottom-profile" aria-label="Subir imagenes" ng-click="openUploadImage($event)">
    <md-icon class="material-icons md-light">file_upload</md-icon>
</md-button>
