"use strict";function nl2br(str,isXhtml){var breakTag=isXhtml||"undefined"==typeof isXhtml?"<br />":"<br>";return(str+"").replace(/([^>\r\n]?)(\r\n|\n\r|\r|\n)/g,"$1"+breakTag+"$2")}var recetarium=angular.module("recetariumApp",["environment","ngRoute","ngMaterial","ngMessages","ngSanitize","ngAnimate","textAngular","ui.router","infinite-scroll","elif","pascalprecht.translate","md.data.table","Animations","Internationalization","TextEditor","AnimationDirectives","CommentProviders","FileProviders","NotificationProviders","RatingProviders","CommentServices","FileServices","FileDirectives","FormDirectives","TimeDirectives","ValidatorDirectives","HomeController","UserServices","UserFilters","UserController","AuthServices","AuthController","RecipeServices","RecipeFilters","RecipeController","CategoryServices","CategoryController","CategoryProviders","TagServices","IngredientServices"]);recetarium.config(["$routeProvider","$locationProvider",function($routeProvider,$locationProvider){$locationProvider.html5Mode(!0),$routeProvider.when("/",{templateUrl:"views/home.html",controller:"Home"}).when("/login",{templateUrl:"views/auth/login.html",controller:"Login",resolve:{access:["AuthService",function(AuthService){return AuthService.IsAnonymous()}]}}).when("/logout",{template:"",controller:"Logout",resolve:{access:["AuthService",function(AuthService){return AuthService.IsAuthenticated()}]}}).when("/register",{templateUrl:"views/auth/register.html",controller:"Register",resolve:{access:["AuthService",function(AuthService){return AuthService.IsAnonymous()}]}}).when("/reset/password",{templateUrl:"views/auth/reset-password.html",controller:"ResetPassword",resolve:{access:["AuthService",function(AuthService){return AuthService.IsAnonymous()}]}}).when("/reset/password/:token",{templateUrl:"views/auth/recover-password.html",controller:"RecoverPassword",resolve:{access:["AuthService",function(AuthService){return AuthService.IsAnonymous()}]}}).when("/active/:token",{templateUrl:"views/auth/validate-email.html",controller:"ValidateEmail",resolve:{access:["AuthService",function(AuthService){return AuthService.IsAnonymous()}]}}).when("/profile",{templateUrl:"views/auth/profile.html",controller:"Profile",permission:"logged",resolve:{access:["AuthService",function(AuthService){return AuthService.IsAuthenticated()}]}}).when("/settings",{templateUrl:"views/auth/settings.html",controller:"Settings",permission:"logged",resolve:{access:["AuthService",function(AuthService){return AuthService.IsAuthenticated()}]}}).when("/recipes",{templateUrl:"views/recipe/index.html",controller:"RecipeAll"}).when("/recipes/:slug",{templateUrl:"views/recipe/show.html",controller:"RecipeShow"}).when("/recipes/:slug/edit",{templateUrl:"views/recipe/edit.html",controller:"RecipeEdit",resolve:{access:["AuthService","$route","$rootScope",function(AuthService,$route,$rootScope){return $rootScope.progressBarActivated=!0,AuthService.IsMyRecipe($route.current.params.slug)}]}}).when("/new-recipe",{templateUrl:"views/recipe/create.html",controller:"RecipeCreate",resolve:{access:["AuthService",function(AuthService){return AuthService.IsAuthenticated()}]}}).when("/users",{templateUrl:"views/user/index.html",controller:"UserAll",resolve:{access:["AuthService",function(AuthService){return AuthService.IsAuthenticated()}]}}).when("/users/:id",{templateUrl:"views/user/show.html",controller:"UserShow",resolve:{access:["AuthService",function(AuthService){return AuthService.IsAuthenticated()}]}}).when("/friends",{templateUrl:"views/user/index.html",controller:"FriendAll",resolve:{access:["AuthService",function(AuthService){return AuthService.IsAuthenticated()}]}}).when("/categories",{templateUrl:"views/categories/index.html",controller:"CategoryAll",resolve:{access:["AuthService",function(AuthService){return AuthService.isAdmin()}]}}).when("/unauthorized",{templateUrl:"views/error/401.html",controller:""}).when("/forbidden",{templateUrl:"views/error/403.html",controller:""}).otherwise({redirectTo:"/"})}]),recetarium.config(["$httpProvider",function($httpProvider){$httpProvider.defaults.useXDomain=!0,delete $httpProvider.defaults.headers.common["X-Requested-With"],$httpProvider.interceptors.push(["$q","$location","$rootScope",function($q,$location,$rootScope){return{response:function(response){return response},responseError:function(response){return 401===response.status&&($rootScope.globals.token&&$rootScope.IsAuthed?$location.path("/unauthorized"):$location.path("/login")),$q.reject(response)}}}])}]),recetarium.config(["$mdThemingProvider",function($mdThemingProvider){}]),recetarium.config(["envServiceProvider",function(envServiceProvider){envServiceProvider.config({domains:{development:["localhost","127.0.0.1"],production:["recetarium-angular.herokuapp.com"]},vars:{development:{apiUrl:"http://localhost:9000",pusherLog:!0},production:{apiUrl:"https://recetarium.herokuapp.com",pusherLog:!1}}}),envServiceProvider.check()}]),recetarium.run(["$rootScope","$location","$http","AuthService","NotificationProvider","envService","ICONS",function($rootScope,$location,$http,AuthService,NotificationProvider,envService,ICONS){angular.module("infinite-scroll").value("THROTTLE_MILLISECONDS",500);var authRegex=/\/login|\/register|\/active.*|\/reset\/password.*/,profileRegex=/\/profile.*|\/settings.*/,userRegex=/\/users.*|\/friends/,adminRegex=/\/categories/;$rootScope.location=$location,$rootScope.searchString="",Pusher.logToConsole=envService.read("pusherLog"),localStorage.globals?($rootScope.globals=JSON.parse(localStorage.globals),$http.defaults.headers.common["X-Auth-Token"]=$rootScope.globals.token,AuthService.CheckToken($rootScope.globals.user),AuthService.StartCronCheckToken()):$rootScope.globals={},$(document).on("click",".no-implemented",function(e){e.preventDefault(),e.stopPropagation(),NotificationProvider.notify({title:"No implementado",text:"Esta opcion esta en desarrollo y sera aplicada posteriormente.",type:"error",addclass:"custom-error-notify",icon:"material-icons md-light",icon_class:"update",styling:"fontawesome"})}),$rootScope.$on("$routeChangeError",function(ev,next,current,rejection){rejection==AuthService.UNAUTHORIZED?$location.path("/login"):rejection==AuthService.FORBIDDEN&&$location.path("/forbidden")}),$rootScope.$on("$locationChangeStart",function(ev,next,current,rejection){$http.defaults.headers.common["X-Auth-Token"]=$rootScope.globals.token;var $path=$location.path();switch($rootScope.IsAuthed=AuthService.IsAuthed(),$rootScope.isAdmin=AuthService.isAdmin(),$rootScope.IsAuthed&&($rootScope.userLogged=$rootScope.globals.user),$rootScope.IsHome="/"==$path,$rootScope.IsRecipeListPage="/recipes"==$path,$rootScope.IsUserListPage="/users"==$path||"/friends"==$path,$rootScope.scrollInTop=$rootScope.IsHome,$rootScope.HasBack=!1,$rootScope.errorMsg=!1,$rootScope.progressBarActivated=!1,"/recipes"!==$path&&$location.search({}),!0){case authRegex.test($path):$rootScope.tabColor="#00BFA5",$rootScope.headerTheme="header-theme-auth",$rootScope.loaderTheme="md-auth",$rootScope.bodyTheme="body-theme-auth",$rootScope.htmlTheme="html-theme-auth";break;case profileRegex.test($path):$rootScope.tabColor="#304FFE",$rootScope.headerTheme="header-theme-profile",$rootScope.loaderTheme="md-profile",$rootScope.bodyTheme="body-theme-profile",$rootScope.htmlTheme="html-theme-profile";break;case userRegex.test($path):$rootScope.tabColor="#FFC107",$rootScope.headerTheme="header-theme-user",$rootScope.loaderTheme="md-user",$rootScope.bodyTheme="body-theme-user",$rootScope.htmlTheme="html-theme-user";break;case adminRegex.test($path):$rootScope.tabColor="#03acac",$rootScope.headerTheme="header-theme-admin",$rootScope.loaderTheme="md-admin",$rootScope.bodyTheme="body-theme-admin",$rootScope.htmlTheme="html-theme-admin";break;default:$rootScope.tabColor="#DD2C00",$rootScope.headerTheme="header-theme-default",$rootScope.loaderTheme="md-default",$rootScope.bodyTheme="body-theme-default",$rootScope.htmlTheme="html-theme-default"}}),$rootScope.$on("$viewContentLoaded",function(){$("html, body").animate({scrollTop:0},"slow"),$(".md-editor-toolbar").exists(function(){$(".md-editor-toolbar button").each(function(){var $this=$(this);$this.append('<div class="md-ripple-container"></div>'),$this.children(".material-icons").replaceWith('<md-icon class="material-icons md-dark">'+ICONS[$this.attr("name")]+"</md-icon>")})}),$(".fancybox").fancybox(),$(".lolliclock-duration").lolliclock({hour24:!0}),$(".input-file-material").exists(function(){$(document).on("change",".input-file-material",function(){$(".md-textfield-input").val(this.files[0].name)})}),$(".md-ink-item").exists(function(){$(document).on("click",".md-ink-item",function(e){var $this=$(this);0===$this.find(".md-ink").length&&$this.prepend('<span class="md-ink"></span>');var ink=$this.find(".md-ink");if(ink.removeClass("animate"),!ink.height()&&!ink.width()){var d=Math.max($this.outerWidth(),$this.outerHeight());ink.css({height:d,width:d})}var x=e.pageX-$this.offset().left-ink.width()/2,y=e.pageY-$this.offset().top-ink.height()/2;ink.css({top:y+"px",left:x+"px"}).addClass("animate")})})})}]),String.prototype.trunc=function(n,useWordBoundary){var isTooLong=this.length>n,s_=isTooLong?this.substr(0,n-1):this.substr(0,this.length);return s_=useWordBoundary&&isTooLong?s_.substr(0,s_.lastIndexOf(" ")):s_,isTooLong?s_+"&hellip;":s_},Array.prototype.contains=function(obj){for(var i=this.length;i--;)if(this[i]===obj)return!0;return!1},Array.prototype.removeItem=function(item){var index=this.indexOf(item);return index>-1?this.splice(item,1):this},Array.prototype.getById=function(id){for(var i=this.length;i--;)if(void 0!==this[i]&&null!==this[i]&&this[i].id===id)return this[i];return null},Array.prototype.getByIdWithParent=function(id){return $.getByIdWithParent(this,id)},Array.prototype.setById=function(id,data){var object=this.getByIdWithParent(id);return void 0!==object&&null!==object&&object.id===id?object=data:null},Array.prototype.removeById=function(id){for(var i=this.length;i--;)if(void 0!==this[i]&&null!==this[i]&&this[i].id===id)return this.splice(i,1);return null},$.fn.exists=function(callback){var args=[].slice.call(arguments,1);return this.length&&callback.call(this,args),this},$.containsId=function(el,array){for(var i=array.length;i--;)if(void 0!==array[i]&&null!==array[i]&&array[i].id===el.id)return!0;return!1},$.getArrayId=function(array){var a=[];for(var el in array)array[el].id&&a.push(array[el].id);return a},$.getArrayText=function(array){var a=[];for(var el in array)array[el].text&&a.push(array[el].text);return a},$.getByIdWithParent=function(array,id){if(array)for(var i=0;i<array.length;i++){var object=array.getById(id);if(null!==object)return object;if(object=$.getByIdWithParent(array[i].replies,id))return object}},$.parseError=function(error){var msg="";if(angular.isArray(error)){msg+="<ul>";for(var i in error)error.hasOwnProperty(i)&&(msg+="<li>"+$.parseError(error[i])+"</li>");msg+="</ul>"}else if(angular.isObject(error))for(var field in error)"error"===field?msg+="<ul><li>"+error[field]+"</li></ul>":(msg+="<ul>",msg+="<li>"+field+"</li>"+$.parseError(error[field]),msg+="</ul>");else msg+=error;return msg},$.calcHeightDesktop=function(x){return-192e-6*x*x*x+.0288*x*x-1.96*x+400},$.calcHeightTablet=function(x){return-192e-6*x*x*x+.0288*x*x-1.96*x+300},$.calcHeightMobile=function(x){return-192e-6*x*x*x+.0288*x*x-1.96*x+200},$.scrollbarWidth=function(){var parent,child,width;return void 0===width&&(parent=$('<div style="width:50px;height:50px;overflow:auto"><div/></div>').appendTo("body"),child=parent.children(),width=child.innerWidth()-child.height(99).innerWidth(),parent.remove()),width},$.getFullName=function(user){var name="";return user?(user.first_name&&(name+=user.first_name),user.last_name&&(name+=" "+user.last_name),""===name?user.username:name):name};var authController=angular.module("AuthController",[]);authController.constant("DELAY_FUNCTIONS",{initDelays:function($scope,$timeout){$scope.setDelay1=function(){$scope.delay1=!0,$scope.delay2=!0,$timeout(function(){$scope.delay1=!1},1e3)},$scope.setDelay2=function(){$timeout(function(){$scope.delay2=!1},1e3)}}}),authController.controller("Login",["$scope","$rootScope","$location","$translate","$timeout","AuthService","NotificationProvider","NOTIFICATION","DELAY_FUNCTIONS",function($scope,$rootScope,$location,$translate,$timeout,AuthService,NotificationProvider,NOTIFICATION,DELAY_FUNCTIONS){DELAY_FUNCTIONS.initDelays($scope,$timeout),$scope.login=function(){$rootScope.errorMsg=!1,$rootScope.progressBarActivated=!0,$scope.setDelay1(),AuthService.login($scope.email,$scope.password,!$scope.expiration,function(response){AuthService.SaveCredentials(response.data.auth_token,JSON.parse(AuthService.ParseJwt(response.data.auth_token).sub),response.data.pusher_key,response.data.language),$scope.expiration||AuthService.StartCronCheckToken(),NotificationProvider.notify({title:$translate.instant("login.header-title"),type:"success",addclass:"custom-success-notify",icon:"material-icons md-light",icon_class:"cake",styling:"fontawesome"}),$rootScope.progressBarActivated=!1,$location.path("/")},function(response){NOTIFICATION.ParseErrorResponse(response,[400,401],$translate,$rootScope,NotificationProvider),$rootScope.progressBarActivated=!1,$scope.setDelay2()})}}]),authController.controller("Register",["$scope","$rootScope","$location","$translate","$timeout","AuthService","NotificationProvider","NOTIFICATION","DELAY_FUNCTIONS",function($scope,$rootScope,$location,$translate,$timeout,AuthService,NotificationProvider,NOTIFICATION,DELAY_FUNCTIONS){DELAY_FUNCTIONS.initDelays($scope,$timeout),$scope.register=function(){$rootScope.errorMsg=!1,$rootScope.progressBarActivated=!0,$scope.setDelay1();var user={username:$scope.username,email:$scope.email,password:$scope.password,password_repeat:$scope.passwordRepeat,first_name:$scope.first_name,last_name:$scope.last_name};AuthService.register(user,function(response){NotificationProvider.notify({title:$translate.instant("register.thanks-title"),text:$translate.instant("register.thanks-text"),type:"success",addclass:"custom-success-notify",icon:"material-icons md-light",icon_class:"mail_outline",styling:"fontawesome"}),$rootScope.progressBarActivated=!1,$location.path("/")},function(response){NOTIFICATION.ParseErrorResponse(response,[400,401],$translate,$rootScope,NotificationProvider),$rootScope.progressBarActivated=!1,$scope.setDelay2()})}}]),authController.controller("Logout",["$scope","$location","$translate","AuthService","NotificationProvider","NOTIFICATION","DELAY_FUNCTIONS",function($scope,$location,$translate,AuthService,NotificationProvider,NOTIFICATION){NotificationProvider.notify({title:$translate.instant("logout.title"),text:$translate.instant("logout.text"),type:"success",addclass:"custom-success-notify",icon:"material-icons md-light",icon_class:"cake",styling:"fontawesome"}),AuthService.StopCronCheckToken(),AuthService.ClearCredentials(),$location.path("/")}]),authController.controller("ResetPassword",["$scope","$rootScope","$location","$translate","$timeout","AuthService","NotificationProvider","NOTIFICATION","DELAY_FUNCTIONS",function($scope,$rootScope,$location,$translate,$timeout,AuthService,NotificationProvider,NOTIFICATION,DELAY_FUNCTIONS){DELAY_FUNCTIONS.initDelays($scope,$timeout),$scope.resetPassword=function(){$rootScope.errorMsg=!1,$rootScope.progressBarActivated=!0,$scope.hasMessage=!1,$scope.setDelay1(),AuthService.resetPassword($scope.email,function(response){$scope.msg=response.data.msg,NotificationProvider.notify({title:response.data.msg,type:"success",addclass:"custom-success-notify",icon:"material-icons md-light",icon_class:"mail_outline",styling:"fontawesome"}),$scope.hasMessage=!0,$rootScope.progressBarActivated=!1,$scope.setDelay2()},function(response){NOTIFICATION.ParseErrorResponse(response,[400,404],$translate,$rootScope,NotificationProvider),$rootScope.progressBarActivated=!1,$scope.setDelay2()})}}]),authController.controller("RecoverPassword",["$scope","$rootScope","$routeParams","$location","$translate","$timeout","AuthService","NotificationProvider","NOTIFICATION","DELAY_FUNCTIONS",function($scope,$rootScope,$routeParams,$location,$translate,$timeout,AuthService,NotificationProvider,NOTIFICATION,DELAY_FUNCTIONS){DELAY_FUNCTIONS.initDelays($scope,$timeout),$scope.recoverPassword=function(){$rootScope.errorMsg=!1,$rootScope.progressBarActivated=!0,$scope.setDelay1(),AuthService.recoverPassword($scope.email,$scope.password,$routeParams.token,function(response){NotificationProvider.notify({title:$translate.instant("recover.changed"),type:"success",addclass:"custom-success-notify",icon:"material-icons md-light",icon_class:"lock",styling:"fontawesome"}),$rootScope.progressBarActivated=!1,$location.path("/login")},function(response){NOTIFICATION.ParseErrorResponse(response,[400,404],$translate,$rootScope,NotificationProvider),$rootScope.progressBarActivated=!1,$scope.setDelay2()})}}]),authController.controller("ValidateEmail",["$scope","$rootScope","$routeParams","$location","$translate","AuthService","NotificationProvider","NOTIFICATION",function($scope,$rootScope,$routeParams,$location,$translate,AuthService,NotificationProvider,NOTIFICATION){$rootScope.errorMsg=!1,$rootScope.progressBarActivated=!0,AuthService.ValidateEmail($routeParams.token,function(response){NotificationProvider.notify({title:$translate.instant("active.actived"),type:"success",addClass:"material-icons md-light",icon_class:"check_circle",style:"fontawesome"}),$rootScope.progressBarActivated=!1,$location.path("/login")},function(response){NOTIFICATION.ParseErrorResponse(response,[400,404],$translate,$rootScope,NotificationProvider),$rootScope.progressBarActivated=!1})}]),authController.controller("Profile",["$scope","$rootScope","$location","$timeout","$sce","$mdDialog","$translate","AuthService","FileService","UserService","RecipeService","NotificationProvider","FileProvider","FRIENDS_FUNCTIONS","USER_FUNCTIONS","DELAY_FUNCTIONS","NOTIFICATION",function($scope,$rootScope,$location,$timeout,$sce,$mdDialog,$translate,AuthService,FileService,UserService,RecipeService,NotificationProvider,FileProvider,FRIENDS_FUNCTIONS,USER_FUNCTIONS,DELAY_FUNCTIONS,NOTIFICATION){$scope.user=$rootScope.globals.user,$scope.infiniteScroll={recipes:{data:[],total:1,nextPageNumber:1,loadingNextPage:!1,hasError:!1},recipesFavorites:{data:[],total:1,nextPageNumber:1,loadingNextPage:!1,hasError:!1},images:{data:[],total:1,nextPageNumber:1,loadingNextPage:!1,hasError:!1},friends:{data:[],total:1,nextPageNumber:1,loadingNextPage:!1,hasError:!1}},DELAY_FUNCTIONS.initDelays($scope,$timeout),$scope.isMe=function(user){return void 0!==user&&$rootScope.globals.user.id==user.id},$scope.checkFriend=function(user){var i=0;if(void 0!==user)for(;i<user.friends.length;){if(user.friends[i].user_id===$rootScope.globals.user.id)return!0;i++}return!1},USER_FUNCTIONS.Recipes($scope,$rootScope,$translate,$mdDialog,$rootScope.globals.user.id,UserService,RecipeService,NotificationProvider,NOTIFICATION),USER_FUNCTIONS.RecipesFavorites($scope,$rootScope,$translate,$mdDialog,$rootScope.globals.user.id,UserService,RecipeService,NotificationProvider,NOTIFICATION),USER_FUNCTIONS.Friends($scope,$rootScope,$translate,$rootScope.globals.user.id,UserService,NotificationProvider,FRIENDS_FUNCTIONS,NOTIFICATION),$scope.loadUserImages=function(){$rootScope.progressBarActivated=!0,FileService.loadUserImages($rootScope.globals.user,function(response){$scope.images=response.data,$rootScope.progressBarActivated=!1},function(response){NOTIFICATION.ParseErrorResponse(response,[],$translate,$rootScope,NotificationProvider),$rootScope.progressBarActivated=!1})},$scope.openUploadImage=function($event){$mdDialog.show({controller:FileProvider.openUploadDialog,templateUrl:"views/partials/upload-images-dialog.html",parent:angular.element(document.body),locals:{data:{user:$scope.user}},targetEvent:$event,clickOutsideToClose:!0}).then(function(answer){$scope.images=$scope.images.concat(answer)},function(){})},$scope.description=function(steps){if(steps)return $sce.trustAsHtml(steps.trunc(260,!0))},$scope.remove=function(image,$event){var msg=$translate.instant("dialog.remove-image-1",{title:image.title});image.recipes>0&&(msg+="<br><br>"+$translate.instant("dialog.remove-image-2"));var confirm=$mdDialog.confirm().title($translate.instant("btn.delete-text")).htmlContent(nl2br(msg)).ariaLabel($translate.instant("btn.delete-text")).targetEvent($event).ok($translate.instant("btn.delete-text")).cancel($translate.instant("btn.cancel-text"));$mdDialog.show(confirm).then(function(){$rootScope.progressBarActivated=!0,$rootScope.errorMsg=!1,FileService.deleteFile($scope.user,image.id,function(response){NotificationProvider.notify({title:response.data.msg,type:"success",addclass:"custom-success-notify",icon:"material-icons md-light",icon_class:"check_circle",styling:"fontawesome"}),$rootScope.progressBarActivated=!1,$scope.images.splice($scope.images.findIndex(function(imageInArray){return image.id==imageInArray.id}),1)},function(response){NOTIFICATION.ParseErrorResponse(response,[400,404],$translate,$rootScope,NotificationProvider),$rootScope.progressBarActivated=!1})},function(){})}}]),authController.controller("Settings",["$scope","$rootScope","$location","$translate","$mdDialog","$timeout","AuthService","FileProvider","NotificationProvider","NOTIFICATION","DELAY_FUNCTIONS",function($scope,$rootScope,$location,$translate,$mdDialog,$timeout,AuthService,FileProvider,NotificationProvider,NOTIFICATION,DELAY_FUNCTIONS){$rootScope.errorMsg=!1,$rootScope.progressBarActivated=!0,DELAY_FUNCTIONS.initDelays($scope,$timeout),$scope.setDelay1(),AuthService.GetProfile(function(response){$scope.user=response.data,$scope.user.language||($scope.user.language=window.navigator.userLanguage||window.navigator.language),$rootScope.errorMsg=!1,$rootScope.progressBarActivated=!1,$scope.setDelay2()},function(response){NOTIFICATION.ParseErrorResponse(response,[401],$translate,$rootScope,NotificationProvider),$rootScope.progressBarActivated=!1,$scope.setDelay2()}),$scope.save=function(){$rootScope.errorMsg=!1,$rootScope.progressBarActivated=!0,$scope.setDelay1();var userObj=angular.copy($scope.user);userObj.avatar&&(userObj.avatar=userObj.avatar.id),AuthService.EditProfile(userObj,function(response){$rootScope.progressBarActivated=!1,$scope.user=response.data,$translate.use($scope.user.language),NotificationProvider.notify({title:$translate.instant("response.saved"),type:"success",addclass:"custom-success-notify",icon:"material-icons md-light",icon_class:"backup",styling:"fontawesome"}),AuthService.CheckToken($scope.user),$scope.setDelay2()},function(response){NOTIFICATION.ParseErrorResponse(response,[400],$translate,$rootScope,NotificationProvider),$rootScope.progressBarActivated=!1,$scope.setDelay2()})},$scope.selectAvatar=function(ev){$mdDialog.show({controller:FileProvider.openGalleryDialog,templateUrl:"views/partials/gallery-dialog.html",parent:angular.element(document.body),locals:{data:{selectedImages:$scope.user.avatar?[$scope.user.avatar]:[],mode:"selectAvatar",user:$scope.user}},targetEvent:ev,clickOutsideToClose:!0}).then(function(answer){$scope.user.avatar=answer},function(){})}}]);var categoryController=angular.module("CategoryController",[]);categoryController.controller("CategoryAll",["$scope","$rootScope","$translate","$mdEditDialog","$mdDialog","CategoryService","CategoryProvider","NotificationProvider","NOTIFICATION",function($scope,$rootScope,$translate,$mdEditDialog,$mdDialog,CategoryService,CategoryProvider,NotificationProvider,NOTIFICATION){$scope.categories=[],$scope.selected=[],$scope.pagination={page:1,size:10,search:"",order:"id"},$scope.labels={page:$translate.instant("pagination.page"),rowsPerPage:$translate.instant("pagination.rows-per-page"),of:$translate.instant("pagination.of")},$scope.reloadCategories=function(){$scope.pagination.page=1,$scope.getCategories()},$scope.getCategories=function(){$rootScope.progressBarActivated=!0,$rootScope.errorMsg=!1,$scope.loadingNextPage=!0,CategoryService.search($scope.pagination,function(response){var responseData=response.data;$scope.categories=responseData.data,$scope.total=responseData.total,$scope.loadingNextPage=!1,$rootScope.progressBarActivated=!1},function(response){NOTIFICATION.ParseErrorResponse(response,[],$translate,$rootScope,NotificationProvider),$scope.hasError=!0,$scope.loadingNextPage=!1,$rootScope.progressBarActivated=!1})},$scope.getCategories(),$scope.add=function($ev){$mdDialog.show({controller:CategoryProvider.openCategoryDialog,templateUrl:"views/partials/category-dialog.html",parent:angular.element(document.body),targetEvent:$ev,clickOutsideToClose:!0}).then($scope.getCategories)},$scope.edit=function($ev,category){$ev.stopPropagation(),$mdEditDialog.small({modelValue:category.text,save:function(input){category.text=input.$modelValue,$rootScope.progressBarActivated=!0,$rootScope.errorMsg=!1,$scope.loadingNextPage=!0,CategoryService.edit(category,function(response){NotificationProvider.notify({title:$translate.instant("response.saved"),type:"success",addclass:"custom-success-notify",icon:"material-icons md-light",icon_class:"restaurant_menu",styling:"fontawesome"}),$scope.loadingNextPage=!1,$rootScope.progressBarActivated=!1},function(response){NOTIFICATION.ParseErrorResponse(response,[400,401,404],$translate,$rootScope,NotificationProvider),$scope.hasError=!0,$scope.loadingNextPage=!1,$rootScope.progressBarActivated=!1})},targetEvent:$ev,validators:{required:!0}})},$scope["delete"]=function($ev){var msg=$translate.instant("dialog.remove-categories",{total:$scope.selected.length}),confirm=$mdDialog.confirm().title($translate.instant("btn.delete-text")).htmlContent(nl2br(msg)).ariaLabel($translate.instant("btn.delete-text")).targetEvent($ev).ok($translate.instant("btn.delete-text")).cancel($translate.instant("btn.cancel-text"));$mdDialog.show(confirm).then(function(){$rootScope.progressBarActivated=!0,$rootScope.errorMsg=!1,$scope.loadingNextPage=!0,CategoryService.deleteMultiple($.getArrayId($scope.selected),function(response){NotificationProvider.notify({title:response.data.msg,type:"success",addclass:"custom-success-notify",icon:"material-icons md-light",icon_class:"restaurant_menu",styling:"fontawesome"}),$scope.loadingNextPage=!1,$rootScope.progressBarActivated=!1,$scope.reloadCategories()},function(response){NOTIFICATION.ParseErrorResponse(response,[],$translate,$rootScope,NotificationProvider),$scope.hasError=!0,$scope.loadingNextPage=!1,$rootScope.progressBarActivated=!1})})}}]);var homeController=angular.module("HomeController",[]);homeController.controller("Header",["$scope","$rootScope","$mdSidenav","$timeout","$location","$route","$translate","RecipeService",function($scope,$rootScope,$mdSidenav,$timeout,$location,$route,$translate,RecipeService){function debounce(func,wait,context){var timer;return function(){var context=$scope,args=Array.prototype.slice.call(arguments);$timeout.cancel(timer),timer=$timeout(function(){timer=void 0,func.apply(context,args)},wait||10)}}function buildDelayedToggler(navID){return debounce(function(){$mdSidenav(navID).toggle().then(function(){})},0)}function closeSideNav(navID){$mdSidenav(navID).close().then(function(){})}function changeHeader(e){var heightForMove=125,distanceY=window.pageYOffset||document.documentElement.scrollTop;distanceY<=heightForMove&&$rootScope.IsHome?$rootScope.scrollInTop=!0:$rootScope.scrollInTop=!1}$scope.toggleLeft=buildDelayedToggler("left"),$scope.data={search:$rootScope.searchString},$scope.navLinks=[{title:'<i class="material-icons">fiber_new</i> '+$translate.instant("menu.last-recipes"),url:"/recipes"},{title:'<i class="material-icons">stars</i> '+$translate.instant("menu.top-recipes"),url:"/top-recipes","class":"no-implemented"},{title:'<i class="material-icons">perm_identity</i> '+$translate.instant("menu.all-users"),url:"/users"},{title:'<i class="material-icons">weekend</i> '+$translate.instant("menu.friends"),url:"/friends"},{title:'<i class="material-icons">edit</i> '+$translate.instant("menu.write-recipe"),url:"/new-recipe"}];var originatorEv;$scope.openDropdrown=function($mdOpenMenu,ev){originatorEv=ev,$mdOpenMenu(ev)},$scope.navTo=function(ev,url){closeSideNav("left"),$location.path()!==url&&$location.path(url)},$scope.getClassActive=function(path){var cur_path=$location.path().substr(0,path.length);return cur_path==path?$location.path().substr(0).length>1&&1==path.length?"":"active":""},$scope.searchRecipe=function(){$rootScope.searchString=$scope.data.search,$location.path("recipes"),$route.reload()},$scope.$on("$includeContentLoaded",function(){$rootScope.IsHome&&window.addEventListener("scroll",changeHeader,!1)})}]),homeController.controller("Home",["$scope","$rootScope","$location","$translate","RecipeService","NotificationProvider","DIFF","NOTIFICATION",function($scope,$rootScope,$location,$translate,RecipeService,NotificationProvider,DIFF,NOTIFICATION){$scope.recipes=[],$scope.total=1,$scope.nextPageNumber=1,$scope.loadingNextPage=!1,$scope.hasError=!1,$scope.getRecipes=function(){$scope.loadingNextPage=!0,$rootScope.progressBarActivated=!0,RecipeService.search({page:$scope.nextPageNumber,size:10},function(response){var responseData=response.data;$scope.recipes=$scope.recipes.concat(responseData.data),$scope.nextPageNumber++,$scope.total=responseData.total,$scope.loadingNextPage=!1,$rootScope.progressBarActivated=!1},function(response){NOTIFICATION.ParseErrorResponse(response,[],$translate,$rootScope,NotificationProvider),$scope.hasError=!0,$scope.loadingNextPage=!1,$rootScope.progressBarActivated=!1})},$scope.getDifficulty=function(diff){return DIFF["class"][diff]},$scope.nextPage=function(){$scope.total>$scope.recipes.length&&!$scope.loadingNextPage&&!$scope.hasError&&$scope.getRecipes()},$scope.show=function(slug){$location.path("/recipes/"+slug)}}]);var recipeController=angular.module("RecipeController",[]);recipeController.constant("DIFF",{"class":{EASY:"md-green",MEDIUM:"md-yellow",HARD:"md-red"},name:["EASY","MEDIUM","HARD"]}),recipeController.constant("VISIBILITY",{"class":{PUBLIC:"md-green",FRIENDS:"md-yellow",PRIVATE:"md-red"},icon:{PUBLIC:"lock_open",FRIENDS:"lock_outline",PRIVATE:"lock"},name:["PUBLIC","FRIENDS","PRIVATE"]}),recipeController.constant("EDIT_FUNCTIONS",{LoadScope:function($scope,DIFF,VISIBILITY){$scope.requestSlug=null,$scope.validSlug=!0,$scope.loadingSlug=!1,$scope.diffs=DIFF.name,$scope.visibilities=VISIBILITY.name,$scope.recipe={},$scope.tags=[],$scope.images={recipe:[],show:[],index:0},$scope.imagesLink={}},LoadRecipe:function($scope,$rootScope,$translate,RecipeService,CategoryService,NotificationProvider,NOTIFICATION,response){try{$scope.recipe=response.data,$scope.recipe.chipTags=response.data.tags,CategoryService.all(function(response){$scope.categories=response.data,$scope.categories.unshift({id:null,text:"Ninguna"}),$scope.recipe.category&&($scope.recipe.category_id=$scope.recipe.category.id)},function(response){NOTIFICATION.ParseErrorResponse(response,[],$translate,$rootScope,NotificationProvider)}),$rootScope.progressBarActivated=!1}catch(err){NOTIFICATION.ParseErrorResponse(response,[],$translate,$rootScope,NotificationProvider),console.error(err),$rootScope.progressBarActivated=!1}},CommonFunctions:function($scope,$rootScope,$location,$timeout,$compile,$mdDialog,$translate,RecipeService,CategoryService,TagService,IngredientService,NotificationProvider,FileProvider,DIFF,VISIBILITY,EDIT_FUNCTIONS,NOTIFICATION){$scope.getDifficulty=function(diff){return DIFF["class"][diff]},$scope.getVisibilityIcon=function(visibility){return VISIBILITY.icon[visibility]},$scope.getVisibilityClass=function(visibility){return VISIBILITY["class"][visibility]},$scope.$watch(function(){return $scope.recipe.newIngredient?$scope.recipe.newIngredient.name:$scope.recipe.newIngredient},function(newVal,oldVal){$scope.formRecipe.newIngredientName.$error={};
}),$scope.addIngredient=function(){$scope.recipe.newIngredient&&null!==$scope.recipe.newIngredient&&null!==$scope.recipe.newIngredient.name&&""!==$scope.recipe.newIngredient.name?EDIT_FUNCTIONS.AddIngredient($scope,$rootScope,$translate,IngredientService,NotificationProvider,NOTIFICATION):$scope.formRecipe.newIngredientName.$error.customRequired=!0},$scope.removeIngredient=function(index){EDIT_FUNCTIONS.DeleteIngredient($scope,$rootScope,$translate,IngredientService,NotificationProvider,NOTIFICATION,index)},$scope.$watch(function(){return $scope.recipe.title},function(newVal,oldVal){$scope.recipe.slug=RecipeService.getSlug(newVal)}),$scope.$watch(function(){return $scope.recipe.slug},function(newVal,oldVal){$scope.formRecipe.slug.$error={},$scope.abortSlugRequest(),newVal&&newVal.length>0?($scope.loadingSlug=!0,$scope.validSlugIcon="autorenew",$timeout(function(){RecipeService.checkSlugWithId(newVal,$scope.recipe.id).then(function(response){$scope.loadingSlug=!1,200==response.status?$scope.validSlugIcon="done":($scope.formRecipe.slug.$error.validSlug=!0,$scope.validSlugIcon="error")},function(response){$scope.loadingSlug=!1,$scope.formRecipe.slug.$error.validSlug=!0,$scope.validSlugIcon="error"})},500)):$scope.validSlugIcon="error"}),$scope.abortSlugRequest=function(){return $scope.requestSlug&&$scope.requestSlug.abort()},$scope.loadCategories=function(){EDIT_FUNCTIONS.AllCategories($scope,$rootScope,$translate,CategoryService,NotificationProvider,NOTIFICATION)},$scope.$watch(function(){return $scope.recipe.category_id},function(newVal,oldVal){null===newVal&&($scope.recipe.category_id=void 0)}),$scope.loadTags=function(search){return EDIT_FUNCTIONS.SearchTag($scope,$rootScope,$translate,TagService,NotificationProvider,NOTIFICATION,search)},$scope.transformChip=function(chip){return angular.isObject(chip)?chip:{text:chip,type:"nuevo"}},$scope.tagSearch=function(search){return search?$scope.loadTags(search).then(function(response){return $scope.tags=response.filter(function(el){return!$.containsId(el,$scope.recipe.chipTags)}),$scope.tags}):[]},$scope.selectImageMain=function(ev){$mdDialog.show({controller:FileProvider.openGalleryDialog,templateUrl:"views/partials/gallery-dialog.html",parent:angular.element(document.body),locals:{data:{selectedImages:$scope.recipe.image_main?[$scope.recipe.image_main]:[],mode:"selectImageMain",user:$scope.recipe.user}},targetEvent:ev,clickOutsideToClose:!0}).then(function(answer){$scope.recipe.image_main=answer},function(){})},$scope.selectImages=function(ev){$mdDialog.show({controller:FileProvider.openGalleryDialog,templateUrl:"views/partials/gallery-dialog.html",parent:angular.element(document.body),locals:{data:{selectedImages:$scope.recipe.files,mode:"selectImages",user:$scope.recipe.user}},targetEvent:ev,clickOutsideToClose:!0}).then(function(answer){$scope.recipe.files=answer},function(){})},$scope.removeImageFromRecipe=function(index){$scope.recipe.files.splice(index,1)}},AddIngredient:function($scope,$rootScope,$translate,IngredientService,NotificationProvider,NOTIFICATION){$scope.formRecipe.newIngredientName.$error={},$rootScope.errorMsg=!1,$rootScope.progressBarActivated=!0;var ingredient={name:$scope.recipe.newIngredient.name,count:$scope.recipe.newIngredient.count};IngredientService.add($scope.recipe.id,ingredient,function(response){$scope.recipe.ingredients.push(response.data),$rootScope.progressBarActivated=!1,$scope.recipe.newIngredient.name=null,$scope.recipe.newIngredient.count=null,NotificationProvider.notify({title:$translate.instant("response.added"),type:"success",addclass:"custom-success-notify",icon:"material-icons md-light",icon_class:"restaurant_menu",styling:"fontawesome"})},function(response){NOTIFICATION.ParseErrorResponse(response,[400,401],$translate,$rootScope,NotificationProvider),$rootScope.progressBarActivated=!1,$scope.recipe.newIngredient.name=null,$scope.recipe.newIngredient.count=null})},DeleteIngredient:function($scope,$rootScope,$translate,IngredientService,NotificationProvider,NOTIFICATION,index){var ingredient=$scope.recipe.ingredients[index];$rootScope.errorMsg=!1,$rootScope.progressBarActivated=!0,IngredientService["delete"]($scope.recipe.id,ingredient.id,function(response){$scope.recipe.ingredients.splice(index,1),NotificationProvider.notify({title:$translate.instant("response.deleted"),type:"success",addclass:"custom-success-notify",icon:"material-icons md-light",icon_class:"restaurant_menu",styling:"fontawesome"}),$rootScope.progressBarActivated=!1},function(response){NOTIFICATION.ParseErrorResponse(response,[400,401,404],$translate,$rootScope,NotificationProvider),$rootScope.progressBarActivated=!1})},AllCategories:function($scope,$rootScope,$translate,CategoryService,NotificationProvider,NOTIFICATION){CategoryService.all(function(response){$scope.categories=response.data,$scope.categories.unshift({id:null,text:"Ninguna"}),$rootScope.errorMsg=!1},function(response){NOTIFICATION.ParseErrorResponse(response,[],$translate,$rootScope,NotificationProvider)})},SearchTag:function($scope,$rootScope,$translate,TagService,NotificationProvider,NOTIFICATION,search){return TagService.search(search,function(response){return $rootScope.errorMsg=!1,response.data},function(response){return NOTIFICATION.ParseErrorResponse(response,[],$translate,$rootScope,NotificationProvider),[]})},AddTagById:function($rootScope,$translate,TagService,NotificationProvider,NOTIFICATION,array,id){TagService.searchById(id,function(response){$rootScope.errorMsg=!1,array.push(response.data)},function(response){NOTIFICATION.ParseErrorResponse(response,[404],$translate,$rootScope,NotificationProvider)})}}),recipeController.controller("RecipeAll",["$scope","$rootScope","$location","$routeParams","$sce","$mdDialog","$translate","RecipeService","TagService","NotificationProvider","EDIT_FUNCTIONS","NOTIFICATION",function($scope,$rootScope,$location,$routeParams,$sce,$mdDialog,$translate,RecipeService,TagService,NotificationProvider,EDIT_FUNCTIONS,NOTIFICATION){$scope.recipes=[],$scope.tags=[],$scope.tagsFromURI=[],$scope.total=0,$scope.nextPageNumber=1,$rootScope.progressBarActivated=!0,$scope.hasError=!1,$scope.loadingNextPage=!1;var numTags=0,recipesLoaded=!1;if(null!==$routeParams&&!angular.equals({},$routeParams)&&$routeParams.hasOwnProperty("tag"))if(angular.isArray($routeParams.tag)){numTags=$routeParams.tag.length;for(var tagText in $routeParams.tag)$routeParams.tag.hasOwnProperty(tagText)&&EDIT_FUNCTIONS.AddTagById($rootScope,$translate,TagService,NotificationProvider,NOTIFICATION,$scope.tagsFromURI,$routeParams.tag[tagText])}else numTags=1,EDIT_FUNCTIONS.AddTagById($rootScope,$translate,TagService,NotificationProvider,NOTIFICATION,$scope.tagsFromURI,$routeParams.tag);$scope.$watchCollection("tagsFromURI",function(newVal,oldVal){$scope.tagsFromURI.length==numTags&&($scope.tags=angular.copy($scope.tagsFromURI))}),$scope.$watchCollection("tags",function(newVal,oldVal){recipesLoaded?($location.search({tag:$.getArrayId($scope.tags)}),recipesLoaded=!1):$scope.tagsFromURI.length==numTags&&($scope.reloadRecipes(),recipesLoaded=!0)}),$scope.reloadRecipes=function(){$scope.recipes=[],$scope.total=1,$scope.nextPageNumber=1,$scope.hasError=!1,$scope.getRecipes()},$scope.getRecipes=function(){$rootScope.progressBarActivated=!0,$rootScope.errorMsg=!1,$scope.loadingNextPage=!0,RecipeService.search({page:$scope.nextPageNumber,size:10,search:$rootScope.searchString,tags:$.getArrayId($scope.tags)},function(response){var responseData=response.data;$scope.recipes=$scope.recipes.concat(responseData.data),$scope.nextPageNumber++,$scope.total=responseData.total,$scope.loadingNextPage=!1,$rootScope.progressBarActivated=!1,$(".md-scroll-mask").remove()},function(response){NOTIFICATION.ParseErrorResponse(response,[],$translate,$rootScope,NotificationProvider),$scope.hasError=!0,$scope.loadingNextPage=!1,$rootScope.progressBarActivated=!1,$(".md-scroll-mask").remove()})},$scope.nextPage=function(){$scope.total>$scope.recipes.length&&!$scope.loadingNextPage&&!$scope.hasError&&$scope.getRecipes()},$scope.tagSearch=function(search){return search?$scope.loadTags(search).then(function(response){return response}):[]},$scope.loadTags=function(search){return EDIT_FUNCTIONS.SearchTag($scope,$rootScope,$translate,TagService,NotificationProvider,NOTIFICATION,search)},$scope.description=function(steps){if(steps)return $sce.trustAsHtml(steps.trunc(260,!0))},$scope.isMine=function(user){if($rootScope.globals.user){var auth=$rootScope.globals.user;return auth.id==user.id&&auth.email==user.email&&auth.username==user.username||"ADMIN"==auth.type}return!1},$scope.remove=function(recipe,$event){$event.stopPropagation&&$event.stopPropagation(),$event.preventDefault&&$event.preventDefault(),$event.cancelBubble=!0,$event.returnValue=!1;var msg=$translate.instant("dialog.remove-recipe",{title:recipe.title}),confirm=$mdDialog.confirm().title($translate.instant("btn.delete-text")).htmlContent(nl2br(msg)).ariaLabel($translate.instant("btn.delete-text")).targetEvent($event).ok($translate.instant("btn.delete-text")).cancel($translate.instant("btn.cancel-text"));$mdDialog.show(confirm).then(function(){$rootScope.progressBarActivated=!0,$rootScope.errorMsg=!1,RecipeService["delete"](recipe.id,function(response){NotificationProvider.notify({title:response.data.msg,type:"success",addclass:"custom-success-notify",icon:"material-icons md-light",icon_class:"check_circle",styling:"fontawesome"}),$rootScope.progressBarActivated=!1,$scope.reloadRecipes()},function(response){NOTIFICATION.ParseErrorResponse(response,[404],$translate,$rootScope,NotificationProvider),$rootScope.progressBarActivated=!1})},function(){})}}]),recipeController.controller("RecipeShow",["$scope","$rootScope","$location","$routeParams","$sce","$compile","$mdDialog","$translate","$window","RecipeService","CommentService","CommentProvider","NotificationProvider","RatingProvider","DIFF","VISIBILITY","NOTIFICATION",function($scope,$rootScope,$location,$routeParams,$sce,$compile,$mdDialog,$translate,$window,RecipeService,CommentService,CommentProvider,NotificationProvider,RatingProvider,DIFF,VISIBILITY,NOTIFICATION){$rootScope.progressBarActivated=!0,$rootScope.HasBack=!0,$scope.commentsActived=!1,$rootScope.back=function(){$location.path("/recipes")},RecipeService.get($routeParams.slug,function(response){try{$scope.recipe=response.data,$scope.images=response.data.files,$scope.tags=response.data.tags,$scope.comments=response.data.comments,$scope.favorites=response.data.favorites.length,$rootScope.globals.user&&($scope.fav=response.data.favorites.contains($rootScope.globals.user.id),$scope.rated=response.data.rating.ratings[$rootScope.globals.user.id],$rootScope.globals.rated=$scope.rated,$rootScope.globals.recipe=$scope.recipe),$rootScope.headerTitle=response.data.title,$rootScope.progressBarActivated=!1}catch(err){console.error(err),NOTIFICATION.ParseErrorResponse(response,[],$translate,$rootScope,NotificationProvider),$rootScope.progressBarActivated=!1}},function(response){NOTIFICATION.ParseErrorResponse(response,[403,404],$translate,$rootScope,NotificationProvider),$rootScope.progressBarActivated=!1}),$scope.description=function(steps){if(steps)return $sce.trustAsHtml(steps)},$scope.getDifficulty=function(diff){return DIFF["class"][diff]},$scope.getVisibilityIcon=function(visibility){return VISIBILITY.icon[visibility]},$scope.getVisibilityClass=function(visibility){return VISIBILITY["class"][visibility]},$scope.getRatingIcon=function(rating){return rating>=4?"star":rating<2?"star_border":"star_half"},$scope.openShareMenu=function($mdOpenMenu,ev){$mdOpenMenu(ev)},$scope.shareBy=function(via){switch(via){case"email":var subject=$translate.instant("share.title",{title:$scope.recipe.title}),message=$translate.instant("share.body",{url:$location.absUrl()});$window.open("mailto:?subject="+subject+"&body="+message,"_blank")}},$scope.toggleFav=function(){$rootScope.globals.user?RecipeService.toggleFav($scope.recipe.id,function(response){$scope.fav=response.data.fav,$scope.favorites=response.data.favorites,NotificationProvider.notify({title:$translate.instant("response.saved"),type:"error",addclass:"custom-success-notify",icon:"material-icons md-light",icon_class:$scope.fav?"favorite":"favorite_border",styling:"fontawesome"})},function(response){NOTIFICATION.ParseErrorResponse(response,[],$translate,$rootScope,NotificationProvider)}):$location.path("/login")},$scope.showRating=function(ev){$mdDialog.show({controller:RatingProvider.openRatingDialog,templateUrl:"views/partials/rating-dialog.html",parent:angular.element(document.body),targetEvent:ev,clickOutsideToClose:!0}).then(function(answer){},function(){})},$scope.toggleComments=function(){$scope.commentsActived=!$scope.commentsActived},$scope.toggleReplies=function(comment,ev){""===$("#replies-"+comment.id).text()?$("#replies-"+comment.id).append($compile('<div ng-repeat="comment in comments.getByIdWithParent('+comment.id+').replies | orderBy:created_at:true" flex="100"><md-card class="comment-list-card"><md-card-title><md-card-title-media><div class="md-media-md card-media" layout="row" layout-align="center center"><img ng-src="{{ comment.user | userImage:recipe.user }}" /></div></md-card-title-media><md-card-title-text><span class="md-headline">{{ comment.text }}</span><span class="md-subhead" ng-if="comment.updated_at != comment.created_at">'+$translate.instant("comment.last-update")+' <em>{{ comment.updated_at | date:medium }}</em></span><span class="md-subhead">'+$translate.instant("comment.created-at")+' <em>{{ comment.created_at | date:medium }}</em></span><span class="md-subhead"><strong>{{ comment.user.first_name + " " + comment.user.last_name }}</strong></span></md-card-title-text></md-card-title><md-card-actions layout="row" layout-align="end end" flex><md-card-icons-actions><md-button class="md-icon-button" aria-label="'+$translate.instant("btn.comment-text")+'" ng-click="addComment(comment.id, $event)" ng-if="IsAuthed"><md-icon class="material-icons md-dark">reply</md-icon></md-button><md-button class="md-icon-button-lg" aria-label="'+$translate.instant("btn.replies-text")+'" ng-click="toggleReplies(comment, $event)" ng-if="comment.replies.length > 0"><md-icon class="material-icons md-dark">expand_more</md-icon> {{ comment.replies.length }}</md-button><md-button class="md-icon-button" aria-label="'+$translate.instant("btn.edit-text")+'" ng-click="editComment(comment.id, comment.text, $event)" ng-if="isMine(comment.user)"><md-icon class="material-icons md-green">edit</md-icon></md-button><md-button class="md-icon-button" aria-label="'+$translate.instant("btn.delete-text")+'" ng-click="deleteComment(comment, $event)" ng-if="isMine(comment.user)"><md-icon class="material-icons md-red">delete_forever</md-icon></md-button></md-card-icons-actions></md-card-actions><md-content id="replies-{{ comment.id }}"></md-content></md-card></div>')($scope)):$("#replies-"+comment.id).empty()},$scope.addComment=function(parent,ev){$mdDialog.show({controller:CommentProvider.openCommentDialog,templateUrl:"views/partials/comment-dialog.html",parent:angular.element(document.body),locals:{data:{text:""}},targetEvent:ev,clickOutsideToClose:!0}).then(function(answer){$rootScope.progressBarActivated=!0,$rootScope.errorMsg=!1,CommentService.create($scope.recipe.id,parent,answer,function(response){null===parent?$scope.comments.push(response.data):$scope.comments.getByIdWithParent(parent).replies.push(response.data),NotificationProvider.notify({title:$translate.instant("response.saved"),type:"success",addclass:"custom-success-notify",icon:"material-icons md-light",icon_class:"check_circle",styling:"fontawesome"}),$rootScope.progressBarActivated=!1},function(response){NOTIFICATION.ParseErrorResponse(response,[400,403,404],$translate,$rootScope,NotificationProvider),$rootScope.progressBarActivated=!1})},function(){})},$scope.editComment=function(id,text,ev){$mdDialog.show({controller:CommentProvider.openCommentDialog,templateUrl:"views/partials/comment-dialog.html",parent:angular.element(document.body),locals:{data:{text:text}},targetEvent:ev,clickOutsideToClose:!0}).then(function(answer){$rootScope.progressBarActivated=!0,$rootScope.errorMsg=!1,CommentService.edit($scope.recipe.id,id,answer,function(response){$scope.comments.getByIdWithParent(id).text=response.data.text,NotificationProvider.notify({title:$translate.instant("response.saved"),type:"success",addclass:"custom-success-notify",icon:"material-icons md-light",icon_class:"comment",styling:"fontawesome"}),$rootScope.progressBarActivated=!1},function(response){NOTIFICATION.ParseErrorResponse(response,[400,403,404],$translate,$rootScope,NotificationProvider),$rootScope.progressBarActivated=!1})},function(){})},$scope.deleteComment=function(comment,$event){var msg=$translate.instant("dialog.remove-comment"),confirm=$mdDialog.confirm().title($translate.instant("btn.delete-text")).htmlContent(nl2br(msg)).ariaLabel($translate.instant("btn.delete-text")).targetEvent($event).ok($translate.instant("btn.delete-text")).cancel($translate.instant("btn.cancel-text"));$mdDialog.show(confirm).then(function(){$rootScope.progressBarActivated=!0,$rootScope.errorMsg=!1,CommentService["delete"]($scope.recipe.id,comment.id,function(response){null===comment.parent?$scope.comments.removeById(comment.id):$scope.comments.getByIdWithParent(comment.parent.id).replies.removeById(comment.id),NotificationProvider.notify({title:response.data.msg,type:"success",addclass:"custom-success-notify",icon:"material-icons md-light",icon_class:"comment",styling:"fontawesome"}),$rootScope.progressBarActivated=!1},function(response){NOTIFICATION.ParseErrorResponse(response,[400,404],$translate,$rootScope,NotificationProvider),$rootScope.progressBarActivated=!1})},function(){})},$scope.isMine=function(user){if($rootScope.globals.user){var auth=$rootScope.globals.user;return auth.id==user.id&&auth.email==user.email&&auth.username==user.username||"ADMIN"==auth.type}return!1},$scope.searchByTag=function(tag){$location.path("/recipes").search({tag:tag})}}]),recipeController.controller("RecipeCreate",["$scope","$rootScope","$location","$timeout","$compile","$mdDialog","$translate","RecipeService","CategoryService","TagService","IngredientService","NotificationProvider","FileProvider","DIFF","VISIBILITY","EDIT_FUNCTIONS","NOTIFICATION",function($scope,$rootScope,$location,$timeout,$compile,$mdDialog,$translate,RecipeService,CategoryService,TagService,IngredientService,NotificationProvider,FileProvider,DIFF,VISIBILITY,EDIT_FUNCTIONS,NOTIFICATION){$rootScope.progressBarActivated=!0,$rootScope.HasBack=!0,$rootScope.back=function(){$location.path("/recipes")},EDIT_FUNCTIONS.LoadScope($scope,DIFF,VISIBILITY),EDIT_FUNCTIONS.CommonFunctions($scope,$rootScope,$location,$timeout,$compile,$mdDialog,$translate,RecipeService,CategoryService,TagService,IngredientService,NotificationProvider,FileProvider,DIFF,VISIBILITY,EDIT_FUNCTIONS,NOTIFICATION),RecipeService.getDraft(function(response){EDIT_FUNCTIONS.LoadRecipe($scope,$rootScope,$translate,RecipeService,CategoryService,NotificationProvider,NOTIFICATION,response)},function(response){NOTIFICATION.ParseErrorResponse(response,[],$translate,$rootScope,NotificationProvider),$rootScope.progressBarActivated=!1}),$scope.save=function(){$rootScope.progressBarActivated=!0,$rootScope.errorMsg=!1,$("html, body").animate({scrollTop:0},"slow");var recipeObj=angular.copy($scope.recipe);recipeObj.image_main&&(recipeObj.image_main=recipeObj.image_main.id),recipeObj.duration+=":00",recipeObj.new_tags=RecipeService.getNewTags(recipeObj.chipTags),recipeObj.tags=$.getArrayId(recipeObj.chipTags),recipeObj.files=$.getArrayId(recipeObj.files),RecipeService.edit(recipeObj,function(response){NotificationProvider.notify({title:$translate.instant("response.saved"),type:"success",addclass:"custom-success-notify",icon:"material-icons md-light",icon_class:"save",styling:"fontawesome"}),$rootScope.progressBarActivated=!1},function(response){NOTIFICATION.ParseErrorResponse(response,[400,401],$translate,$rootScope,NotificationProvider),$rootScope.progressBarActivated=!1})},$scope.publish=function($event){$rootScope.progressBarActivated=!0,$rootScope.errorMsg=!1,$("html, body").animate({scrollTop:0},"slow");var recipeObj=angular.copy($scope.recipe);recipeObj.image_main=recipeObj.image_main.id,recipeObj.duration+=":00",recipeObj.new_tags=RecipeService.getNewTags(recipeObj.chipTags),recipeObj.tags=$.getArrayId(recipeObj.chipTags),recipeObj.files=$.getArrayId(recipeObj.files),RecipeService.edit(recipeObj,function(response){$rootScope.progressBarActivated=!1;var msg=$translate.instant("dialog.publish",{title:recipeObj.title}),confirm=$mdDialog.confirm().title($translate.instant("btn.publish")).textContent(msg).ariaLabel($translate.instant("btn.publish")).targetEvent($event).openFrom({top:-50,width:50}).closeTo({top:50,width:50}).ok($translate.instant("btn.publish")).cancel($translate.instant("btn.cancel-text"));$mdDialog.show(confirm).then(function(){$rootScope.progressBarActivated=!0,RecipeService.createFromDraft(function(response){NotificationProvider.notify({title:$translate.instant("response.published"),type:"success",addclass:"custom-success-notify",icon:"material-icons md-light",icon_class:"publish",styling:"fontawesome"}),$location.path("/recipes/"+response.data.slug)},function(response){NOTIFICATION.ParseErrorResponse(response,[],$translate,$rootScope,NotificationProvider),$rootScope.progressBarActivated=!1})},function(){})},function(response){NOTIFICATION.ParseErrorResponse(response,[400,401],$translate,$rootScope,NotificationProvider),$rootScope.progressBarActivated=!1})}}]),recipeController.controller("RecipeEdit",["$scope","$rootScope","$location","$timeout","$compile","$routeParams","$mdDialog","$translate","RecipeService","CategoryService","TagService","IngredientService","NotificationProvider","FileProvider","DIFF","VISIBILITY","EDIT_FUNCTIONS","NOTIFICATION",function($scope,$rootScope,$location,$timeout,$compile,$routeParams,$mdDialog,$translate,RecipeService,CategoryService,TagService,IngredientService,NotificationProvider,FileProvider,DIFF,VISIBILITY,EDIT_FUNCTIONS,NOTIFICATION){$rootScope.progressBarActivated=!0,$rootScope.HasBack=!0,$rootScope.back=function(){$location.path("/recipes")},EDIT_FUNCTIONS.LoadScope($scope,DIFF,VISIBILITY),EDIT_FUNCTIONS.CommonFunctions($scope,$rootScope,$location,$timeout,$compile,$mdDialog,$translate,RecipeService,CategoryService,TagService,IngredientService,NotificationProvider,FileProvider,DIFF,VISIBILITY,EDIT_FUNCTIONS,NOTIFICATION),RecipeService.get($routeParams.slug,function(response){EDIT_FUNCTIONS.LoadRecipe($scope,$rootScope,$translate,RecipeService,CategoryService,NotificationProvider,NOTIFICATION,response)},function(response){NOTIFICATION.ParseErrorResponse(response,[404],$translate,$rootScope,NotificationProvider),$rootScope.progressBarActivated=!1}),$scope.edit=function(){$rootScope.progressBarActivated=!0,$rootScope.errorMsg=!1,$("html, body").animate({scrollTop:0},"slow");var recipeObj=angular.copy($scope.recipe);recipeObj.image_main&&(recipeObj.image_main=recipeObj.image_main.id),recipeObj.duration+=":00",recipeObj.new_tags=RecipeService.getNewTags(recipeObj.chipTags),recipeObj.tags=$.getArrayId(recipeObj.chipTags),recipeObj.files=$.getArrayId(recipeObj.files),RecipeService.edit(recipeObj,function(response){NotificationProvider.notify({title:$translate.instant("response.saved"),type:"success",addclass:"custom-success-notify",icon:"material-icons md-light",icon_class:"save",styling:"fontawesome"}),$rootScope.progressBarActivated=!1},function(response){NOTIFICATION.ParseErrorResponse(response,[400,401],$translate,$rootScope,NotificationProvider),$rootScope.progressBarActivated=!1})}}]);var userController=angular.module("UserController",[]);userController.constant("FRIENDS_FUNCTIONS",{AddFriend:function($rootScope,$translate,UserService,NotificationProvider,NOTIFICATION,currentUser,user,callback){$rootScope.progressBarActivated=!0,$rootScope.errorMsg=!1,UserService.addFriend(currentUser.id,user.id,function(response){NotificationProvider.notify({title:$translate.instant("friend.added",{name:user.first_name+" "+user.last_name}),type:"success",addclass:"custom-success-notify",icon:"material-icons md-light",icon_class:"check_circle",styling:"fontawesome"}),$rootScope.progressBarActivated=!1,callback()},function(response){NOTIFICATION.ParseErrorResponse(response,[400],$translate,$rootScope,NotificationProvider),$rootScope.progressBarActivated=!1})},DeleteFriend:function($rootScope,$translate,UserService,NotificationProvider,NOTIFICATION,currentUser,user,callback){$rootScope.progressBarActivated=!0,$rootScope.errorMsg=!1,UserService.deleteFriend(currentUser.id,user.id,function(response){NotificationProvider.notify({title:$translate.instant("friend.deleted",{name:user.first_name+" "+user.last_name}),type:"success",addclass:"custom-success-notify",icon:"material-icons md-light",icon_class:"check_circle",styling:"fontawesome"}),$rootScope.progressBarActivated=!1,callback()},function(response){NOTIFICATION.ParseErrorResponse(response,[400],$translate,$rootScope,NotificationProvider),$rootScope.progressBarActivated=!1})}}),userController.constant("USER_FUNCTIONS",{Users:function($scope){$scope.users=[],$scope.searchText="",$scope.total=1,$scope.nextPageNumber=1,$scope.hasError=!1,$scope.loadingNextPage=!1,$scope.reloadUsers=function(){$scope.users=[],$scope.total=1,$scope.nextPageNumber=1,$scope.hasError=!1,$scope.getUsers()},$scope.$watch(function(){return $scope.searchText},function(newVal,oldVal){$scope.reloadUsers()}),$scope.nextPage=function(){$scope.total>$scope.users.length&&!$scope.loadingNextPage&&!$scope.hasError&&$scope.getUsers()}},Recipes:function($scope,$rootScope,$translate,$mdDialog,userId,UserService,RecipeService,NotificationProvider,NOTIFICATION){$scope.loadUserRecipes=function(){$rootScope.progressBarActivated=!0,$rootScope.errorMsg=!1,$scope.infiniteScroll.recipes.loadingNextPage=!0,UserService.getRecipes(userId,{page:$scope.infiniteScroll.recipes.nextPageNumber,size:10},function(response){$scope.infiniteScroll.recipes.data=$scope.infiniteScroll.recipes.data.concat(response.data.data),$scope.infiniteScroll.recipes.total=response.data.total,$rootScope.progressBarActivated=!1,$scope.infiniteScroll.recipes.nextPageNumber++,$scope.infiniteScroll.recipes.loadingNextPage=!1},function(response){NOTIFICATION.ParseErrorResponse(response,[],$translate,$rootScope,NotificationProvider),$rootScope.progressBarActivated=!1,$scope.infiniteScroll.recipes.hasError=!0})},$scope.nextPageRecipes=function(){$scope.infiniteScroll.recipes.total>$scope.infiniteScroll.recipes.data.length&&!$scope.infiniteScroll.recipes.loadingNextPage&&!$scope.infiniteScroll.recipes.hasError&&$scope.loadUserRecipes()},$scope.reloadUserRecipes=function(){$scope.infiniteScroll.recipes.data=[],$scope.infiniteScroll.recipes.total=1,$scope.infiniteScroll.recipes.nextPageNumber=1,$scope.infiniteScroll.recipes.hasError=!1,$scope.loadUserRecipes()},$scope.removeRecipe=function(recipe,$event){$event.stopPropagation&&$event.stopPropagation(),$event.preventDefault&&$event.preventDefault(),$event.cancelBubble=!0,$event.returnValue=!1;var msg=$translate.instant("dialog.remove-recipe",{title:recipe.title}),confirm=$mdDialog.confirm().title($translate.instant("btn.delete-text")).htmlContent(nl2br(msg)).ariaLabel($translate.instant("btn.delete-text")).targetEvent($event).ok($translate.instant("btn.delete-text")).cancel($translate.instant("btn.cancel-text"));$mdDialog.show(confirm).then(function(){$rootScope.progressBarActivated=!0,$rootScope.errorMsg=!1,RecipeService["delete"](recipe.id,function(response){NotificationProvider.notify({title:response.data.msg,type:"success",addclass:"custom-success-notify",icon:"material-icons md-light",icon_class:"check_circle",styling:"fontawesome"}),$rootScope.progressBarActivated=!1,$scope.reloadUserRecipes()},function(response){NOTIFICATION.ParseErrorResponse(response,[404],$translate,$rootScope,NotificationProvider),$rootScope.progressBarActivated=!1})},function(){})}},RecipesFavorites:function($scope,$rootScope,$translate,$mdDialog,userId,UserService,RecipeService,NotificationProvider,NOTIFICATION){$scope.loadUserRecipesFavorites=function(){$rootScope.progressBarActivated=!0,$rootScope.errorMsg=!1,$scope.infiniteScroll.recipesFavorites.loadingNextPage=!0,UserService.getRecipesFavorites(userId,{page:$scope.infiniteScroll.recipesFavorites.nextPageNumber,size:10},function(response){$scope.infiniteScroll.recipesFavorites.data=$scope.infiniteScroll.recipesFavorites.data.concat(response.data.data),$scope.infiniteScroll.recipesFavorites.total=response.data.total,$rootScope.progressBarActivated=!1,$scope.infiniteScroll.recipesFavorites.nextPageNumber++,$scope.infiniteScroll.recipesFavorites.loadingNextPage=!1},function(response){NOTIFICATION.ParseErrorResponse(response,[],$translate,$rootScope,NotificationProvider),$rootScope.progressBarActivated=!1,$scope.infiniteScroll.recipesFavorites.hasError=!0})},$scope.nextPageRecipesFavorites=function(){$scope.infiniteScroll.recipesFavorites.total>$scope.infiniteScroll.recipesFavorites.data.length&&!$scope.infiniteScroll.recipesFavorites.loadingNextPage&&!$scope.infiniteScroll.recipesFavorites.hasError&&$scope.loadUserRecipesFavorites()},$scope.reloadUserRecipesFavorites=function(){$scope.infiniteScroll.recipesFavorites.data=[],$scope.infiniteScroll.recipesFavorites.total=1,$scope.infiniteScroll.recipesFavorites.nextPageNumber=1,$scope.infiniteScroll.recipesFavorites.hasError=!1,$scope.loadUserRecipesFavorites()},$scope.removeFavorite=function(recipe,$event){$event.stopPropagation&&$event.stopPropagation(),$event.preventDefault&&$event.preventDefault(),$event.cancelBubble=!0,$event.returnValue=!1,$rootScope.progressBarActivated=!0,$rootScope.errorMsg=!1,RecipeService.toggleFav(recipe.id,function(response){NotificationProvider.notify({title:$translate.instant("response.saved"),type:"error",addclass:"custom-success-notify",icon:"material-icons md-light",icon_class:"favorite_border",styling:"fontawesome"}),$rootScope.progressBarActivated=!1,$scope.reloadUserRecipesFavorites()},function(response){NOTIFICATION.ParseErrorResponse(response,[],$translate,$rootScope,NotificationProvider),$rootScope.progressBarActivated=!1})}},Friends:function($scope,$rootScope,$translate,userId,UserService,NotificationProvider,FRIENDS_FUNCTIONS,NOTIFICATION){$scope.loadFriends=function(){$rootScope.progressBarActivated=!0,$scope.infiniteScroll.friends.loadingNextPage=!0,UserService.getFriends(userId,{page:$scope.infiniteScroll.friends.nextPageNumber,size:10,order:"firstName"},function(response){$scope.infiniteScroll.friends.data=$scope.infiniteScroll.friends.data.concat(response.data.data),$scope.infiniteScroll.friends.total=response.data.total,$rootScope.progressBarActivated=!1,$scope.infiniteScroll.friends.nextPageNumber++,$scope.infiniteScroll.friends.loadingNextPage=!1},function(response){NOTIFICATION.ParseErrorResponse(response,[],$translate,$rootScope,NotificationProvider),$rootScope.progressBarActivated=!1,$scope.infiniteScroll.friends.hasError=!0})},$scope.nextPageFriends=function(){$scope.infiniteScroll.friends.total>$scope.infiniteScroll.friends.data.length&&!$scope.infiniteScroll.friends.loadingNextPage&&!$scope.infiniteScroll.friends.hasError&&$scope.loadFriends()},$scope.reloadFriends=function(){$scope.infiniteScroll.friends.data=[],$scope.infiniteScroll.friends.total=1,$scope.infiniteScroll.friends.nextPageNumber=1,$scope.infiniteScroll.friends.hasError=!1,$scope.loadFriends()},$scope.addFriend=function(user,$event){$event.stopPropagation&&$event.stopPropagation(),$event.preventDefault&&$event.preventDefault(),$event.cancelBubble=!0,$event.returnValue=!1,FRIENDS_FUNCTIONS.AddFriend($rootScope,$translate,UserService,NotificationProvider,NOTIFICATION,$rootScope.globals.user,user,$scope.loadPersonalData)},$scope.deleteFriend=function(user,$event){
$event.stopPropagation&&$event.stopPropagation(),$event.preventDefault&&$event.preventDefault(),$event.cancelBubble=!0,$event.returnValue=!1,FRIENDS_FUNCTIONS.DeleteFriend($rootScope,$translate,UserService,NotificationProvider,NOTIFICATION,$rootScope.globals.user,user,$scope.loadPersonalData),$scope.reloadFriends()}}}),userController.controller("UserAll",["$scope","$rootScope","$translate","UserService","NotificationProvider","USER_FUNCTIONS","NOTIFICATION",function($scope,$rootScope,$translate,UserService,NotificationProvider,USER_FUNCTIONS,NOTIFICATION){USER_FUNCTIONS.Users($scope),$scope.getUsers=function(){$scope.loadingNextPage=!0,$rootScope.errorMsg=!1,$scope.loadingNextPage=!0,UserService.search({page:$scope.nextPageNumber,size:10,order:"firstName",search:$scope.searchText},function(response){var responseData=response.data;$scope.users=$scope.users.concat(responseData.data),$scope.nextPageNumber++,$scope.total=responseData.total,$scope.loadingNextPage=!1,$rootScope.progressBarActivated=!1},function(response){NOTIFICATION.ParseErrorResponse(response,[],$translate,$rootScope,NotificationProvider),$scope.hasError=!0,$scope.loadingNextPage=!1,$rootScope.progressBarActivated=!1})}}]),userController.controller("UserShow",["$scope","$rootScope","$location","$routeParams","$timeout","$mdDialog","$translate","UserService","RecipeService","NotificationProvider","USER_FUNCTIONS","FRIENDS_FUNCTIONS","NOTIFICATION","DELAY_FUNCTIONS",function($scope,$rootScope,$location,$routeParams,$timeout,$mdDialog,$translate,UserService,RecipeService,NotificationProvider,USER_FUNCTIONS,FRIENDS_FUNCTIONS,NOTIFICATION,DELAY_FUNCTIONS){$rootScope.HasBack=!0,$scope.commentsActived=!1,$scope.infiniteScroll={recipes:{data:[],total:1,nextPageNumber:1,loadingNextPage:!1,hasError:!1},recipesFavorites:{data:[],total:1,nextPageNumber:1,loadingNextPage:!1,hasError:!1},friends:{data:[],total:1,nextPageNumber:1,loadingNextPage:!1,hasError:!1}},$rootScope.back=function(){$location.path("/users")},DELAY_FUNCTIONS.initDelays($scope,$timeout),$scope.isMe=function(user){return void 0!==user&&$rootScope.globals.user.id==user.id},$scope.checkFriend=function(user){var i=0;if(void 0!==user)for(;i<user.friends.length;){if(user.friends[i].user_id===$rootScope.globals.user.id)return!0;i++}return!1},$scope.loadPersonalData=function(){$rootScope.progressBarActivated=!0,$rootScope.errorMsg=!1,$scope.setDelay1(),UserService.get($routeParams.id,function(response){$scope.user=response.data,$scope.header_title={name:$.getFullName($scope.user)},$rootScope.progressBarActivated=!1,$scope.setDelay2()},function(response){NOTIFICATION.ParseErrorResponse(response,[404],$translate,$rootScope,NotificationProvider),$rootScope.progressBarActivated=!1,$scope.setDelay2()})},$scope.addFriendHome=function(user){FRIENDS_FUNCTIONS.AddFriend($rootScope,$translate,UserService,NotificationProvider,NOTIFICATION,$rootScope.globals.user,user,$scope.loadPersonalData)},$scope.deleteFriendHome=function(user){FRIENDS_FUNCTIONS.DeleteFriend($rootScope,$translate,UserService,NotificationProvider,NOTIFICATION,$rootScope.globals.user,user,$scope.loadPersonalData)},USER_FUNCTIONS.Recipes($scope,$rootScope,$translate,$mdDialog,$routeParams.id,UserService,RecipeService,NotificationProvider,NOTIFICATION),USER_FUNCTIONS.RecipesFavorites($scope,$rootScope,$translate,$mdDialog,$routeParams.id,UserService,RecipeService,NotificationProvider,NOTIFICATION),USER_FUNCTIONS.Friends($scope,$rootScope,$translate,$routeParams.id,UserService,NotificationProvider,FRIENDS_FUNCTIONS,NOTIFICATION)}]),userController.controller("FriendAll",["$scope","$rootScope","$translate","UserService","NotificationProvider","USER_FUNCTIONS","NOTIFICATION",function($scope,$rootScope,$translate,UserService,NotificationProvider,USER_FUNCTIONS,NOTIFICATION){$rootScope.headerTitle="Amigos",USER_FUNCTIONS.Users($scope),$scope.getUsers=function(){$scope.loadingNextPage=!0,$rootScope.errorMsg=!1,$scope.loadingNextPage=!0,UserService.getFriends($rootScope.globals.user.id,{page:$scope.nextPageNumber,size:10,order:"firstName",search:$scope.searchText},function(response){var responseData=response.data;$scope.users=$scope.users.concat(responseData.data),$scope.nextPageNumber++,$scope.total=responseData.total,$scope.loadingNextPage=!1,$rootScope.progressBarActivated=!1},function(response){NOTIFICATION.ParseErrorResponse(response,[],$translate,$rootScope,NotificationProvider),$scope.hasError=!0,$scope.loadingNextPage=!1,$rootScope.progressBarActivated=!1})}}]);var animationModule=angular.module("Animations",[]);animationModule.animation(".animation-card-recipes, .animation-card-users",function(){return{enter:function(element,done){return element.css({opacity:0}),jQuery(element).animate({opacity:1},done),function(isCancelled){isCancelled&&jQuery(element).stop()}},leave:function(element,done){return element.css("opacity",1),jQuery(element).animate({opacity:0},done),function(isCancelled){isCancelled&&jQuery(element).stop()}},move:function(element,done){return element.css("opacity",0),jQuery(element).animate({opacity:1},done),function(isCancelled){isCancelled&&jQuery(element).stop()}},addClass:function(element,className,done){},removeClass:function(element,className,done){}}});var internationalizationModule=angular.module("Internationalization",[]);recetarium.config(["$translateProvider",function($translateProvider){$translateProvider.translations("en",{"login.header-title":"Welcome!","login.btn-register":"Don't you have account? Sign up","login.btn-recover":"Do you forgive your password?","register.header-title":"Sign up","register.btn-sign-up":"Sign up","register.btn-login":"Do you have an account? Sign in","register.thanks-title":"Thanks for sign up","register.thanks-text":"We have sent you an email to validate your account.","logout.title":"Logout","logout.text":"See you soon.","reset.header-title":"Reset your password","reset.btn-send":"Send email","reset.btn-login":"Do you remember? Sign in","recover.header-title":"Reset your password","recover.btn-send":"Change password","recover.changed":"Password changed successfully","active.header-title":"Activating account","active.actived":"Account activated successfully","profile.header-title":"Your profile","profile.personal-data-title":"Personal data","profile.password-title":"Change password","profile.recipes-title":"Your recipes","profile.fav-title":"Your favorite recipes","profile.images-title":"Your images","profile.image-text-uploaded":"Image uploaded ","profile.image-text-count-main":"N of times used as main:","profile.image-text-count-extra":"N of times used as extra:","profile.image-text-count-total":"N total of times used:","profile.friends-title":"Your friends","user.header-title":"{{ name }} profile","user.personal-data-title":"Personal data","user.recipes-title":"Published recipes","user.fav-title":"Favorite recipes","user.friends-title":"Friends","categories.header-title":"Categories","categories.field-name":"Name","categories.field-recipes":"N Recipes","settings.header-title":"Settings","settings.password-title":"Change password","settings.language-title":"Change language","settings.language-spanish":"Spanish","settings.language-english":"English","friend.added":"You have added  '{{ name }}' as friend.","friend.deleted":"You have deleted '{{ name }}' as friend.","menu.recipes":"Recipes","menu.last-recipes":"Last recipes","menu.top-recipes":"Top recipes","menu.users":"Users","menu.all-users":"All the users","menu.friends":"Friends","menu.write-recipe":"Write a new recipe","menu.profile":"Profile","menu.salutation":"Hi","menu.settings":"Settings","menu.categories":"Categories","menu.logout":"Logout","menu.login":"Sign in/up","menu.motto":"Recetarium: Your recipes always with you.","recipe-create.header-title":"New recipe (draft)","recipe-edit.header-title":"Edit recipe","dropzone.text":"Drag and drop the images here","dialog-select.header-title":"Select an image","dialog-select.title-1":"Select one of your images ...","dialog-select.title-2":"... or upload a new image","dialog-upload.header-title":"Upload a new image","dialog.remove-image-1":"Do you really want to delete the image '{{ title }}'?<br>This action can't be undo.","dialog.remove-image-2":"The image disappears from all recipes","dialog.remove-recipe":"Do you really want to delete the recipe '{{ title }}'?<br>This action can't be undo.","dialog.remove-categories":"Do  you really want to delete {{ total }} categories?<br>This action can't be undo.<br>All recipes will be updated without category.","dialog.remove-comment":"Do you really want to delete the comment?<br>This action can't be undo.<br>The replies also will be deleted.","dialog.publish":"Do you want publish the recipe '{{ title }}'?","dialog-comment.header-title":"Write a comment","dialog-rating.header-title":"Rate the recipe","dialog-category.header-title":"Write the name","comment.last-update":"Last modification","comment.created-at":"Created","share.title":"Do you see the recipe '{{ title }}'?","share.body":"Check it out: {{ url }}","btn.delete-text":"Delete","btn.cancel-text":"Cancel","btn.confirm-text":"Accept","btn.edit-text":"Edit","btn.save-text":"Save","btn.replies-text":"Replies","btn.comment-text":"Comment","btn.save-draft":"Save draft","btn.publish":"Publish","btn.send-text":"Send","btn.add-friend-text":"Add to your friends","btn.delete-friend-text":"Delete from your friends","btn.select-images":"Select your images for this recipe","btn.write-comment":"Write a comment","response.saved":"Saved","response.published":"Published","response.added":"Added","response.deleted":"Deleted","form.error-required":"This field is required.","form.error-password":"The password must be equals.","form.error-email":"Your email must be between 10 and 100 characters long and look like an e-mail address.","form.error-comment-length":"The comment must be of 140 characters of less.","form.error-slug":"This slug already exists. You can enter a new one or replace it, or change the recipe title for self-generate a new.","form.error-duration":"The duration should be more than 1 min.","error.400.title":"Wrong data","error.401.title":"Unauthorized","error.403.title":"Forbidden","error.500.title":"Something went wrong. Please, try it later.","tooltip.image-used-text":"The image is used in some recipe as main","tooltip.select-image":"Click the image to select another","tooltip.search-tag":"Search a tag","tooltip.search-category":"Select a category","tooltip.slug-info":"The 'slug' is a descriptive phrase that extracted of recipe title for use in the web address. It does not affect any of the content.","tooltip.show-comments":"Show the comments.","placeholder.search":"Search","field.first-name":"First name","field.last-name":"Last name","field.image-main":"Image main","field.text":"Text","field.title":"Title","field.name":"Name","field.count":"Count","field.duration":"Duration","field.num-persons":"N persons","field.difficulty":"Difficulty","field.visibility":"Visibility","field.category":"Category","field.ingredients":"Ingredients","field.steps":"Steps","field.images":"Images","field.password":"Password","field.comment":"Comment","field.fav":"Favorites","field.password-repeat":"Confirm password","field.remember-me":"Remember me","field.required-text":"The fields with * are <u>required</u>.","field.username":"Username","conjuntion.and":"and","pagination.page":"Page:","pagination.rows-per-page":"Rows per page:","pagination.of":"of","selected.item":"row selected","selected.items":"rows selected","humanized.EASY":"Easy","humanized.MEDIUM":"Medium","humanized.HARD":"Hard","humanized.PUBLIC":"Public","humanized.FRIENDS":"Only friends","humanized.PRIVATE":"Private"}),$translateProvider.translations("es",{"login.header-title":"Bienvenido de nuevo!","login.btn-register":"No tienes cuenta? Regstrate","login.btn-recover":"Has olvidado tu contrasea?","register.header-title":"Regstrate","register.btn-sign-up":"Registro","register.btn-login":"Tienes cuenta? Logueate","register.thanks-title":"Gracias por registrarte","register.thanks-text":"Te hemos enviado un email para validar tu cuenta.","logout.title":"Adios","logout.text":"Nos vemos luego.","reset.header-title":"Resetea tu contrasea","reset.btn-send":"Enviar email","reset.btn-login":"Te acuerdas? Logueate","recover.header-title":"Resetea tu contrasea","recover.btn-send":"Cambiar contrasea","recover.changed":"Contrasea cambiada con xito","active.header-title":"Activando cuenta","active.actived":"Cuenta activada con xito","profile.header-title":"Tu perfil","profile.personal-data-title":"Datos personales","profile.password-title":"Cambiar contrasea","profile.recipes-title":"Tus recetas","profile.fav-title":"Tus recetas favoritas","profile.images-title":"Tus imgenes","profile.image-text-uploaded":"Imagen subida el","profile.image-text-count-main":"N veces usada como principal:","profile.image-text-count-extra":"N veces usada como extra:","profile.image-text-count-total":"N total de veces usada:","profile.friends-title":"Tus amigos","settings.header-title":"Configuracin","settings.password-title":"Cambiar contrasea","settings.language-title":"Cambiar idioma","settings.language-spanish":"Espaol","settings.language-english":"Ingls","user.header-title":"Perfil de {{ name }}","user.personal-data-title":"Datos personales","user.recipes-title":"Recetas publicadas","user.fav-title":"Recetas favoritas","user.friends-title":"Amigos","categories.header-title":"Categorias","categories.field-name":"Nombre","categories.field-recipes":"N Recetas","friend.added":"Has aadido a '{{ name }}' como amigo.","friend.deleted":"Has borrado a '{{ name }}' como amigo.","recipe-create.header-title":"Nueva receta (borrador)","recipe-edit.header-title":"Editar receta","menu.recipes":"Recetas","menu.last-recipes":"ltimas recetas","menu.top-recipes":"Top recetas","menu.users":"Usuarios","menu.all-users":"Todos los usuarios","menu.friends":"Amigos","menu.write-recipe":"Escribe una receta","menu.profile":"Perfil","menu.salutation":"Hola","menu.settings":"Configuracin","menu.categories":"Categorias","menu.logout":"Logout","menu.login":"Login / Registro","menu.motto":"Recetarium: Tus recetas siempre contigo.","dropzone.text":"Arrastra y suelta las imgenes aqu","dialog-select.header-title":"Elige una imagen","dialog-select.title-1":"Elige una de tus imgenes ...","dialog-select.title-2":"... o sube una nueva imagen","dialog-upload.header-title":"Sube una nueva imagen","dialog.remove-image-1":"De verdad que quieres borrar la imagen '{{ title }}'?<br>Esta accin no se puede deshacer.","dialog.remove-image-2":"La imagen desaparecer de todas las recetas","dialog.remove-recipe":"De verdad que quieres borrar la receta '{{ title }}'?<br>Esta accin no se puede deshacer.","dialog.remove-categories":"De verdad que quieres borrar {{ total }} categorias?<br>Esta accin no se puede deshacer.<br>Todas las recetas se modificarn sin categoria","dialog.remove-comment":"De verdad que quieres borrar el comentario?<br>Esta accin no se puede deshacer.<br>Se borrarn las respuestas.","dialog.publish":"Quieres publicar la receta '{{ title }}'?","dialog-comment.header-title":"Escribe un comentario","dialog-rating.header-title":"Punta la receta","dialog-category.header-title":"Escribe el nombre","comment.last-update":"Ultima modificacin el","comment.created-at":"Creado el","share.title":"Has visto la receta '{{ title }}'?","share.body":"chale un vistazo: {{ url }}","btn.delete-text":"Borrar","btn.cancel-text":"Cancelar","btn.confirm-text":"Aceptar","btn.save-text":"Guardar","btn.replies-text":"Respuestas","btn.comment-text":"Comentar","btn.save-draft":"Guardar borrador","btn.publish":"Publicar","btn.edit-text":"Editar","btn.send-text":"Enviar","btn.add-friend-text":"Aadir a tus amigos","btn.delete-friend-text":"Borrar de tus amigos","btn.select-images":"Elige tus imgenes para esta receta","btn.write-comment":"Escribe un comentario","response.saved":"Guardado","response.published":"Publicada","response.added":"Aadido","response.deleted":"Borrado","form.error-required":"Este campo es obligatorio.","form.error-password":"Las contraseas deben coincidir.","form.error-email":"Tu email debe tener entre 10 y 100 caracteres y parecerse a una direccin de e-mail.","form.error-comment-length":"El comentario debe ser de 140 carcteres o menos.","form.error-slug":"El slug ya existe. Puedes introducir uno nuevo o cambiarlo por otro, o cambiar el ttulo de la receta para autogenerar otro nuevo.","form.error-duration":"La duracin debe de ser de ms de 1 min.","error.400.title":"Datos incorrectos","error.401.title":"No autorizado","error.403.title":"Acceso prohibido","error.500.title":"Ha ocurrido un error. Por favor, intentelo ms tarde.","tooltip.image-used-text":"La imagen se usa en alguna receta como principal","tooltip.select-image":"Haz click en la imagen para elegir otra","tooltip.search-tag":"Busca una etiqueta","tooltip.search-category":"Selecciona una categora","tooltip.slug-info":"El 'slug' es una frase descriptiva extraida del ttulo de la receta para usarla en la direccion web. No afecta a nada del contenido.","tooltip.show-comments":"Mostrar los comentarios.","placeholder.search":"Buscar","field.first-name":"Nombre completo","field.last-name":"Apellidos","field.image-main":"Imagen principal","field.text":"Texto","field.title":"Ttulo","field.name":"Nombre","field.count":"Cantidad","field.duration":"Duracin","field.num-persons":"N personas","field.difficulty":"Dificultad","field.visibility":"Visibilidad","field.category":"Categora","field.ingredients":"Ingredientes","field.steps":"Pasos","field.images":"Imgenes","field.comment":"Comentario","field.fav":"Favoritos","field.password":"Contrasea","field.password-repeat":"Confirmar contrasea","field.remember-me":"Recordar sesin","field.required-text":"Los campos con * son <u>requeridos</u>.","field.username":"Nombre del usuario","conjuntion.and":"y","pagination.page":"Pgina:","pagination.rows-per-page":"Filas por pgina:","pagination.of":"de","selected.item":"fila seleccionada","selected.items":"filas seleccionadas","humanized.EASY":"Fcil","humanized.MEDIUM":"Media","humanized.HARD":"Difcil","humanized.PUBLIC":"Pblica","humanized.FRIENDS":"Solo amigos","humanized.PRIVATE":"Privada"}),$translateProvider.registerAvailableLanguageKeys(["en","es"],{"en_*":"en","es_*":"es"}),$translateProvider.useSanitizeValueStrategy("sanitize"),$translateProvider.determinePreferredLanguage()}]),function(){function createSvgElement(name){return document.createElementNS(svgNS,name)}function leadingZero(num){return(num<10?"0":"")+num}function uniqueId(prefix){var id=++idCounter+"";return prefix?prefix+id:id}function LolliClock(element,options){function mousedown(e){var offset=plate.offset(),isTouch=/^touch/.test(e.type),x0=offset.left+dialRadius,y0=offset.top+dialRadius,dx=(isTouch?e.originalEvent.touches[0]:e).pageX-x0,dy=(isTouch?e.originalEvent.touches[0]:e).pageY-y0,z=Math.sqrt(dx*dx+dy*dy),moved=!1;if(outsideMode=!0,z<outSizeRadius+tickRadius&&z>outSizeRadius-tickRadius)outsideMode=!0;else{if(!(z>radius-tickRadius&&z<radius+tickRadius&&options.hour24&&"hours"===self.currentView))return;outsideMode=!1}e.preventDefault(),$(document.body).addClass("lolliclock-moving"),plate.append(self.canvas),self.setHand(dx,dy,outsideMode),$(document).off(mousemoveEvent).on(mousemoveEvent,function(e){e.preventDefault();var isTouch=/^touch/.test(e.type),x=(isTouch?e.originalEvent.touches[0]:e).pageX-x0,y=(isTouch?e.originalEvent.touches[0]:e).pageY-y0;(moved||x!==dx||y!==dy)&&(moved=!0,self.setHand(x,y,outsideMode))}),$(document).off(mouseupEvent).on(mouseupEvent,function(e){e.preventDefault();var isTouch=/^touch/.test(e.type),x=(isTouch?e.originalEvent.changedTouches[0]:e).pageX-x0,y=(isTouch?e.originalEvent.changedTouches[0]:e).pageY-y0;x===dx&&y===dy&&self.setHand(x,y,outsideMode),"hours"===self.currentView?self.toggleView("minutes",duration/2):options.autoclose&&self.done(),plate.prepend(canvas),$(document.body).removeClass("lolliclock-moving"),$(document).off(mousemoveEvent),$(document).off(mouseupEvent)})}var popover=$(tpl),plate=popover.find(".lolliclock-plate"),hoursView=popover.find(".lolliclock-dial-hours"),minutesView=popover.find(".lolliclock-dial-minutes"),isInput="INPUT"===element.prop("tagName"),input=isInput?element:element.find("input"),self=this;if(this.id=uniqueId("lolli"),this.element=element,this.options=options,this.isAppended=!1,this.isShown=!1,this.currentView="hours",this.isInput=isInput,this.input=input,this.popover=popover,this.plate=plate,this.hoursView=hoursView,this.minutesView=minutesView,this.header=popover.find(".lolliclock-header"),this.spanHours=popover.find(".lolliclock-hours"),this.spanMinutes=popover.find(".lolliclock-minutes"),this.spanNewTime=popover.find(".lolliclock-time-new"),this.spanOldTime=popover.find(".lolliclock-time-old"),this.spanAmPm=popover.find(".lolliclock-am-pm"),this.amOrPm="PM",this.AmPmButtons=popover.find(".lolliclock-ampm-btn"),this.amButton=popover.find("#lolliclock-btn-am"),this.pmButton=popover.find("#lolliclock-btn-pm"),this.options.hour24&&(this.AmPmButtons.hide(),this.spanAmPm.hide()),!options.autoclose){this.popover.css("height","380px");var $closeButtons=$('<div class="lolliclock-buttons"></div>').appendTo(popover);$('<div class="lolliclock-button">Cancel</div>').click($.proxy(this.hide,this)).appendTo($closeButtons),$('<div class="lolliclock-button">OK</div>').click($.proxy(this.done,this)).appendTo($closeButtons),this.closeButtons=popover.find(".lolliclock-button")}input.on("focus.lolliclock click.lolliclock",$.proxy(this.show,this));var i,tick,radian,tickTpl=$('<div class="lolliclock-tick"></div>');if(options.hour24){for(i=1;i<13;i++)tick=tickTpl.clone(),radian=i/6*Math.PI,tick.css({left:dialRadius+Math.sin(radian)*radius-tickRadius,top:dialRadius-Math.cos(radian)*radius-tickRadius}),tick.html(i),hoursView.append(tick);for(i=13;i<=24;i++)tick=tickTpl.clone(),radian=i/6*Math.PI,tick.css({left:dialRadius+Math.sin(radian)*outSizeRadius-tickRadius,top:dialRadius-Math.cos(radian)*outSizeRadius-tickRadius}),24===i?tick.html("00"):tick.html(i),hoursView.append(tick)}else for(i=1;i<13;i++)tick=tickTpl.clone(),radian=i/6*Math.PI,tick.css({left:dialRadius+Math.sin(radian)*outSizeRadius-tickRadius,top:dialRadius-Math.cos(radian)*outSizeRadius-tickRadius}),tick.html(i),hoursView.append(tick);for(i=0;i<60;i+=5)tick=tickTpl.clone(),radian=i/30*Math.PI,tick.css({left:dialRadius+Math.sin(radian)*outSizeRadius-tickRadius,top:dialRadius-Math.cos(radian)*outSizeRadius-tickRadius}),tick.html(leadingZero(i)),minutesView.append(tick);plate.on(mousedownEvent,mousedown);var canvas=popover.find(".lolliclock-canvas"),svg=createSvgElement("svg");svg.setAttribute("class","lolliclock-svg"),svg.setAttribute("width",diameter),svg.setAttribute("height",diameter);var g=createSvgElement("g");g.setAttribute("transform","translate("+dialRadius+","+dialRadius+")");var bearing=createSvgElement("circle");bearing.setAttribute("class","lolliclock-bearing"),bearing.setAttribute("cx",0),bearing.setAttribute("cy",0),bearing.setAttribute("r",1.25);var hand=createSvgElement("line");hand.setAttribute("x1",0),hand.setAttribute("y1",0);var bg=createSvgElement("circle");bg.setAttribute("class","lolliclock-canvas-bg"),bg.setAttribute("r",tickRadius);var fg=createSvgElement("circle");fg.setAttribute("class","lolliclock-canvas-fg"),fg.setAttribute("r",3.5),g.appendChild(hand),g.appendChild(bg),g.appendChild(fg),g.appendChild(bearing),svg.appendChild(g),canvas.append(svg),this.hand=hand,this.bg=bg,this.fg=fg,this.bearing=bearing,this.g=g,this.canvas=canvas,raiseCallback(this.options.init)}function raiseCallback(callbackFunction){callbackFunction&&"function"==typeof callbackFunction&&callbackFunction()}var $=window.jQuery;LolliClock.DEFAULTS={startTime:"",autoclose:!1,vibrate:!0,hour24:!1};var touchSupported="ontouchstart"in window,mousedownEvent="mousedown"+(touchSupported?" touchstart":""),mousemoveEvent="mousemove.lolliclock"+(touchSupported?" touchmove.lolliclock":""),mouseupEvent="mouseup.lolliclock"+(touchSupported?" touchend.lolliclock":""),vibrate=navigator.vibravarte?"vibrate":navigator.webkitVibrate?"webkitVibrate":null,svgNS="http://www.w3.org/2000/svg",idCounter=0,dialRadius=84,radius=50,outSizeRadius=70,tickRadius=12,diameter=2*dialRadius,duration=350,tpl=['<div class="lolliclock-popover">','<div class="lolliclock-header">','<div class="lolliclock-time">','<div class="lolliclock-hours lolliclock-primary-text">','<div class="lolliclock-time-old"></div>','<div class="lolliclock-time-new"></div>',"</div>",'<span class="lolliclock-colon">:</span>','<div class="lolliclock-minutes">','<div class="lolliclock-time-old"></div>','<div class="lolliclock-time-new"></div>',"</div>","</div>",'<span class="lolliclock-am-pm"></span>',"</div>",'<div class="popover-content">','<div class="lolliclock-plate">','<div class="lolliclock-canvas"></div>','<div class="lolliclock-dial lolliclock-dial-hours"></div>','<div class="lolliclock-dial lolliclock-dial-minutes lolliclock-dial-out"></div>',"</div>",'<div class="lolliclock-ampm-block">','<div id="lolliclock-btn-am" class="lolliclock-ampm-btn">','<div class="lolliclock-btn-background"></div>','<div class="lolliclock-btn-text">AM</div>',"</div>",'<div style="flex: 1;"></div>','<div id="lolliclock-btn-pm" class="lolliclock-ampm-btn">','<div class="lolliclock-btn-background"></div>','<div class="lolliclock-btn-text">PM</div>',"</div>","</div>","</div>","</div>"].join("");LolliClock.prototype.toggle=function(){this[this.isShown?"hide":"show"]()},LolliClock.prototype.changeAmPm=function(isAmOrPm){isAmOrPm&&isAmOrPm===this.amOrPm&&this.options.hour24||(this.amOrPm="AM"===this.amOrPm?"PM":"AM",this.spanAmPm.html(this.amOrPm),$(this.amButton[0].childNodes[0]).toggleClass("lolliclock-active-button-background","AM"===this.amOrPm),$(this.pmButton[0].childNodes[0]).toggleClass("lolliclock-active-button-background","PM"===this.amOrPm),$(this.amButton[0].childNodes[1]).toggleClass("lolliclock-active-button-text","AM"===this.amOrPm),$(this.pmButton[0].childNodes[1]).toggleClass("lolliclock-active-button-text","PM"===this.amOrPm))},LolliClock.prototype.locate=function(){var element=this.element,popover=this.popover,popoverMargin=8,leftOffset=element.offset().left+(element.outerWidth()-popover.width())/2,maxLeft=$(window).width()-popover.width()-popoverMargin,minLeft=popoverMargin,maxTop=$(window).height()+$(window).scrollTop()-popoverMargin-popover.height(),minTop=popoverMargin+$(window).scrollTop(),topOffset=element.offset().top,styles={};styles.top=topOffset<minTop?minTop:topOffset>maxTop?maxTop:topOffset,styles.left=leftOffset<minLeft?minLeft:leftOffset>maxLeft?maxLeft:leftOffset,popover.css(styles),popover.show()},LolliClock.prototype.show=function(){function timeToDate(time){var parts=time.split(":");if(2===parts.length){var hours=+parts[0],minAM=parts[1].split(" ");if(2===minAM.length){var mins=minAM[0];return"PM"===minAM[1]&&(hours+=12),new Date(1970,1,1,hours,mins)}}return new Date("x")}function isValidTime(time){return!isNaN(timeToDate(time).getTime())}if(!this.isShown){raiseCallback(this.options.beforeShow);var self=this;this.isAppended||($(document.body).append(this.popover),this.isAppended=!0,$(window).on("resize.lolliclock"+this.id,function(){self.isShown&&self.locate()}),$(window).on("scroll.lolliclock",function(){self.isShown&&self.locate()}),this.AmPmButtons.on("click",function(e){self.changeAmPm(e.currentTarget.children[1].innerHTML)}),this.spanMinutes.on("click",function(){self.toggleView("minutes")}),this.spanHours.on("click",function(){self.toggleView("hours")}),this.spanAmPm.on("click",function(){self.changeAmPm()})),self.locate(),this.plate.addClass("animate"),this.header.addClass("animate"),this.popover.addClass("animate"),this.AmPmButtons.addClass("animate"),this.spanNewTime.addClass("animate"),this.spanOldTime.addClass("animate"),!this.options.autoclose&&this.closeButtons.addClass("animate"),this.plate.on("webkitAnimationEnd animationend MSAnimationEnd oanimationend",function(){self.plate.removeClass("animate"),self.header.removeClass("animate"),self.popover.removeClass("animate"),self.AmPmButtons.removeClass("animate"),self.spanNewTime.removeClass("animate"),self.spanOldTime.removeClass("animate"),!self.options.autoclose&&self.closeButtons.removeClass("animate"),self.plate.off("webkitAnimationEnd animationend MSAnimationEnd oanimationend")});var value,inputValue=this.input.prop("value"),defaultValue=this.options.startTime,placeholderValue=this.input.prop("placeholder");value=inputValue&&isValidTime(inputValue)?timeToDate(inputValue):"now"===defaultValue?new Date:defaultValue&&isValidTime(defaultValue)?timeToDate(defaultValue):placeholderValue&&isValidTime(placeholderValue)?timeToDate(placeholderValue):new Date,this.options.hour24?this.hours=value.getHours():(this.hours=value.getHours()%12,this.amOrPm=value.getHours()>11?"AM":"PM"),this.minutes=value.getMinutes(),this.changeAmPm(),self.toggleView("minutes"),self.toggleView("hours"),self.isShown=!0,$(document).on("click.lolliclock."+this.id+" focusin.lolliclock."+this.id,function(e){var target=$(e.target);0===target.closest(self.popover).length&&0===target.closest(self.input).length&&self.done()}),$(document).on("keyup.lolliclock."+this.id,function(e){27===e.keyCode&&self.hide()}),raiseCallback(this.options.afterShow)}},LolliClock.prototype.hide=function(){raiseCallback(this.options.beforeHide);var self=this;self.popover.addClass("animate-out"),self.plate.addClass("animate-out"),self.header.addClass("animate-out"),self.AmPmButtons.addClass("animate-out"),!self.options.autoclose&&self.closeButtons.addClass("animate-out"),this.popover.on("webkitAnimationEnd animationend MSAnimationEnd oanimationend",function(){$(self.spanHours[0].childNodes[0]).html(""),$(self.spanMinutes[0].childNodes[0]).html(""),self.popover.removeClass("animate-out"),self.plate.removeClass("animate-out"),self.header.removeClass("animate-out"),self.AmPmButtons.removeClass("animate-out"),!self.options.autoclose&&self.closeButtons.removeClass("animate-out"),self.popover.off("webkitAnimationEnd animationend MSAnimationEnd oanimationend"),$(document).off("click.lolliclock."+self.id+" focusin.lolliclock."+self.id),$(document).off("keyup.lolliclock."+self.id),self.popover.hide(),raiseCallback(self.options.afterHide)}),self.isShown=!1},LolliClock.prototype.toggleView=function(view,delay){var isHours="hours"===view,nextView=isHours?this.hoursView:this.minutesView,hideView=isHours?this.minutesView:this.hoursView;if(this.currentView=view,this.spanHours.toggleClass("lolliclock-primary-text",isHours),this.spanMinutes.toggleClass("lolliclock-primary-text",!isHours),hideView.addClass("lolliclock-dial-out"),nextView.css("visibility","visible").removeClass("lolliclock-dial-out"),this.resetClock(delay),clearTimeout(this.toggleViewTimer),this.toggleViewTimer=setTimeout(function(){hideView.css("visibility","hidden")},duration),isHours)this.plate.off(mousemoveEvent);else{var self=this;this.plate.on(mousemoveEvent,function(e){var offset=self.plate.offset(),x0=offset.left+dialRadius,y0=offset.top+dialRadius,dx=e.pageX-x0,dy=e.pageY-y0,z=Math.sqrt(dx*dx+dy*dy);z>outSizeRadius-tickRadius&&z<outSizeRadius+tickRadius?$(document.body).addClass("lolliclock-clickable"):$(document.body).removeClass("lolliclock-clickable")})}},LolliClock.prototype.resetClock=function(delay){var view=this.currentView,outSizeMode=!0,value=this[view],isHours="hours"===view;isHours?(unit=Math.PI/6,0!==value&&value<=12&&this.options.hour24&&(outSizeMode=!1)):unit=Math.PI/30;var radian=value*unit,x=Math.sin(radian)*radius,y=-Math.cos(radian)*radius,self=this;delay?(self.canvas.addClass("lolliclock-canvas-out"),setTimeout(function(){self.canvas.removeClass("lolliclock-canvas-out"),self.setHand(x,y,outSizeMode)},delay)):this.setHand(x,y,outSizeMode)},LolliClock.prototype.setHand=function(x,y,outSizeMode){
function cleanupAnimation($obj){$obj.on("webkitAnimationEnd animationend MSAnimationEnd oanimationend",function(){$oldTime.html(value),$oldTime.removeClass("old-down old-up"),$newTime.removeClass("new-down new-up"),$oldTime.off("webkitAnimationEnd animationend MSAnimationEnd oanimationend")})}var value,radian=Math.atan2(-x,y)+Math.PI,isHours="hours"===this.currentView,unit=Math.PI/(isHours?6:30);if(outSizeMode&&this.options.hour24&&isHours?(value=Math.round(radian/unit),12===value||0===value?value=0:value+=12):value=Math.round(radian/unit),radian=value*unit,isHours)0!==value||this.options.hour24&&outSizeMode||(value=12),this.fg.style.visibility="hidden";else{var isOnNum=value%5===0;isOnNum?this.fg.style.visibility="hidden":this.fg.style.visibility="visible",60===value&&(value=0)}this[this.currentView]!==value&&vibrate&&this.options.vibrate&&(this.vibrateTimer||(navigator[vibrate](10),this.vibrateTimer=setTimeout($.proxy(function(){this.vibrateTimer=null},this),100))),this[this.currentView]=value;var $oldTime,$newTime;isHours?($oldTime=$(this.spanHours[0].childNodes[0]),$newTime=$(this.spanHours[0].childNodes[1]),this.options.hour24&&(value=leadingZero(value))):($oldTime=$(this.spanMinutes[0].childNodes[0]),$newTime=$(this.spanMinutes[0].childNodes[1]),value=leadingZero(value)),cleanupAnimation($oldTime),value<+$oldTime.html()?($newTime.html($oldTime.html()),$oldTime.html(value),$newTime.addClass("new-down"),$oldTime.addClass("old-down")):(value>+$oldTime.html()||!$oldTime.html())&&($newTime.html(value),$oldTime.addClass("old-up"),$newTime.addClass("new-up")),this.g.insertBefore(this.hand,this.bearing),this.g.insertBefore(this.bg,this.fg),this.bg.setAttribute("class","lolliclock-canvas-bg");var r=radius;outSizeMode&&(r=outSizeRadius);var cx=Math.sin(radian)*r,cy=-Math.cos(radian)*r;this.hand.setAttribute("x2",Math.sin(radian)*(r-tickRadius)),this.hand.setAttribute("y2",-Math.cos(radian)*(r-tickRadius)),this.bg.setAttribute("cx",cx),this.bg.setAttribute("cy",cy),this.fg.setAttribute("cx",cx),this.fg.setAttribute("cy",cy)},LolliClock.prototype.done=function(){raiseCallback(this.options.beforeDone);var last=this.input.prop("value"),value="";value=this.options.hour24?leadingZero(this.hours)+":"+leadingZero(this.minutes):this.hours+":"+leadingZero(this.minutes)+" "+this.amOrPm,value!==last&&(this.input.prop("value",value),this.input.trigger("input"),this.input.trigger("change")),this.hide()},LolliClock.prototype.remove=function(){this.element.removeData("lolliclock"),this.input.off("focus.lolliclock click.lolliclock"),this.isShown&&this.hide(),this.isAppended&&($(window).off("resize.lolliclock"+this.id),$(window).off("scroll.lolliclock"+this.id),this.popover.remove())},$.fn.lolliclock=function(option){var args=Array.prototype.slice.call(arguments,1);return this.each(function(){var $this=$(this),data=$this.data("lolliclock");if(data)"function"==typeof data[option]&&data[option].apply(data,args);else{var options=$.extend({},LolliClock.DEFAULTS,$this.data(),"object"==typeof option&&option);$this.data("lolliclock",new LolliClock($this,options))}})}}();var textEditorModule=angular.module("TextEditor",[]);textEditorModule.constant("ICONS",{quote:"format_quote",bold:"format_bold",italics:"format_italic",underline:"format_underline",ul:"format_list_bulleted",ol:"format_list_numbered",redo:"redo",undo:"undo",clear:"format_clear",justifyLeft:"format_align_left",justifyCenter:"format_align_center",justifyRight:"format_align_right",justifyFull:"format_align_justify",html:"code",insertImage:"insert_photo",insertLink:"insert_link"}),textEditorModule.config(["$provide",function($provide){$provide.decorator("taOptions",["$delegate",function(taOptions){return taOptions.toolbar=[["h1","h2","h3","h4","h5","h6","p","pre","quote","bold","italics","underline","ul","ol","redo","undo","clear","justifyLeft","justifyCenter","justifyRight","justifyFull","html","insertImage","insertLink"]],taOptions}]),$provide.decorator("taTools",["$delegate",function(taTools){return taTools.quote.iconclass="material-icons",taTools.bold.iconclass="material-icons",taTools.italics.iconclass="material-icons",taTools.underline.iconclass="material-icons",taTools.ul.iconclass="material-icons",taTools.ol.iconclass="material-icons",taTools.undo.iconclass="material-icons",taTools.redo.iconclass="material-icons",taTools.clear.iconclass="material-icons",taTools.justifyLeft.iconclass="material-icons",taTools.justifyRight.iconclass="material-icons",taTools.justifyCenter.iconclass="material-icons",taTools.justifyFull.iconclass="material-icons",taTools.html.iconclass="material-icons",taTools.insertLink.iconclass="material-icons",taTools.insertImage.iconclass="material-icons",taTools}])}]);var animationDirective=angular.module("AnimationDirectives",[]);animationDirective.directive("ngShowWithAnimation",[function(){return{restrict:"A",multiElement:!0,link:function($scope,element,attrs){$scope.$watch(attrs.ngShowWithAnimation,function(value){value?element.slideDown():element.slideUp()})}}}]);var fileDirective=angular.module("FileDirectives",[]);fileDirective.directive("fileModel",["$parse",function($parse){return{restrict:"A",link:function($scope,element,attrs){var model=$parse(attrs.fileModel),modelSetter=model.assign;element.bind("change",function(){var file=element[0].files[0];$scope.$apply(function(){modelSetter($scope,file)})})}}}]),fileDirective.directive("fileThumbnail",function(){return{restrict:"A",link:function($scope,element,attrs){element.bind("change",function(){var reader=new FileReader,file=element[0].files[0];$scope.images.name=file.name,reader.onload=function(theFile){return function(event){var image=document.getElementById(attrs.fileThumbnail);image.src=event.target.result}}(file),reader.readAsDataURL(file)})}}}),fileDirective.directive("dropzone",["$rootScope","$translate","NotificationProvider","NOTIFICATION",function($rootScope,$translate,NotificationProvider,NOTIFICATION){return{restrict:"A",scope:!1,link:function(scope,element,attrs){element.dropzone({url:attrs.url,paramName:"file",uploadMultiple:!1,headers:{"X-Auth-Token":JSON.parse(localStorage.globals).token},acceptedFiles:"image/*",dictDefaultMessage:$translate.instant("dropzone.text"),success:scope.successUpload,error:function(file,response){NOTIFICATION.ParseErrorResponse(response,[400,401],$translate,$rootScope,NotificationProvider),$rootScope.progressBarActivated=!1},init:function(){this.on("sending",function(){$rootScope.errorMsg=!1,$rootScope.progressBarActivated=!0})}})}}}]);var formDirective=angular.module("FormDirectives",[]);formDirective.directive("onKeyup",function(){return function(scope,elm,attrs){var allowedKeys=scope.$eval(attrs.keys);elm.bind("keydown",function(evt){angular.forEach(allowedKeys,function(key){if(key==evt.which)return evt.preventDefault(),window.stop(),document.execCommand("Stop"),!1})})}});var timeDirective=angular.module("TimeDirectives",[]);timeDirective.directive("strToTime",function(){return{require:"ngModel",link:function($scope,element,attrs,ngModelController){ngModelController.$parsers.push(function(data){return data?("0"+data.getHours().toString()).slice(-2)+":"+("0"+data.getMinutes().toString()).slice(-2):""}),ngModelController.$formatters.push(function(data){if(!data)return null;var d=new Date(1970,1,1),splitted=data.split(":");return d.setHours(splitted[0]),d.setMinutes(splitted[1]),d})}}});var validatorDirective=angular.module("ValidatorDirectives",[]);validatorDirective.directive("passwordVerify",function(){return{require:"ngModel",scope:{passwordVerify:"="},link:function(scope,element,attrs,ctrl){scope.$watch(function(){var combined;return(scope.passwordVerify||ctrl.$viewValue)&&(combined=scope.passwordVerify+"_"+ctrl.$viewValue),combined},function(value){value&&ctrl.$parsers.unshift(function(viewValue){var origin=scope.passwordVerify;return origin!==viewValue?void ctrl.$setValidity("passwordVerify",!1):(ctrl.$setValidity("passwordVerify",!0),viewValue)})})}}});var recipeFilter=angular.module("RecipeFilters",[]);recipeFilter.filter("mainImage",["RecipeService",function(RecipeService){return function(input){return RecipeService.getImages(input).main.href}}]),recipeFilter.filter("srcImage",["envService",function(envService){return function(input,user){return input?input.new_title?envService.read("apiUrl")+"/users/"+user.id+"/files/"+input.new_title:input.email?"https://www.gravatar.com/avatar/"+md5(input.email.toLowerCase().trim())+"?d=identicon&f=y&s=200":"https://www.gravatar.com/avatar/"+input.id+"?d=identicon&f=y&s=200":"assets/img/favicon.png"}}]),recipeFilter.filter("capitalize",function(){return function(input){return input?input.charAt(0).toUpperCase()+input.substr(1).toLowerCase():""}}),recipeFilter.filter("humanized",["$translate",function($translate){return function(input){switch(input){case"EASY":case"MEDIUM":case"HARD":case"PUBLIC":case"FRIENDS":case"PRIVATE":return $translate.instant("humanized."+input);default:return""}}}]),recipeFilter.filter("duration",["$translate",function($translate){return function(input){var hour=moment.duration(input).hours(),minute=moment.duration(input).minutes(),duration="";return hour>0&&(duration=moment.duration(hour,"hours").humanize(),minute>0&&(duration+=" "+$translate.instant("conjuntion.and")+" ")),minute>0&&(duration+=moment.duration(minute,"minutes").humanize()),duration}}]),recipeFilter.filter("fromNow",function(){return function(date){return moment(date).fromNow()}});var userFilter=angular.module("UserFilters",[]);userFilter.filter("userImage",["envService",function(envService){return function(input){return input&&input.avatar&&input.avatar.new_title?envService.read("apiUrl")+"/users/"+input.id+"/files/"+input.avatar.new_title:input&&input.email?"https://www.gravatar.com/avatar/"+md5(input.email.toLowerCase().trim())+"?d=identicon&f=y&s=200":void 0}}]),userFilter.filter("fullname",function(){return function(input){return $.getFullName(input)}});var categoryProvider=angular.module("CategoryProviders",[]);categoryProvider.provider("CategoryProvider",[function(){this.$get=[function(){return{openCategoryDialog:function($scope,$rootScope,$mdDialog,$translate,CategoryService,NotificationProvider,NOTIFICATION){$scope.hide=function(){$mdDialog.hide()},$scope.cancel=function(){$mdDialog.cancel()},$scope.save=function(){$mdDialog.hide(),$rootScope.progressBarActivated=!0,$rootScope.errorMsg=!1,$scope.loadingNextPage=!0,CategoryService.create({text:$scope.text},function(response){NotificationProvider.notify({title:$translate.instant("response.saved"),type:"success",addclass:"custom-success-notify",icon:"material-icons md-light",icon_class:"restaurant_menu",styling:"fontawesome"}),$scope.loadingNextPage=!1,$rootScope.progressBarActivated=!1},function(response){NOTIFICATION.ParseErrorResponse(response,[400,401],$translate,$rootScope,NotificationProvider),$scope.hasError=!0,$scope.loadingNextPage=!1,$rootScope.progressBarActivated=!1})}}}}]}]);var commentProvider=angular.module("CommentProviders",[]);commentProvider.provider("CommentProvider",[function(){this.$get=[function(){return{openCommentDialog:function($scope,$rootScope,$mdDialog,data,NotificationProvider){$scope.text=data.text,$scope.hide=function(){$mdDialog.hide()},$scope.cancel=function(){$mdDialog.cancel()},$scope.save=function(){$mdDialog.hide($scope.text)}}}}]}]);var fileProvider=angular.module("FileProviders",[]);fileProvider.provider("FileProvider",[function(){this.$get=[function(){return{openGalleryDialog:function($scope,$rootScope,$mdDialog,$translate,data,FileService,NotificationProvider,NOTIFICATION){$scope.selectedImages=data.selectedImages,$scope.mode=data.mode,$scope.user=data.user,$scope.urlUpload=FileService.getUrlUpload($scope.user),FileService.loadUserImages($scope.user,function(response){$scope.images=response.data,$scope.checkImagesSelected($scope.images)},function(response){NOTIFICATION.ParseErrorResponse(response,[],$translate,$rootScope,NotificationProvider)}),$scope.toggleImageSelected=function(image){image.selected?($scope.selectedImages.splice($scope.selectedImages.findIndex(function(imageInArray){return image.id==imageInArray.id}),1),image.selected=!1):("selectImageMain"!=$scope.mode&&"selectAvatar"!=$scope.mode||($scope.selectedImages=[],$scope.checkImagesSelected($scope.images)),$scope.selectedImages.push(image),image.selected=!0)},$scope.checkImagesSelected=function(images){for(var image in images)$scope.images.hasOwnProperty(image)&&($scope.images[image].selected=$.containsId($scope.images[image],$scope.selectedImages))},$scope.removeImage=function(image,$event){$event.stopPropagation&&$event.stopPropagation(),$event.preventDefault&&$event.preventDefault(),$event.cancelBubble=!0,$event.returnValue=!1;var msg=$translate.instant("dialog.remove-image-1",{title:image.title});image.recipes>0&&(msg+="<br><br>"+$translate.instant("dialog.remove-image-2"));var confirm=$mdDialog.confirm().title($translate.instant("btn.delete-text")).textContent(msg).ariaLabel($translate.instant("btn.delete-text")).targetEvent($event).ok($translate.instant("btn.delete-text")).cancel($translate.instant("btn.cancel-text"));$scope.returnSelected(),$mdDialog.show(confirm).then(function(){image.selected&&($scope.selectedImages.splice($scope.selectedImages.findIndex(function(imageInArray){return image.id==imageInArray.id}),1),image.selected=!1),$rootScope.progressBarActivated=!0,$rootScope.errorMsg=!1,FileService.deleteFile($scope.user,image.id,function(response){NotificationProvider.notify({title:response.data.msg,type:"success",addclass:"custom-success-notify",icon:"material-icons md-light",icon_class:"check_circle",styling:"fontawesome"}),$rootScope.progressBarActivated=!1},function(response){NOTIFICATION.ParseErrorResponse(response,[400,404],$translate,$rootScope,NotificationProvider),$rootScope.progressBarActivated=!1})},function(){})},$scope.successUpload=function(file,response){$scope.images.push(response),$rootScope.progressBarActivated=!1},$scope.hide=function(){$mdDialog.hide()},$scope.cancel=function(){$mdDialog.cancel()},$scope.returnSelected=function(){"selectImageMain"==$scope.mode||"selectAvatar"==$scope.mode?$mdDialog.hide($scope.selectedImages[0]):$mdDialog.hide($scope.selectedImages)}},openUploadDialog:function($scope,$rootScope,$mdDialog,data,FileService,NotificationProvider){$scope.user=data.user,$scope.images=[],$scope.urlUpload=FileService.getUrlUpload($scope.user),$scope.successUpload=function(file,response){$scope.images.push(response)},$scope.hide=function(){$mdDialog.hide()},$scope.cancel=function(){$mdDialog.cancel()},$scope.returnUploaded=function(){$mdDialog.hide($scope.images)}}}}]}]);var notificationProvider=angular.module("NotificationProviders",[]);notificationProvider.constant("NOTIFICATION",{ParseErrorResponse:function(response,httpCodes,$translate,$rootScope,NotificationProvider){httpCodes.contains(response.status)?(400===response.status?$rootScope.error={icon:"error_outline",title:$translate.instant("error.400.title"),msg:$.parseError(response.data)}:401===response.status?$rootScope.error={icon:"warning",title:$translate.instant("error.401.title")}:403===response.status?$rootScope.error={icon:"warning",title:$translate.instant("error.403.title")}:$rootScope.error={icon:"error_outline",title:response.data.error},$rootScope.errorMsg=!0):NotificationProvider.notify({title:response&&response.data&&response.data.error?response.data.error:$translate.instant("error.500.title"),type:"error",addclass:"custom-error-notify",icon:"material-icons md-light",styling:"fontawesome"})}}),notificationProvider.provider("NotificationProvider",[function(){var settings={styling:"bootstrap3"};this.setDefaults=function(defaults){settings=defaults},this.$get=[function(){return{getSettings:function(){return settings},notice:function(content){var hash=angular.copy(settings);return hash.type="notice",hash.text=content,this.notify(hash)},info:function(content){var hash=angular.copy(settings);return hash.type="info",hash.text=content,this.notify(hash)},success:function(content){var hash=angular.copy(settings);return hash.type="success",hash.text=content,this.notify(hash)},error:function(content){var hash=angular.copy(settings);return hash.type="error",hash.text=content,this.notify(hash)},notify:function(hash){hash.mobile={swipe_dismiss:!0,styling:!0};var notification=new PNotify(hash);"error"!==hash.type||void 0!==hash.icon_class&&null!==hash.icon_class?notification.get().find(".material-icons").html(hash.icon_class):notification.get().find(".material-icons").html("warning"),notification.get().click(function(){notification.remove(),hash.callback&&hash.callback["function"]&&hash.callback["function"]()})},notificateFavorite:function(data,callback){return this.notify({title:data.msg,type:"primary",addclass:"custom-primary-notify notify-clickable",icon:"material-icons md-light",icon_class:"favorite",styling:"fontawesome",hide:!1,callback:{"function":callback}})},notificateComment:function(data){return this.notify({title:data.msg,type:"primary",addclass:"custom-primary-notify",icon:"material-icons md-light",icon_class:"comment",styling:"fontawesome"})},notificateReply:function(data){return this.notify({title:data.msg,type:"primary",addclass:"custom-primary-notify",icon:"material-icons md-light",icon_class:"reply",styling:"fontawesome"})}}}]}]);var ratingProvider=angular.module("RatingProviders",[]);ratingProvider.provider("RatingProvider",[function(){this.$get=[function(){return{openRatingDialog:function($scope,$rootScope,$location,$mdDialog,$translate,RecipeService,NotificationProvider,NOTIFICATION){$scope.rated=$rootScope.globals.rated,$scope.recipe=$rootScope.globals.recipe,$scope.hide=function(){$mdDialog.hide()},$scope.cancel=function(){$mdDialog.cancel()},$scope.rating=function(){$rootScope.errorMsg=!1,$rootScope.globals.user?RecipeService.rating($scope.recipe.id,$scope.rated,function(response){NotificationProvider.notify({title:$translate.instant("response.saved"),type:"success",addclass:"custom-success-notify",icon:"material-icons md-light",icon_class:"star",styling:"fontawesome"}),$mdDialog.cancel(),$location.path("/recipes/"+$scope.recipe.slug)},function(response){NOTIFICATION.ParseErrorResponse(response,[400],$translate,$rootScope,NotificationProvider)}):$location.path("/login")}}}}]}]);var authServices=angular.module("AuthServices",["ngResource"]);authServices.factory("AuthService",["$http","$rootScope","$timeout","$interval","$location","$translate","envService","$q","NotificationProvider",function($http,$rootScope,$timeout,$interval,$location,$translate,envService,$q,NotificationProvider){var service={apiUrl:envService.read("apiUrl"),OK:200,UNAUTHORIZED:401,FORBIDDEN:403};return service.login=function(email,password,expiration,callbackOk,callbackError){$http.post(service.apiUrl+"/auth/login",{email:email,password:password,setExpiration:expiration},{headers:{Accept:"application/json","Content-Type":"application/json"}}).then(function(response){callbackOk(response)},function(response){callbackError(response)})},service.register=function(user,callbackOk,callbackError){$http.post(service.apiUrl+"/auth/register",user,{headers:{Accept:"application/json","Content-Type":"application/json"}}).then(function(response){callbackOk(response)},function(response){callbackError(response)})},service.resetPassword=function(email,callbackOk,callbackError){$http.post(service.apiUrl+"/auth/reset/password",{email:email},{headers:{Accept:"application/json","Content-Type":"application/json"}}).then(function(response){callbackOk(response)},function(response){callbackError(response)})},service.recoverPassword=function(email,password,token,callbackOk,callbackError){$http.put(service.apiUrl+"/auth/reset/password",{email:email,password:password,token:token},{headers:{Accept:"application/json","Content-Type":"application/json"}}).then(function(response){callbackOk(response)},function(response){callbackError(response)})},service.ValidateEmail=function(token,callbackOk,callbackError){$http.put(service.apiUrl+"/auth/active",{token:token},{headers:{Accept:"application/json","Content-Type":"application/json"}}).then(function(response){callbackOk(response)},function(response){callbackError(response)})},service.GetProfile=function(callbackOk,callbackError){$http.get(service.apiUrl+"/profile",{headers:{Accept:"application/json","Content-Type":"application/json"}}).then(function(response){callbackOk(response)},function(response){callbackError(response)})},service.EditProfile=function(user,callbackOk,callbackError){$http.put(service.apiUrl+"/profile",user,{headers:{Accept:"application/json","Content-Type":"application/json"}}).then(function(response){callbackOk(response)},function(response){callbackError(response)})},service.getFriends=function(user,params,callbackOk,callbackError){$http.get(service.apiUrl+"/users/"+user.id+"/friends",{headers:{Accept:"application/json","Content-Type":"application/json"},params:params}).then(function(response){callbackOk(response)},function(response){callbackError(response)})},service.SaveCredentials=function(token,user,pusherKey,language){$rootScope.globals={token:token,user:user.user,language:language},$translate.use(language),pusherKey&&(null!==$rootScope.pusher&&void 0!==$rootScope.pusher||($rootScope.pusher=new Pusher(pusherKey,{cluster:"eu",encrypted:!0})),$rootScope.isBinded||($rootScope.channel=$rootScope.pusher.subscribe("user_"+user.user.id),$rootScope.channel.bind("recipe_favorite",function(data){NotificationProvider.notificateFavorite(JSON.parse(data),function(){$rootScope.$apply(function(){$location.path(JSON.parse(data).redirect)})})}),$rootScope.channel.bind("recipe_comment",function(data){NotificationProvider.notificateComment(JSON.parse(data),function(){$rootScope.$apply(function(){$location.path(JSON.parse(data).redirect)})})}),$rootScope.channel.bind("comment_reply",function(data){NotificationProvider.notificateReply(JSON.parse(data),function(){$rootScope.$apply(function(){$location.path(JSON.parse(data).redirect)})})}),$rootScope.isBinded=!0)),localStorage.globals=JSON.stringify($rootScope.globals)},service.ClearCredentials=function(){$rootScope.globals.user&&$rootScope.globals.user.id&&$rootScope.channel&&($rootScope.channel.unbind(),$rootScope.pusher.unsubscribe("user_"+$rootScope.globals.user.id),$rootScope.isBinded=!1),$rootScope.globals={},localStorage.removeItem("globals")},service.ParseJwt=function(token){var base64Url=token.split(".")[1],base64=base64Url.replace("-","+").replace("_","/");return JSON.parse(atob(base64))},service.CheckToken=function(user){$http.post(service.apiUrl+"/auth/check",{email:user.email,expiration:$rootScope.globals.user.setExpiration},{headers:{Accept:"application/json","Content-Type":"application/json"}}).then(function(response){service.SaveCredentials(response.data.auth_token,JSON.parse(service.ParseJwt(response.data.auth_token).sub),response.data.pusher_key,response.data.language)},function(response){401==response.status?service.ClearCredentials():console.error(response.status)})},service.StartCronCheckToken=function(){$rootScope.cronToken=$interval(function(){service.CheckToken($rootScope.globals.user)},18e5)},service.StopCronCheckToken=function(){angular.isDefined($rootScope.cronToken)&&$interval.cancel($rootScope.cronToken)},service.GetJwt=function(){return $rootScope.globals?$rootScope.globals.token:null},service.IsAuthed=function(){var token=service.GetJwt();if(token){if(!$rootScope.globals.user.setExpiration)return!0;var params=service.ParseJwt(token);return Math.round((new Date).getTime()/1e3)<=params.exp||(service.ClearCredentials(),!1)}return!1},service.isAdmin=function(){return service.IsAuthed&&!!$rootScope.globals.user&&"ADMIN"==$rootScope.globals.user.type},service.IsAnonymous=function(){var deferred=$q.defer();return void 0===service.GetJwt()?deferred.resolve(service.OK):deferred.reject(service.FORBIDDEN),deferred.promise},service.IsAuthenticated=function(){var deferred=$q.defer();return service.IsAuthed()?deferred.resolve(service.OK):deferred.reject(service.UNAUTHORIZED),deferred.promise},service.IsMyRecipe=function(slug){var deferred=$q.defer();return $http({method:"HEAD",url:service.apiUrl+"/recipes/"+slug+"/mine",timeout:deferred.promise}).then(function(){deferred.resolve(service.OK)},function(){deferred.reject(service.UNAUTHORIZED)}),deferred.promise},service}]);var categoryService=angular.module("CategoryServices",["ngResource"]);categoryService.factory("CategoryService",["$http","$rootScope","envService","$q",function($http,$rootScope,envService,$q){var service={apiUrl:envService.read("apiUrl")};return service.all=function(callbackOk,callbackError){$http.get(service.apiUrl+"/categories",{headers:{Accept:"application/json","Content-Type":"application/json","Accept-Pagination":!1}}).then(function(response){callbackOk(response)},function(response){callbackError(response)})},service.search=function(params,callbackOk,callbackError){$http.get(service.apiUrl+"/categories",{headers:{Accept:"application/json","Content-Type":"application/json","Accept-Pagination":!0},params:params}).then(function(response){callbackOk(response)},function(response){callbackError(response)})},service.get=function(id,callbackOk,callbackError){$http.get(service.apiUrl+"/categories/"+id,{headers:{Accept:"application/json","Content-Type":"application/json"}}).then(function(response){callbackOk(response)},function(response){callbackError(response)})},service.create=function(category,callbackOk,callbackError){$http.post(service.apiUrl+"/categories",category,{headers:{Accept:"application/json","Content-Type":"application/json"}}).then(function(response){callbackOk(response)},function(response){callbackError(response)})},service.edit=function(category,callbackOk,callbackError){$http.put(service.apiUrl+"/categories/"+category.id,category,{headers:{Accept:"application/json","Content-Type":"application/json"}}).then(function(response){callbackOk(response)},function(response){callbackError(response)})},service["delete"]=function(id,callbackOk,callbackError){$http["delete"](service.apiUrl+"/categories/"+id,{headers:{Accept:"application/json","Content-Type":"application/json"}}).then(function(response){callbackOk(response)},function(response){callbackError(response)})},service.deleteMultiple=function(ids,callbackOk,callbackError){$http["delete"](service.apiUrl+"/categories",{headers:{Accept:"application/json","Content-Type":"application/json","Accept-Pagination":!0},params:{ids:ids}}).then(function(response){callbackOk(response)},function(response){callbackError(response)})},service}]);var commentService=angular.module("CommentServices",["ngResource"]);commentService.factory("CommentService",["$http","$rootScope","envService","$q",function($http,$rootScope,envService,$q){var service={apiUrl:envService.read("apiUrl")};return service.create=function(recipeId,id,text,callbackOk,callbackError){var url=service.apiUrl+"/recipes/"+recipeId+"/comments";void 0!==id&&null!==id&&(url+="/"+id),$http.post(url,{text:text},{headers:{Accept:"application/json","Content-Type":"application/json"}}).then(function(response){callbackOk(response)},function(response){callbackError(response)})},service.edit=function(recipeId,id,text,callbackOk,callbackError){$http.put(service.apiUrl+"/recipes/"+recipeId+"/comments/"+id,{text:text},{headers:{Accept:"application/json","Content-Type":"application/json"}}).then(function(response){callbackOk(response)},function(response){callbackError(response)})},service["delete"]=function(recipeId,id,callbackOk,callbackError){$http["delete"](service.apiUrl+"/recipes/"+recipeId+"/comments/"+id,{headers:{Accept:"application/json","Content-Type":"application/json"}}).then(function(response){callbackOk(response)},function(response){callbackError(response)})},service}]);var fileService=angular.module("FileServices",["ngResource"]);fileService.factory("FileService",["$http","$rootScope","envService","$q",function($http,$rootScope,envService,$q){var service={apiUrl:envService.read("apiUrl")};return service.getUrlUpload=function(user){return service.apiUrl+"/users/"+user.id+"/files"},service.loadUserImages=function(user,callbackOk,callbackError){$http.get(service.apiUrl+"/users/"+user.id+"/files",{headers:{Accept:"application/json","Content-Type":"application/json"}}).then(function(response){callbackOk(response)},function(response){callbackError(response)})},service.uploadImage=function(user,file,callbackOk,callbackError){var fd=new FormData;fd.append("file",file),$http.post(service.apiUrl+"/users/"+user.id+"/files",fd,{transformRequest:angular.identity,headers:{"Content-Type":void 0}}).then(function(response){callbackOk(response)},function(response){callbackError(response)})},service.deleteFile=function(user,id,callbackOk,callbackError){$http["delete"](service.apiUrl+"/users/"+user.id+"/files/"+id,{headers:{Accept:"application/json","Content-Type":"application/json"}}).then(function(response){callbackOk(response)},function(response){callbackError(response)})},service}]);var ingredientService=angular.module("IngredientServices",["ngResource"]);ingredientService.factory("IngredientService",["$http","$rootScope","envService","$q",function($http,$rootScope,envService,$q){var service={apiUrl:envService.read("apiUrl")};return service.add=function(id,ingredient,callbackOk,callbackError){return $http.post(service.apiUrl+"/recipes/"+id+"/ingredient",ingredient,{headers:{Accept:"application/json","Content-Type":"application/json"}}).then(function(response){return callbackOk(response)},function(response){return callbackError(response)})},service["delete"]=function(id,ingredientId,callbackOk,callbackError){return $http["delete"](service.apiUrl+"/recipes/"+id+"/ingredient/"+ingredientId,{headers:{Accept:"application/json","Content-Type":"application/json"}}).then(function(response){return callbackOk(response)},function(response){return callbackError(response)})},service}]);var recipeService=angular.module("RecipeServices",["ngResource"]);recipeService.factory("RecipeService",["$http","$rootScope","envService","$q",function($http,$rootScope,envService,$q){var service={apiUrl:envService.read("apiUrl"),regexMainImage:/^main\..+$/,charmap:{" ":" ","":"!","":"c","":"lb","":"yen","":"|","":"SS","":'"',"":"(c)","":"a","":"<<","":"not","":"-","":"(R)","":"^0","":"+/-","":"^2","":"^u","":'"u',"":"d","":"^3","":"'","":"u","":"P","":".","":",","":"^1","":"o","":">>","":" 1/4 ","":" 1/2 ","":" 3/4 ","":"?","":"`A","":"'A","":"^A","":"~A","":"^a","":"'a","":'"A',"":"A","":"AE","":"C","":"`E","":"'E","":"^E","":'"E',"":"`I","":"'I","":"^I","":'"I',"":"D","":"~N","":"`O","":"'O","":"'i","":"^i","":'"i',"":"`a","":"^O","":"~O","":'"O',"":"x","":"O","":"`U","":"'U","":"^U","":'"U',"":"'Y","":"~a","":'"a',"":"a","":"ae","":"c","":"`e","":"'e","":"^e","":'"e',"":"`i","":"~n","":"`o","":"'o","":"^o","":"~o","":'"o',"":":","":"o","":"`u","":"'u","":"th","":'"y',"":"A","":"a","":"A","":"a","":"A","":"a","":"'C","":"'c","":"C","":"c","":"C","":"c","":"D","":"d","":"D","":"d","":"E","":"e","":"e","":"E","":"e","":"E","":"e","":"E","":"e","":"^G","":"^g","":"G","":"G","":"g","":"G","":"g","":"^H","":"^h","":"H","":"h","":"~I","":"ss","":"~i","":"I","":"i","":"I","":"i","":"I","":"i","":"I","":"i","":"IJ","":"ij","":"^J","":"^j","":"K","":"k","":"L","":"l","":"L","":"l","":"L","":"l","":"L","":"l","":"'N","":"'n","":"N","":"n","":"N","":"n","":"'n","":"o","":"O","":"o","":'"O',"":'"o',"":"OE","":"oe","":"'R","":"'r","":"R","":"r","":"^Y","":"O","":"l","":"L","":"g","":"E","":"^C","":"^c","":"'y","":"R","":"r","":"'S","":"'s","":"^S","":"^s","":"S","":"s","":"S","":"s","":"T","":"t","":"T","":"t","":"T","":"t","":"~U","":"~u","":"U","":"u","":"U","":"u","":"U","":"u","":'"U',"":'"u',"":"U","":"u","":"^W","":"^w","":"^y","":'"Y',
"":"'Z","":"'z","":"Z","":"z","":"Z","":"z","":"s","":"Th"}};return service.search=function(data,callbackOk,callbackError){$http.get(service.apiUrl+"/recipes",{headers:{Accept:"application/json","Content-Type":"application/json"},params:data}).then(function(response){callbackOk(response)},function(response){callbackError(response)})},service.get=function(slug,callbackOk,callbackError){$http.get(service.apiUrl+"/recipes/"+slug,{headers:{Accept:"application/json","Content-Type":"application/json"}}).then(function(response){callbackOk(response)},function(response){callbackError(response)})},service.getDraft=function(callbackOk,callbackError){$http.post(service.apiUrl+"/recipes/draft",{},{headers:{Accept:"application/json","Content-Type":"application/json"}}).then(function(response){callbackOk(response)},function(response){callbackError(response)})},service.createFromDraft=function(callbackOk,callbackError){$http.post(service.apiUrl+"/recipes/create-from-draft",{},{headers:{Accept:"application/json","Content-Type":"application/json"}}).then(function(response){callbackOk(response)},function(response){callbackError(response)})},service.getImages=function(recipe){for(var mainImage=recipe.media.filter(function(obj){return null!==service.regexMainImage.exec(obj.filename)})[0],main=mainImage?{id:mainImage.id,title:mainImage.filename,href:service.apiUrl+"/recipes/"+recipe.id+"/media/"+mainImage.filename}:{href:"http://lorempixel.com/g/480/480/food/Placeholder"},gallery=[],i=0;i<recipe.media.length;i++){var image=recipe.media[i],filename=image.filename.substr(0,image.filename.lastIndexOf("."));image!==mainImage&&gallery.push({id:image.id,title:filename,href:service.apiUrl+"/recipes/"+recipe.id+"/media/"+image.filename})}return{main:main,gallery:gallery}},service.getSlug=function(s){if(!s)return"";for(var ch,cp,ascii=[],i=0;i<s.length;i++)(cp=s.charCodeAt(i))<384&&(ch=String.fromCharCode(cp),ascii.push(service.charmap[ch]||ch));return s=ascii.join(""),s=s.replace(/[^\w\s-]/g,"").trim().toLowerCase(),s.replace(/[-\s]+/g,"-")},service.checkSlug=function(slug){var deferredAbort=$q.defer(),request=$http({method:"HEAD",url:service.apiUrl+"/recipes/"+slug+"/check",timeout:deferredAbort.promise}),promise=request.then(function(response){return response},function(response){return response});return promise.abort=function(){deferredAbort.resolve()},promise["finally"](function(){promise.abort=angular.noop,deferredAbort=request=promise=null}),promise},service.checkSlugWithId=function(slug,id){var deferredAbort=$q.defer(),request=$http({method:"HEAD",url:service.apiUrl+"/recipes/"+slug+"/check/"+id,timeout:deferredAbort.promise}),promise=request.then(function(response){return response},function(response){return response});return promise.abort=function(){deferredAbort.resolve()},promise["finally"](function(){promise.abort=angular.noop,deferredAbort=request=promise=null}),promise},service.getNewTags=function(array){var a=[];for(var el in array)!array[el].id&&a.push(array[el].text);return a},service.create=function(recipe,callbackOk,callbackError){$http.post(service.apiUrl+"/recipes",recipe,{headers:{Accept:"application/json","Content-Type":"application/json"}}).then(function(response){callbackOk(response)},function(response){callbackError(response)})},service.edit=function(recipe,callbackOk,callbackError){$http.put(service.apiUrl+"/recipes/"+recipe.id,recipe,{headers:{Accept:"application/json","Content-Type":"application/json"}}).then(function(response){callbackOk(response)},function(response){callbackError(response)})},service.uploadFile=function(file,id,isMain,isMultiple,callbackOk,callbackError){var fd=new FormData;if(file instanceof Array)for(var i=0;i<file.length;i++)fd.append("file",file[i]);else fd.append("file",file);fd.append("is_main",isMain),fd.append("is_multiple",isMultiple),$http.post(service.apiUrl+"/recipes/"+id+"/media",fd,{transformRequest:angular.identity,headers:{"Content-Type":void 0}}).then(function(response){callbackOk(response)},function(response){callbackError(response)})},service.deleteFile=function(idRecipe,id,callbackOk,callbackError){$http["delete"](service.apiUrl+"/recipes/"+idRecipe+"/media/"+id,{headers:{Accept:"application/json","Content-Type":"application/json"}}).then(function(response){callbackOk(response)},function(response){callbackError(response)})},service["delete"]=function(id,callbackOk,callbackError){$http["delete"](service.apiUrl+"/recipes/"+id,{headers:{Accept:"application/json","Content-Type":"application/json"}}).then(function(response){callbackOk(response)},function(response){callbackError(response)})},service.toggleFav=function(idRecipe,callbackOk,callbackError){$http.patch(service.apiUrl+"/recipes/"+idRecipe+"/fav",{},{headers:{Accept:"application/json","Content-Type":"application/json"}}).then(function(response){callbackOk(response)},function(response){callbackError(response)})},service.rating=function(idRecipe,rating,callbackOk,callbackError){$http.put(service.apiUrl+"/recipes/"+idRecipe+"/rating",{rating:rating},{headers:{Accept:"application/json","Content-Type":"application/json"}}).then(function(response){callbackOk(response)},function(response){callbackError(response)})},service}]);var tagService=angular.module("TagServices",["ngResource"]);tagService.factory("TagService",["$http","$rootScope","envService","$q",function($http,$rootScope,envService,$q){var service={apiUrl:envService.read("apiUrl")};return service.search=function(search,callbackOk,callbackError){return $http.get(service.apiUrl+"/tags",{headers:{Accept:"application/json","Content-Type":"application/json"},params:{search:search}}).then(function(response){return callbackOk(response)},function(response){return callbackError(response)})},service.searchById=function(id,callbackOk,callbackError){return $http.get(service.apiUrl+"/tags/"+id,{headers:{Accept:"application/json","Content-Type":"application/json"}}).then(function(response){return callbackOk(response)},function(response){return callbackError(response)})},service}]);var userService=angular.module("UserServices",["ngResource"]);userService.factory("UserService",["$http","$rootScope","envService","$q",function($http,$rootScope,envService,$q){var service={apiUrl:envService.read("apiUrl")};return service.search=function(data,callbackOk,callbackError){$http.get(service.apiUrl+"/users",{headers:{Accept:"application/json","Content-Type":"application/json"},params:data}).then(function(response){callbackOk(response)},function(response){callbackError(response)})},service.get=function(id,callbackOk,callbackError){$http.get(service.apiUrl+"/users/"+id,{headers:{Accept:"application/json","Content-Type":"application/json"}}).then(function(response){callbackOk(response)},function(response){callbackError(response)})},service.create=function(user,callbackOk,callbackError){$http.post(service.apiUrl+"/users",user,{headers:{Accept:"application/json","Content-Type":"application/json"}}).then(function(response){callbackOk(response)},function(response){callbackError(response)})},service.edit=function(user,callbackOk,callbackError){$http.put(service.apiUrl+"/users/"+user.id,user,{headers:{Accept:"application/json","Content-Type":"application/json"}}).then(function(response){callbackOk(response)},function(response){callbackError(response)})},service["delete"]=function(id,callbackOk,callbackError){$http["delete"](service.apiUrl+"/users/"+id,{headers:{Accept:"application/json","Content-Type":"application/json"}}).then(function(response){callbackOk(response)},function(response){callbackError(response)})},service.getRecipes=function(userId,params,callbackOk,callbackError){$http.get(service.apiUrl+"/users/"+userId+"/recipes",{headers:{Accept:"application/json","Content-Type":"application/json"},params:params}).then(function(response){callbackOk(response)},function(response){callbackError(response)})},service.getRecipesFavorites=function(userId,params,callbackOk,callbackError){$http.get(service.apiUrl+"/users/"+userId+"/favorites",{headers:{Accept:"application/json","Content-Type":"application/json"},params:params}).then(function(response){callbackOk(response)},function(response){callbackError(response)})},service.addFriend=function(userId,friendId,callbackOk,callbackError){$http.post(service.apiUrl+"/users/"+userId+"/friends",{id:friendId},{headers:{Accept:"application/json","Content-Type":"application/json"}}).then(function(response){callbackOk(response)},function(response){callbackError(response)})},service.getFriends=function(userId,params,callbackOk,callbackError){$http.get(service.apiUrl+"/users/"+userId+"/friends",{headers:{Accept:"application/json","Content-Type":"application/json"},params:params}).then(function(response){callbackOk(response)},function(response){callbackError(response)})},service.deleteFriend=function(userId,friendId,callbackOk,callbackError){$http["delete"](service.apiUrl+"/users/"+userId+"/friends/"+friendId,{headers:{Accept:"application/json","Content-Type":"application/json"}}).then(function(response){callbackOk(response)},function(response){callbackError(response)})},service}]);