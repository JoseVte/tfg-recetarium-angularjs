moment.locale("es");var recetarium=angular.module("recetariumApp",["environment","ngRoute","ngMaterial","ngMessages","ngSanitize","ngAnimate","textAngular","ui.router","Animations","TextEditor","NotificationProviders","FileDirectives","TimeDirectives","HomeController","AuthServices","AuthController","RecipeServices","RecipeFilters","RecipeController","CategoryServices","CategoryController","TagServices","IngredientServices"]);recetarium.config(["$routeProvider","$locationProvider",function($routeProvider,$locationProvider){$locationProvider.html5Mode(!0),$routeProvider.when("/",{templateUrl:"views/home.html",controller:""}).when("/login",{templateUrl:"views/auth/login.html",controller:"Login",resolve:{access:["AuthService",function(AuthService){return AuthService.IsAnonymous()}]}}).when("/logout",{template:"",controller:"Logout",resolve:{access:["AuthService",function(AuthService){return AuthService.IsAuthenticated()}]}}).when("/register",{templateUrl:"views/auth/register.html",controller:"Register",resolve:{access:["AuthService",function(AuthService){return AuthService.IsAnonymous()}]}}).when("/recipes",{templateUrl:"views/recipe/index.html",controller:"RecipeAll"}).when("/recipes/:slug",{templateUrl:"views/recipe/show.html",controller:"RecipeShow"}).when("/recipes/:slug/edit",{templateUrl:"views/recipe/edit.html",controller:"RecipeEdit",resolve:{access:["AuthService","$route","$rootScope",function(AuthService,$route,$rootScope){return $rootScope.progressBarActivated=!0,AuthService.IsMyRecipe($route.current.params.slug)}]}}).when("/new-recipe",{templateUrl:"views/recipe/create.html",controller:"RecipeCreate",resolve:{access:["AuthService",function(AuthService){return AuthService.IsAuthenticated()}]}}).when("/unauthorized",{templateUrl:"views/error/401.html",controller:""}).when("/forbidden",{templateUrl:"views/error/403.html",controller:""}).otherwise({redirectTo:"/"})}]),recetarium.config(["$httpProvider",function($httpProvider){$httpProvider.defaults.useXDomain=!0,delete $httpProvider.defaults.headers.common["X-Requested-With"],$httpProvider.interceptors.push(["$q","$location","$rootScope",function($q,$location,$rootScope){return{response:function(response){return response},responseError:function(response){return 401===response.status&&($rootScope.globals.token?$location.path("/unauthorized"):$location.path("/login")),$q.reject(response)}}}])}]),recetarium.config(["$mdThemingProvider",function($mdThemingProvider){}]),recetarium.config(["envServiceProvider",function(envServiceProvider){envServiceProvider.config({domains:{development:["localhost","127.0.0.1"],production:["recetarium-angular.herokuapp.com"]},vars:{development:{apiUrl:"http://localhost:9000"},production:{apiUrl:"https://recetarium.herokuapp.com"}}}),envServiceProvider.check()}]),recetarium.run(["$rootScope","$location","$http","AuthService","ICONS",function($rootScope,$location,$http,AuthService,ICONS){$rootScope.location=$location,$rootScope.lastSearchParams=[],$rootScope.lastSearchParams["/recipes"]={page:1,size:10},localStorage.globals?$rootScope.globals=JSON.parse(localStorage.globals):$rootScope.globals={},$rootScope.$on("$routeChangeError",function(ev,next,current,rejection){rejection==AuthService.UNAUTHORIZED?$location.path("/login"):rejection==AuthService.FORBIDDEN&&$location.path("/forbidden")}),$rootScope.$on("$locationChangeStart",function(ev,next,current,rejection){switch($http.defaults.headers.common["X-Auth-Token"]=$rootScope.globals.token,$rootScope.IsAuthed=AuthService.IsAuthed(),$rootScope.IsHome="/"==$location.path(),$rootScope.HasBack=!1,$rootScope.errorMsg=!1,$rootScope.progressBarActivated=!1,$rootScope.lastSearchParams[$location.path()]&&$location.search($rootScope.lastSearchParams[$location.path()]),"/recipes"!==$location.path()&&$location.search({}),$location.path()){case"/login":case"/register":$rootScope.tabColor="#00BFA5",$rootScope.headerTheme="header-theme-auth",$rootScope.loaderTheme="md-auth",$rootScope.bodyTheme="body-theme-auth";break;default:$rootScope.tabColor="#DD2C00",$rootScope.headerTheme="header-theme-default",$rootScope.loaderTheme="md-default",$rootScope.bodyTheme="body-theme-default"}}),$rootScope.$on("$viewContentLoaded",function(){$("html, body").animate({scrollTop:0},"slow"),$(".md-editor-toolbar").exists(function(){$(".md-editor-toolbar button").each(function(){var $this=$(this);$this.append('<div class="md-ripple-container"></div>'),$this.children(".material-icons").replaceWith('<md-icon class="material-icons md-dark">'+ICONS[$this.attr("name")]+"</md-icon>")})}),$(".fancybox").fancybox(),$(".lolliclock-duration").lolliclock({hour24:!0}),$(".input-file-material").exists(function(){$(document).on("change",".input-file-material",function(){$(".md-textfield-input").val(this.files[0].name)})}),$(".md-ink-item").exists(function(){$(document).on("click",".md-ink-item",function(e){var $this=$(this);0==$this.find(".md-ink").length&&$this.prepend('<span class="md-ink"></span>');var ink=$this.find(".md-ink");if(ink.removeClass("animate"),!ink.height()&&!ink.width()){var d=Math.max($this.outerWidth(),$this.outerHeight());ink.css({height:d,width:d})}var x=e.pageX-$this.offset().left-ink.width()/2,y=e.pageY-$this.offset().top-ink.height()/2;ink.css({top:y+"px",left:x+"px"}).addClass("animate")})})})}]),String.prototype.trunc=function(n,useWordBoundary){var isTooLong=this.length>n,s_=isTooLong?this.substr(0,n-1):this.substr(0,this.length);return s_=useWordBoundary&&isTooLong?s_.substr(0,s_.lastIndexOf(" ")):s_,isTooLong?s_+"&hellip;":s_},$.fn.exists=function(callback){var args=[].slice.call(arguments,1);return this.length&&callback.call(this,args),this},$.fn.extend({donetyping:function(callback,timeout){timeout=timeout||1e3;var timeoutReference,doneTyping=function(el){timeoutReference&&(timeoutReference=null,callback.call(el))};return this.each(function(i,el){var $el=$(el);$el.is(":input")&&$el.on("keyup keypress paste",function(e){("keyup"!=e.type||8==e.keyCode)&&(timeoutReference&&clearTimeout(timeoutReference),timeoutReference=setTimeout(function(){doneTyping(el)},timeout))}).on("blur",function(){doneTyping(el)})})}}),$.containsId=function(el,array){for(var i=array.length;i--;)if(array[i].id===el.id)return!0;return!1},$.getArrayId=function(array){var a=[];for(var el in array)a.push(array[el].id);return a},$.parseError=function(error){var msg="";if(angular.isArray(error)){msg+="<ul>";for(var i in error)msg+="<li>"+$.parseError(error[i])+"</li>";msg+="</ul>"}else if(angular.isObject(error))for(var i in error)msg+="<ul>",msg+="<li>"+i+"</li>"+$.parseError(error[i]),msg+="</ul>";else msg+=error;return msg};var authController=angular.module("AuthController",[]);authController.controller("Login",["$scope","$rootScope","$location","AuthService","$timeout","NotificationProvider",function($scope,$rootScope,$location,AuthService,$timeout,NotificationProvider){$rootScope.headerTitle="Login",$scope.setDelay1=function(){$scope.delay1=!0,$scope.delay2=!0,$timeout(function(){$scope.delay1=!1},1e3)},$scope.setDelay2=function(){$timeout(function(){$scope.delay2=!1},1e3)},$scope.login=function(){$rootScope.errorMsg=!1,$rootScope.progressBarActivated=!0,$scope.setDelay1(),AuthService.Login($scope.email,$scope.password,!$scope.expiration,function(response){AuthService.SaveCredentials(response.data.auth_token,JSON.parse(AuthService.ParseJwt(response.data.auth_token).sub)),$rootScope.progressBarActivated=!1,$location.path("/")},function(response){400==response.status||401==response.status?$rootScope.error={icon:"error_outline",title:"Datos incorrectos",msg:$.parseError(response.data)}:(NotificationProvider.notify({title:"Un error ha ocurrido",text:"Ha ocurrido un error mientras se logueaba. Por favor, intentelo más tarde.",type:"error",addclass:"custom-error-notify",icon:"material-icons md-light",styling:"fontawesome"}),$(".ui-pnotify.custom-error-notify .material-icons").html("warning"),$rootScope.error={icon:"error_outline",title:"Algo ha ido mal",msg:"Ha ocurrido un error mientras se logueaba."}),$rootScope.errorMsg=!0,$rootScope.progressBarActivated=!1,$scope.setDelay2()})}}]),authController.controller("Register",["$scope","$rootScope","$location","AuthService","$timeout","NotificationProvider",function($scope,$rootScope,$location,AuthService,$timeout,NotificationProvider){$rootScope.headerTitle="Registro",$scope.setDelay1=function(){$scope.delay1=!0,$scope.delay2=!0,$timeout(function(){$scope.delay1=!1},1e3)},$scope.setDelay2=function(){$timeout(function(){$scope.delay2=!1},1e3)},$scope.register=function(){$rootScope.errorMsg=!1,$rootScope.progressBarActivated=!0,$scope.setDelay1();var user={username:$scope.username,email:$scope.email,password:$scope.password,password_repeat:$scope.passwordRepeat,first_name:$scope.first_name,last_name:$scope.last_name};AuthService.Register(user,function(response){AuthService.SaveCredentials(response.data.auth_token,JSON.parse(AuthService.ParseJwt(response.data.auth_token).sub)),$rootScope.progressBarActivated=!1,$location.path("/")},function(response){400==response.status?$rootScope.error={icon:"error_outline",title:"Datos incorrectos",msg:$.parseError(response.data)}:(NotificationProvider.notify({title:"Un error ha ocurrido",text:"Ha ocurrido un error mientras se registraba. Por favor, intentelo más tarde.",type:"error",addclass:"custom-error-notify",icon:"material-icons md-light",styling:"fontawesome"}),$(".ui-pnotify.custom-error-notify .material-icons").html("warning"),$rootScope.error={icon:"error_outline",title:"Algo ha ido mal",msg:"Ha ocurrido un error mientras se registraba."}),$rootScope.errorMsg=!0,$rootScope.progressBarActivated=!1,$scope.setDelay2()})}}]),authController.controller("Logout",["$scope","$location","AuthService","NotificationProvider",function($scope,$location,AuthService,NotificationProvider){NotificationProvider.notify({title:"Adios :)",text:"Gracias por venir. Vuelve pronto.",type:"success",addclass:"custom-success-notify",icon:"material-icons md-light",styling:"fontawesome"}),$(".ui-pnotify.custom-success-notify .material-icons").html("cake"),AuthService.ClearCredentials(),$location.path("/")}]);var categoryController=angular.module("CategoryController",[]),homeController=angular.module("HomeController",[]);homeController.controller("Header",["$scope","$mdSidenav","$timeout","$location",function($scope,$mdSidenav,$timeout,$location){function debounce(func,wait,context){var timer;return function(){var context=$scope,args=Array.prototype.slice.call(arguments);$timeout.cancel(timer),timer=$timeout(function(){timer=void 0,func.apply(context,args)},wait||10)}}function buildDelayedToggler(navID){return debounce(function(){$mdSidenav(navID).toggle().then(function(){})},0)}function closeSideNav(navID){$mdSidenav(navID).close().then(function(){})}$scope.toggleLeft=buildDelayedToggler("left"),$scope.navLinks=[{title:"Home",url:"/"},{title:"Recetas",url:"/recipes"}],$scope.navTo=function(ev,url){closeSideNav("left"),$location.path()!==url&&$location.path(url)},$scope.getClassActive=function(path){var cur_path=$location.path().substr(0,path.length);return cur_path==path?$location.path().substr(0).length>1&&1==path.length?"":"active":""}}]);var recipeController=angular.module("RecipeController",[]);recipeController.constant("DIFF",{"class":{EASY:"md-green",MEDIUM:"md-yellow",HARD:"md-red"},name:["EASY","MEDIUM","HARD"]}),recipeController.constant("FILE_DROPZONE",{FileDragOver:function(e,scope){e.stopPropagation(),e.preventDefault(),e.target.className="dragover"==e.type?"hover":""},FileHandler:function(e,scope,compile,upload,RecipeService,NotificationProvider){this.FileDragOver(e);for(var f,files=e.target.files||e.dataTransfer.files,index=0,i=0;f=files[i];i++)index=scope.images.index,this.ParseFile(f,scope,compile,index,upload,RecipeService,NotificationProvider),scope.images.index++},ParseFile:function(file,scope,compile,index,upload,RecipeService,NotificationProvider){var reader=new FileReader;reader.onload=function(e){$(".images-recipe-gallery").append(compile('<div class="image-removable" ng-if="images.show['+index+']" id="image-removable-'+index+'"><img class="img-thumbnail" src="'+e.target.result+'" /><md-button ng-click="removeImage('+index+')" class="md-fab md-mini md-remove" aria-label="Close"><md-icon class="material-icons">close</md-icon></md-button></div>')(scope))},reader.readAsDataURL(file),scope.images.recipe[index]=file,scope.images.show[index]=!1,upload?RecipeService.uploadFile(file,scope.recipe.id,!1,!1,function(response){scope.images.show[index]=!0,NotificationProvider.notify({title:"Image añadida",text:"",type:"success",addclass:"custom-success-notify",icon:"material-icons md-light",styling:"fontawesome"}),$(".ui-pnotify.custom-success-notify .material-icons").html("photo")},function(response){NotificationProvider.notify({title:"Un error ha ocurrido",text:"Ha ocurrido un error mientras se guardaban las imágenes. Por favor, intentelo más tarde.",type:"error",addclass:"custom-error-notify",icon:"material-icons md-light",styling:"fontawesome"}),$(".ui-pnotify.custom-error-notify .material-icons").html("warning"),$("#image-removable-"+index).exists(function(){$("#image-removable-"+index).remove(),$scope.images.recipe.splice(index,1),$scope.images.show.splice(index,1)})}):scope.images.show[index]=!0}}),recipeController.controller("RecipeAll",["$scope","$rootScope","$location","$sce","RecipeService","NotificationProvider","$mdDialog",function($scope,$rootScope,$location,$sce,RecipeService,NotificationProvider,$mdDialog){$rootScope.headerTitle="Recetas",$scope.pagination={page:1,size:10,search:null},$scope.recipes=[],$scope.sizes=[10,30,50],$scope.$watch(function(){return $location.search()},function(newVal,oldVal){newVal.page||(newVal.page=1),newVal.size||(newVal.size=10),$scope.pagination=newVal,"/recipes"==$location.path()&&($rootScope.lastSearchParams["/recipes"]=$scope.pagination,$scope.getRecipes())}),$scope.searchRecipe=function(){$location.search("search",$scope.pagination.search)},$scope.selectSize=function(){$location.search("size",$scope.pagination.size)},$scope.getRecipes=function(){$rootScope.progressBarActivated=!0,RecipeService.search($scope.pagination,function(response){var responseData=response.data;$scope.recipes=responseData.data,$scope.total=responseData.total,$scope.current=responseData["link-self"],responseData["link-prev"]&&($scope.prev=responseData["link-prev"]),responseData["link-next"]&&($scope.next=responseData["link-next"]),$rootScope.progressBarActivated=!1},function(response){NotificationProvider.notify({title:"Un error ha ocurrido",text:"Ha ocurrido un error mientras se cargaban las recetas. Por favor, intentelo más tarde.",type:"error",addclass:"custom-error-notify",icon:"material-icons md-light",styling:"fontawesome"}),$(".ui-pnotify.custom-error-notify .material-icons").html("warning"),$rootScope.error={icon:"error_outline",title:"Algo ha ido mal",msg:"Ha ocurrido un error mientras se cargaban las recetas."},$rootScope.errorMsg=!0,$rootScope.progressBarActivated=!1})},$scope.description=function(steps){return steps?$sce.trustAsHtml(steps.trunc(260,!0)):void 0},$scope.show=function(slug){$location.path("/recipes/"+slug)},$scope.isMine=function(user){if($rootScope.globals.user){var auth=$rootScope.globals.user.user;return auth.id==user.id&&auth.email==user.email&&auth.username==user.username||"ADMIN"==auth.type}return!1},$scope.edit=function(slug,$event){$event.stopPropagation&&$event.stopPropagation(),$event.preventDefault&&$event.preventDefault(),$event.cancelBubble=!0,$event.returnValue=!1,$scope.recipes=[],$location.path("/recipes/"+slug+"/edit")},$scope.remove=function(recipe,$event){$event.stopPropagation&&$event.stopPropagation(),$event.preventDefault&&$event.preventDefault(),$event.cancelBubble=!0,$event.returnValue=!1;var confirm=$mdDialog.confirm().title("Borrar receta").textContent("¿De verdad que quieres borrar la receta '"+recipe.title+"'?\nEsta acción no se puede deshacer.").ariaLabel("Borrar").targetEvent($event).ok("Borrar").cancel("Cancelar");$mdDialog.show(confirm).then(function(){NotificationProvider.notify({title:"Receta borrada",text:"Has borrado la receta '"+recipe.title+"'.",type:"success",addclass:"custom-success-notify",icon:"material-icons md-light",styling:"fontawesome"});$(".ui-pnotify.custom-success-notify .material-icons").html("check_circle"),$rootScope.progressBarActivated=!0,$rootScope.errorMsg=!1,RecipeService["delete"](recipe.id,function(response){$rootScope.progressBarActivated=!1,$scope.getRecipes()},function(response){404==response.status?$rootScope.error={icon:"error_outline",title:"Datos incorrectos",msg:$.parseError(response.data)}:(NotificationProvider.notify({title:"Un error ha ocurrido",text:"Ha ocurrido un error mientras se borraba la receta. Por favor, intentelo más tarde.",type:"error",addclass:"custom-error-notify",icon:"material-icons md-light",styling:"fontawesome"}),$(".ui-pnotify.custom-error-notify .material-icons").html("warning"),$rootScope.error={icon:"error_outline",title:"Algo ha ido mal",msg:"Ha ocurrido un error mientras se borraba la receta."}),$rootScope.errorMsg=!0,$rootScope.progressBarActivated=!1})},function(){})}}]),recipeController.controller("RecipeShow",["$scope","$rootScope","$location","$routeParams","$sce","RecipeService","NotificationProvider","DIFF",function($scope,$rootScope,$location,$routeParams,$sce,RecipeService,NotificationProvider,DIFF){$rootScope.headerTitle="Cargando",$rootScope.progressBarActivated=!0,$rootScope.HasBack=!0,$rootScope.back=function(){$location.path("/recipes")},RecipeService.get($routeParams.slug,function(response){try{$scope.recipe=response.data,$scope.images=RecipeService.getImages(response.data),$scope.tags=response.data.tags,$scope.comments=response.data.comments,$rootScope.headerTitle=response.data.title,$rootScope.progressBarActivated=!1}catch(err){console.error(err),$rootScope.error={icon:"error_outline",title:"Algo ha ido mal",msg:"Ha ocurrido un error mientras se cargaba la receta."},$rootScope.errorMsg=!0,$rootScope.headerTitle="Error",$rootScope.progressBarActivated=!1}},function(response){404==response.status?($rootScope.error={icon:"error_outline",title:"Error 404",msg:"La receta '"+$routeParams.slug+"' no existe."},$rootScope.errorMsg=!0):(NotificationProvider.notify({title:"Un error ha ocurrido",text:"Ha ocurrido un error mientras se cargaba la receta. Por favor, intentelo más tarde.",type:"error",addclass:"custom-error-notify",icon:"material-icons md-light",styling:"fontawesome"}),$(".ui-pnotify.custom-error-notify .material-icons").html("warning"),$rootScope.error={icon:"error_outline",title:"Algo ha ido mal",msg:"Ha ocurrido un error mientras se cargaba la receta."},$rootScope.errorMsg=!0),$rootScope.headerTitle="Error",$rootScope.progressBarActivated=!1}),$scope.description=function(steps){return steps?$sce.trustAsHtml(steps):void 0},$scope.getDifficulty=function(diff){return DIFF["class"][diff]}}]),recipeController.controller("RecipeCreate",["$scope","$rootScope","$location","RecipeService","CategoryService","TagService","NotificationProvider","DIFF","$timeout","FILE_DROPZONE","$compile",function($scope,$rootScope,$location,RecipeService,CategoryService,TagService,NotificationProvider,DIFF,$timeout,FILE_DROPZONE,$compile){$rootScope.headerTitle="Nueva receta",$rootScope.HasBack=!0,$rootScope.back=function(){$location.path("/recipes")},$scope.requestSlug=null,$scope.validSlug=!0,$scope.loadingSlug=!1,$scope.diffs=DIFF.name,$scope.tags=[],$scope.recipe={ingredients:[],num_persons:0,difficulty:"EASY",duration:"00:00",chipTags:[]},$scope.images={recipe:[],index:0},$scope.imagesLink={},$scope.$watch(function(){return $scope.recipe.newIngredient?$scope.recipe.newIngredient.name:$scope.recipe.newIngredient},function(newVal,oldVal){$scope.newRecipe.newIngredientName.$error={}}),$scope.$watch(function(){return $scope.recipe.title},function(newVal,oldVal){$scope.recipe.slug=RecipeService.getSlug(newVal)}),$scope.$watch(function(){return $scope.recipe.slug},function(newVal,oldVal){$scope.newRecipe.slug.$error={},$scope.abortSlugRequest(),newVal&&newVal.length>0?($scope.loadingSlug=!0,$scope.validSlugIcon="autorenew",$timeout(function(){requestSlug=RecipeService.checkSlug(newVal).then(function(response){$scope.loadingSlug=!1,200==response.status?$scope.validSlugIcon="done":($scope.newRecipe.slug.$error.validSlug=!0,$scope.validSlugIcon="error")},function(response){$scope.loadingSlug=!1,$scope.newRecipe.slug.$error.validSlug=!0,$scope.validSlugIcon="error"})},500)):$scope.validSlugIcon="error"}),$scope.$watch(function(){return $scope.recipe.category_id},function(newVal,oldVal){null==newVal&&($scope.recipe.category_id=void 0)}),$scope.addIngredient=function(){null!=$scope.recipe.newIngredient&&null!=$scope.recipe.newIngredient.name&&""!=$scope.recipe.newIngredient.name?($scope.newRecipe.newIngredientName.$error={},$scope.recipe.ingredients.push({name:$scope.recipe.newIngredient.name,count:$scope.recipe.newIngredient.count}),$scope.recipe.newIngredient.name=null,$scope.recipe.newIngredient.count=null):$scope.newRecipe.newIngredientName.$error.customRequired=!0},$scope.removeIngredient=function(index){$scope.recipe.ingredients.splice(index,1)},$scope.abortSlugRequest=function(){return $scope.requestSlug&&$scope.requestSlug.abort()},$scope.getDifficulty=function(diff){return DIFF["class"][diff]},$scope.loadCategories=function(){CategoryService.all(function(response){$scope.categories=response.data,$scope.categories.unshift({id:null,text:"Ninguna"})},function(response){NotificationProvider.notify({title:"Un error ha ocurrido",text:"Ha ocurrido un error mientras se cargaban las categorias. Por favor, intentelo más tarde.",type:"error",addclass:"custom-error-notify",icon:"material-icons md-light",styling:"fontawesome"}),$(".ui-pnotify.custom-error-notify .material-icons").html("warning")})},$scope.loadTags=function(search){return TagService.all(search,function(response){return response.data},function(response){return NotificationProvider.notify({title:"Un error ha ocurrido",text:"Ha ocurrido un error mientras se cargaban las etiquetas. Por favor, intentelo más tarde.",type:"error",addclass:"custom-error-notify",icon:"material-icons md-light",styling:"fontawesome"}),$(".ui-pnotify.custom-error-notify .material-icons").html("warning"),[]})},$scope.transformChip=function(chip){return angular.isObject(chip)?chip:{text:chip,type:"nuevo"}},$scope.tagSearch=function(search){return search?$scope.loadTags(search).then(function(response){return $scope.tags=response.filter(function(el){return!$.containsId(el,$scope.recipe.chipTags)}),$scope.tags}):[]},$scope.create=function(){$rootScope.progressBarActivated=!0,$rootScope.errorMsg=!1,$rootScope.headerTitle="Creando receta",$("html, body").animate({scrollTop:0},"slow");var recipeObj=$scope.recipe;recipeObj.duration+=":00",recipeObj.newTags=RecipeService.getNewTags(recipeObj.chipTags),recipeObj.tags=$.getArrayId(recipeObj.chipTags),RecipeService.create(recipeObj,function(response){var mainFile=$scope.images.main,slug=response.data.slug,recipeId=response.data.id;$rootScope.headerTitle="Subiendo imágenes",RecipeService.uploadFile(mainFile,recipeId,!0,!1,function(response){$scope.images.recipe.length>0?RecipeService.uploadFile($scope.images.recipe,recipeId,!1,!0,function(response){$rootScope.progressBarActivated=!1,$location.path("/recipes/"+slug)},function(response){400==response.status?$rootScope.error={icon:"error_outline",title:"Datos incorrectos",msg:$.parseError(response.data)}:(NotificationProvider.notify({title:"Un error ha ocurrido",text:"Ha ocurrido un error mientras se guardaban las imágenes. Por favor, intentelo más tarde.",type:"error",addclass:"custom-error-notify",icon:"material-icons md-light",styling:"fontawesome"}),$(".ui-pnotify.custom-error-notify .material-icons").html("warning"),$rootScope.error={icon:"error_outline",title:"Algo ha ido mal",msg:"Ha ocurrido un error mientras se guardaban las imágenes."}),$rootScope.errorMsg=!0,$rootScope.progressBarActivated=!1,$rootScope.headerTitle="Nueva receta"}):($rootScope.progressBarActivated=!1,$location.path("/recipes/"+slug))},function(response){400==response.status?$rootScope.error={icon:"error_outline",title:"Datos incorrectos",msg:$.parseError(response.data)}:(NotificationProvider.notify({title:"Un error ha ocurrido",text:"Ha ocurrido un error mientras se guardaban las imágenes. Por favor, intentelo más tarde.",type:"error",addclass:"custom-error-notify",icon:"material-icons md-light",styling:"fontawesome"}),$(".ui-pnotify.custom-error-notify .material-icons").html("warning"),$rootScope.error={icon:"error_outline",title:"Algo ha ido mal",msg:"Ha ocurrido un error mientras se guardaban las imágenes."}),$rootScope.errorMsg=!0,$rootScope.progressBarActivated=!1,$rootScope.headerTitle="Nueva receta"})},function(response){400==response.status?$rootScope.error={icon:"error_outline",title:"Datos incorrectos",msg:$.parseError(response.data)}:(NotificationProvider.notify({title:"Un error ha ocurrido",text:"Ha ocurrido un error mientras se creaba la receta. Por favor, intentelo más tarde.",type:"error",addclass:"custom-error-notify",icon:"material-icons md-light",styling:"fontawesome"}),$(".ui-pnotify.custom-error-notify .material-icons").html("warning"),$rootScope.error={icon:"error_outline",title:"Algo ha ido mal",msg:"Ha ocurrido un error mientras se creaba la receta."}),$rootScope.errorMsg=!0,$rootScope.progressBarActivated=!1,$rootScope.headerTitle="Nueva receta"})},$scope.removeImage=function(index){$("#image-removable-"+index).exists(function(){$("#image-removable-"+index).remove(),$scope.images.recipe.splice(index,1)})},$scope.$on("$viewContentLoaded",function(){if(window.File&&window.FileList&&window.FileReader){var files=document.getElementById("files"),filedrag=document.getElementById("filedrag");files.addEventListener("change",function(e){FILE_DROPZONE.FileHandler(e,$scope,$compile)},!1);var xhr=new XMLHttpRequest;xhr.upload&&(filedrag.addEventListener("dragover",function(e){FILE_DROPZONE.FileDragOver(e,$scope)},!1),filedrag.addEventListener("dragleave",function(e){FILE_DROPZONE.FileDragOver(e,$scope)},!1),filedrag.addEventListener("drop",function(e){FILE_DROPZONE.FileHandler(e,$scope,$compile)},!1),filedrag.style.display="block")}})}]),recipeController.controller("RecipeEdit",["$scope","$rootScope","$location","RecipeService","CategoryService","TagService","NotificationProvider","DIFF","$timeout","FILE_DROPZONE","$compile","$routeParams","IngredientService",function($scope,$rootScope,$location,RecipeService,CategoryService,TagService,NotificationProvider,DIFF,$timeout,FILE_DROPZONE,$compile,$routeParams,IngredientService){$rootScope.headerTitle="Editar receta",$rootScope.HasBack=!0,$rootScope.back=function(){$location.path("/recipes")},$scope.requestSlug=null,$scope.validSlug=!0,$scope.loadingSlug=!1,$scope.diffs=DIFF.name,$scope.recipe={},$scope.tags=[],$scope.images={recipe:[],show:[],index:0},$scope.imagesLink={},RecipeService.get($routeParams.slug,function(response){try{$scope.recipe=response.data,$scope.recipe.images=RecipeService.getImages(response.data),$scope.recipe.chipTags=response.data.tags,CategoryService.all(function(response){$scope.categories=response.data,$scope.categories.unshift({id:null,text:"Ninguna"}),$scope.recipe.category&&($scope.recipe.category_id=$scope.recipe.category.id)},function(response){NotificationProvider.notify({title:"Un error ha ocurrido",text:"Ha ocurrido un error mientras se cargaban las categorias. Por favor, intentelo más tarde.",type:"error",addclass:"custom-error-notify",icon:"material-icons md-light",styling:"fontawesome"}),$(".ui-pnotify.custom-error-notify .material-icons").html("warning")}),$rootScope.progressBarActivated=!1}catch(err){console.error(err),$rootScope.error={icon:"error_outline",title:"Algo ha ido mal",msg:"Ha ocurrido un error mientras se cargaba la receta."},$rootScope.errorMsg=!0,$rootScope.progressBarActivated=!1}},function(response){404==response.status?$rootScope.error={icon:"error_outline",title:"Error 404",msg:"La receta '"+$routeParams.slug+"' no existe."}:(NotificationProvider.notify({title:"Un error ha ocurrido",text:"Ha ocurrido un error mientras se cargaba la receta. Por favor, intentelo más tarde.",type:"error",addclass:"custom-error-notify",icon:"material-icons md-light",styling:"fontawesome"}),$(".ui-pnotify.custom-error-notify .material-icons").html("warning"),$rootScope.error={icon:"error_outline",title:"Algo ha ido mal",msg:"Ha ocurrido un error mientras se cargaba la receta."}),$rootScope.errorMsg=!0,$rootScope.progressBarActivated=!1}),$scope.$watch(function(){return $scope.recipe.newIngredient?$scope.recipe.newIngredient.name:$scope.recipe.newIngredient},function(newVal,oldVal){$scope.editRecipe.newIngredientName.$error={}}),$scope.$watch(function(){return $scope.recipe.title},function(newVal,oldVal){$scope.recipe.slug=RecipeService.getSlug(newVal)}),$scope.$watch(function(){return $scope.recipe.slug},function(newVal,oldVal){$scope.editRecipe.slug.$error={},$scope.abortSlugRequest(),newVal&&newVal.length>0?($scope.loadingSlug=!0,$scope.validSlugIcon="autorenew",$timeout(function(){requestSlug=RecipeService.checkSlugWithId(newVal,$scope.recipe.id).then(function(response){$scope.loadingSlug=!1,200==response.status?$scope.validSlugIcon="done":($scope.editRecipe.slug.$error.validSlug=!0,$scope.validSlugIcon="error")},function(response){$scope.loadingSlug=!1,$scope.editRecipe.slug.$error.validSlug=!0,$scope.validSlugIcon="error"})},500)):$scope.validSlugIcon="error"}),$scope.$watch(function(){return $scope.recipe.category_id},function(newVal,oldVal){null==newVal&&($scope.recipe.category_id=void 0)}),$scope.addIngredient=function(){if(null!=$scope.recipe.newIngredient&&null!=$scope.recipe.newIngredient.name&&""!=$scope.recipe.newIngredient.name){$scope.editRecipe.newIngredientName.$error={};var ingredient={name:$scope.recipe.newIngredient.name,count:$scope.recipe.newIngredient.count};IngredientService.add($scope.recipe.id,ingredient,function(response){$scope.recipe.ingredients.push(response.data),$scope.recipe.newIngredient.name=null,$scope.recipe.newIngredient.count=null,NotificationProvider.notify({title:"Ingrediente añadido",text:"",type:"success",addclass:"custom-success-notify",icon:"material-icons md-light",styling:"fontawesome"}),$(".ui-pnotify.custom-success-notify .material-icons").html("restaurant_menu")},function(response){400==response.status?NotificationProvider.notify({title:"Datos incorrectos",text:$.parseError(response.data),type:"error",addclass:"custom-error-notify",icon:"material-icons md-light",styling:"fontawesome"}):NotificationProvider.notify({title:"Un error ha ocurrido",text:"Ha ocurrido un error mientras se añadía el ingrediente. Por favor, intentelo más tarde.",type:"error",addclass:"custom-error-notify",icon:"material-icons md-light",styling:"fontawesome"}),$(".ui-pnotify.custom-error-notify .material-icons").html("warning"),$scope.recipe.newIngredient.name=null,$scope.recipe.newIngredient.count=null})}else $scope.editRecipe.newIngredientName.$error.customRequired=!0},$scope.removeIngredient=function(index){var ingredient=$scope.recipe.ingredients[index];IngredientService["delete"]($scope.recipe.id,ingredient.id,function(response){$scope.recipe.ingredients.splice(index,1),NotificationProvider.notify({title:"Ingrediente borrado",text:"",type:"success",addclass:"custom-success-notify",icon:"material-icons md-light",styling:"fontawesome"}),$(".ui-pnotify.custom-success-notify .material-icons").html("restaurant_menu"),console.log($scope.recipe)},function(response){400==response.status?NotificationProvider.notify({title:"Datos incorrectos",text:$.parseError(response.data),type:"error",addclass:"custom-error-notify",icon:"material-icons md-light",styling:"fontawesome"}):NotificationProvider.notify({title:"Un error ha ocurrido",text:"Ha ocurrido un error mientras se borraba el ingrediente. Por favor, intentelo más tarde.",
type:"error",addclass:"custom-error-notify",icon:"material-icons md-light",styling:"fontawesome"}),$(".ui-pnotify.custom-error-notify .material-icons").html("warning")})},$scope.abortSlugRequest=function(){return $scope.requestSlug&&$scope.requestSlug.abort()},$scope.getDifficulty=function(diff){return DIFF["class"][diff]},$scope.loadCategories=function(){CategoryService.all(function(response){$scope.categories=response.data,$scope.categories.unshift({id:null,text:"Ninguna"})},function(response){NotificationProvider.notify({title:"Un error ha ocurrido",text:"Ha ocurrido un error mientras se cargaban las categorias. Por favor, intentelo más tarde.",type:"error",addclass:"custom-error-notify",icon:"material-icons md-light",styling:"fontawesome"}),$(".ui-pnotify.custom-error-notify .material-icons").html("warning")})},$scope.loadTags=function(search){return TagService.all(search,function(response){return response.data},function(response){return NotificationProvider.notify({title:"Un error ha ocurrido",text:"Ha ocurrido un error mientras se cargaban las etiquetas. Por favor, intentelo más tarde.",type:"error",addclass:"custom-error-notify",icon:"material-icons md-light",styling:"fontawesome"}),$(".ui-pnotify.custom-error-notify .material-icons").html("warning"),[]})},$scope.transformChip=function(chip){return angular.isObject(chip)?chip:{text:chip,type:"nuevo"}},$scope.tagSearch=function(search){return search?$scope.loadTags(search).then(function(response){return $scope.tags=response.filter(function(el){return!$.containsId(el,$scope.recipe.chipTags)}),$scope.tags}):[]},$scope.edit=function(){$rootScope.progressBarActivated=!0,$rootScope.errorMsg=!1,$rootScope.headerTitle="Creando receta",$("html, body").animate({scrollTop:0},"slow");var recipeObj=$scope.recipe;recipeObj.duration+=":00",recipeObj.newTags=RecipeService.getNewTags(recipeObj.chipTags),recipeObj.tags=$.getArrayId(recipeObj.chipTags),RecipeService.edit(recipeObj,function(response){var mainFile=$scope.images.main,slug=response.data.slug;if(mainFile){var recipeId=response.data.id;$rootScope.headerTitle="Subiendo imágenes",RecipeService.uploadFile(mainFile,recipeId,!0,!1,function(response){$rootScope.progressBarActivated=!1,$location.path("/recipes/"+slug)},function(response){400==response.status?$rootScope.error={icon:"error_outline",title:"Datos incorrectos",msg:$.parseError(response.data)}:(NotificationProvider.notify({title:"Un error ha ocurrido",text:"Ha ocurrido un error mientras se guardaban las imágenes. Por favor, intentelo más tarde.",type:"error",addclass:"custom-error-notify",icon:"material-icons md-light",styling:"fontawesome"}),$(".ui-pnotify.custom-error-notify .material-icons").html("warning"),$rootScope.error={icon:"error_outline",title:"Algo ha ido mal",msg:"Ha ocurrido un error mientras se guardaban las imágenes."}),$rootScope.errorMsg=!0,$rootScope.progressBarActivated=!1,$rootScope.headerTitle="Editar receta"})}else $rootScope.progressBarActivated=!1,$location.path("/recipes/"+slug)},function(response){400==response.status?$rootScope.error={icon:"error_outline",title:"Datos incorrectos",msg:$.parseError(response.data)}:(NotificationProvider.notify({title:"Un error ha ocurrido",text:"Ha ocurrido un error mientras se guardaba la receta. Por favor, intentelo más tarde.",type:"error",addclass:"custom-error-notify",icon:"material-icons md-light",styling:"fontawesome"}),$(".ui-pnotify.custom-error-notify .material-icons").html("warning"),$rootScope.error={icon:"error_outline",title:"Algo ha ido mal",msg:"Ha ocurrido un error mientras se guardaba la receta."}),$rootScope.errorMsg=!0,$rootScope.progressBarActivated=!1,$rootScope.headerTitle="Editar receta"})},$scope.removeImage=function(index){$("#image-removable-"+index).exists(function(){RecipeService.deleteFile(index,function(response){NotificationProvider.notify({title:"Image borrada",text:"",type:"success",addclass:"custom-success-notify",icon:"material-icons md-light",styling:"fontawesome"}),$(".ui-pnotify.custom-success-notify .material-icons").html("photo_filter"),$("#image-removable-"+index).remove(),$scope.images.recipe.splice(index,1),$scope.images.show.splice(index,1)},function(response){NotificationProvider.notify({title:"Un error ha ocurrido",text:"Ha ocurrido un error mientras se borraban las imágenes. Por favor, intentelo más tarde.",type:"error",addclass:"custom-error-notify",icon:"material-icons md-light",styling:"fontawesome"}),$(".ui-pnotify.custom-error-notify .material-icons").html("warning")})})},$scope.$on("$viewContentLoaded",function(){if(window.File&&window.FileList&&window.FileReader){var files=document.getElementById("files"),filedrag=document.getElementById("filedrag");files.addEventListener("change",function(e){FILE_DROPZONE.FileHandler(e,$scope,$compile,!0,RecipeService,NotificationProvider)},!1);var xhr=new XMLHttpRequest;xhr.upload&&(filedrag.addEventListener("dragover",function(e){FILE_DROPZONE.FileDragOver(e,$scope)},!1),filedrag.addEventListener("dragleave",function(e){FILE_DROPZONE.FileDragOver(e,$scope)},!1),filedrag.addEventListener("drop",function(e){FILE_DROPZONE.FileHandler(e,$scope,$compile,!0,RecipeService,NotificationProvider)},!1),filedrag.style.display="block")}})}]);var animationModule=angular.module("Animations",[]);animationModule.animation(".animation-card-recipes",function(){return{enter:function(element,done){return element.css({opacity:0}),jQuery(element).animate({opacity:1},done),function(isCancelled){isCancelled&&jQuery(element).stop()}},leave:function(element,done){return element.css("opacity",1),jQuery(element).animate({opacity:0},done),function(isCancelled){isCancelled&&jQuery(element).stop()}},move:function(element,done){return element.css("opacity",0),jQuery(element).animate({opacity:1},done),function(isCancelled){isCancelled&&jQuery(element).stop()}},addClass:function(element,className,done){},removeClass:function(element,className,done){}}}),function(){function createSvgElement(name){return document.createElementNS(svgNS,name)}function leadingZero(num){return(10>num?"0":"")+num}function uniqueId(prefix){var id=++idCounter+"";return prefix?prefix+id:id}function LolliClock(element,options){function mousedown(e){var offset=plate.offset(),isTouch=/^touch/.test(e.type),x0=offset.left+dialRadius,y0=offset.top+dialRadius,dx=(isTouch?e.originalEvent.touches[0]:e).pageX-x0,dy=(isTouch?e.originalEvent.touches[0]:e).pageY-y0,z=Math.sqrt(dx*dx+dy*dy),moved=!1;if(outsideMode=!0,outSizeRadius+tickRadius>z&&z>outSizeRadius-tickRadius)outsideMode=!0;else{if(!(z>radius-tickRadius&&radius+tickRadius>z&&options.hour24&&"hours"===self.currentView))return;outsideMode=!1}e.preventDefault(),$(document.body).addClass("lolliclock-moving"),plate.append(self.canvas),self.setHand(dx,dy,outsideMode),$(document).off(mousemoveEvent).on(mousemoveEvent,function(e){e.preventDefault();var isTouch=/^touch/.test(e.type),x=(isTouch?e.originalEvent.touches[0]:e).pageX-x0,y=(isTouch?e.originalEvent.touches[0]:e).pageY-y0;(moved||x!==dx||y!==dy)&&(moved=!0,self.setHand(x,y,outsideMode))}),$(document).off(mouseupEvent).on(mouseupEvent,function(e){e.preventDefault();var isTouch=/^touch/.test(e.type),x=(isTouch?e.originalEvent.changedTouches[0]:e).pageX-x0,y=(isTouch?e.originalEvent.changedTouches[0]:e).pageY-y0;x===dx&&y===dy&&self.setHand(x,y,outsideMode),"hours"===self.currentView?self.toggleView("minutes",duration/2):options.autoclose&&self.done(),plate.prepend(canvas),$(document.body).removeClass("lolliclock-moving"),$(document).off(mousemoveEvent),$(document).off(mouseupEvent)})}var popover=$(tpl),plate=popover.find(".lolliclock-plate"),hoursView=popover.find(".lolliclock-dial-hours"),minutesView=popover.find(".lolliclock-dial-minutes"),isInput="INPUT"===element.prop("tagName"),input=isInput?element:element.find("input"),self=this;if(this.id=uniqueId("lolli"),this.element=element,this.options=options,this.isAppended=!1,this.isShown=!1,this.currentView="hours",this.isInput=isInput,this.input=input,this.popover=popover,this.plate=plate,this.hoursView=hoursView,this.minutesView=minutesView,this.header=popover.find(".lolliclock-header"),this.spanHours=popover.find(".lolliclock-hours"),this.spanMinutes=popover.find(".lolliclock-minutes"),this.spanNewTime=popover.find(".lolliclock-time-new"),this.spanOldTime=popover.find(".lolliclock-time-old"),this.spanAmPm=popover.find(".lolliclock-am-pm"),this.amOrPm="PM",this.AmPmButtons=popover.find(".lolliclock-ampm-btn"),this.amButton=popover.find("#lolliclock-btn-am"),this.pmButton=popover.find("#lolliclock-btn-pm"),this.options.hour24&&(this.AmPmButtons.hide(),this.spanAmPm.hide()),!options.autoclose){this.popover.css("height","380px");var $closeButtons=$('<div class="lolliclock-buttons"></div>').appendTo(popover);$('<div class="lolliclock-button">Cancel</div>').click($.proxy(this.hide,this)).appendTo($closeButtons),$('<div class="lolliclock-button">OK</div>').click($.proxy(this.done,this)).appendTo($closeButtons),this.closeButtons=popover.find(".lolliclock-button")}input.on("focus.lolliclock click.lolliclock",$.proxy(this.show,this));var i,tick,radian,tickTpl=$('<div class="lolliclock-tick"></div>');if(options.hour24){for(i=1;13>i;i++)tick=tickTpl.clone(),radian=i/6*Math.PI,tick.css({left:dialRadius+Math.sin(radian)*radius-tickRadius,top:dialRadius-Math.cos(radian)*radius-tickRadius}),tick.html(i),hoursView.append(tick);for(i=13;24>=i;i++)tick=tickTpl.clone(),radian=i/6*Math.PI,tick.css({left:dialRadius+Math.sin(radian)*outSizeRadius-tickRadius,top:dialRadius-Math.cos(radian)*outSizeRadius-tickRadius}),24===i?tick.html("00"):tick.html(i),hoursView.append(tick)}else for(i=1;13>i;i++)tick=tickTpl.clone(),radian=i/6*Math.PI,tick.css({left:dialRadius+Math.sin(radian)*outSizeRadius-tickRadius,top:dialRadius-Math.cos(radian)*outSizeRadius-tickRadius}),tick.html(i),hoursView.append(tick);for(i=0;60>i;i+=5)tick=tickTpl.clone(),radian=i/30*Math.PI,tick.css({left:dialRadius+Math.sin(radian)*outSizeRadius-tickRadius,top:dialRadius-Math.cos(radian)*outSizeRadius-tickRadius}),tick.html(leadingZero(i)),minutesView.append(tick);plate.on(mousedownEvent,mousedown);var canvas=popover.find(".lolliclock-canvas"),svg=createSvgElement("svg");svg.setAttribute("class","lolliclock-svg"),svg.setAttribute("width",diameter),svg.setAttribute("height",diameter);var g=createSvgElement("g");g.setAttribute("transform","translate("+dialRadius+","+dialRadius+")");var bearing=createSvgElement("circle");bearing.setAttribute("class","lolliclock-bearing"),bearing.setAttribute("cx",0),bearing.setAttribute("cy",0),bearing.setAttribute("r",1.25);var hand=createSvgElement("line");hand.setAttribute("x1",0),hand.setAttribute("y1",0);var bg=createSvgElement("circle");bg.setAttribute("class","lolliclock-canvas-bg"),bg.setAttribute("r",tickRadius);var fg=createSvgElement("circle");fg.setAttribute("class","lolliclock-canvas-fg"),fg.setAttribute("r",3.5),g.appendChild(hand),g.appendChild(bg),g.appendChild(fg),g.appendChild(bearing),svg.appendChild(g),canvas.append(svg),this.hand=hand,this.bg=bg,this.fg=fg,this.bearing=bearing,this.g=g,this.canvas=canvas,raiseCallback(this.options.init)}function raiseCallback(callbackFunction){callbackFunction&&"function"==typeof callbackFunction&&callbackFunction()}var $=window.jQuery;LolliClock.DEFAULTS={startTime:"",autoclose:!1,vibrate:!0,hour24:!1};var touchSupported="ontouchstart"in window,mousedownEvent="mousedown"+(touchSupported?" touchstart":""),mousemoveEvent="mousemove.lolliclock"+(touchSupported?" touchmove.lolliclock":""),mouseupEvent="mouseup.lolliclock"+(touchSupported?" touchend.lolliclock":""),vibrate=navigator.vibravarte?"vibrate":navigator.webkitVibrate?"webkitVibrate":null,svgNS="http://www.w3.org/2000/svg",idCounter=0,dialRadius=84,radius=50,outSizeRadius=70,tickRadius=12,diameter=2*dialRadius,duration=350,tpl=['<div class="lolliclock-popover">','<div class="lolliclock-header">','<div class="lolliclock-time">','<div class="lolliclock-hours lolliclock-primary-text">','<div class="lolliclock-time-old"></div>','<div class="lolliclock-time-new"></div>',"</div>",'<span class="lolliclock-colon">:</span>','<div class="lolliclock-minutes">','<div class="lolliclock-time-old"></div>','<div class="lolliclock-time-new"></div>',"</div>","</div>",'<span class="lolliclock-am-pm"></span>',"</div>",'<div class="popover-content">','<div class="lolliclock-plate">','<div class="lolliclock-canvas"></div>','<div class="lolliclock-dial lolliclock-dial-hours"></div>','<div class="lolliclock-dial lolliclock-dial-minutes lolliclock-dial-out"></div>',"</div>",'<div class="lolliclock-ampm-block">','<div id="lolliclock-btn-am" class="lolliclock-ampm-btn">','<div class="lolliclock-btn-background"></div>','<div class="lolliclock-btn-text">AM</div>',"</div>",'<div style="flex: 1;"></div>','<div id="lolliclock-btn-pm" class="lolliclock-ampm-btn">','<div class="lolliclock-btn-background"></div>','<div class="lolliclock-btn-text">PM</div>',"</div>","</div>","</div>","</div>"].join("");LolliClock.prototype.toggle=function(){this[this.isShown?"hide":"show"]()},LolliClock.prototype.changeAmPm=function(isAmOrPm){isAmOrPm&&isAmOrPm===this.amOrPm&&this.options.hour24||(this.amOrPm="AM"===this.amOrPm?"PM":"AM",this.spanAmPm.html(this.amOrPm),$(this.amButton[0].childNodes[0]).toggleClass("lolliclock-active-button-background","AM"===this.amOrPm),$(this.pmButton[0].childNodes[0]).toggleClass("lolliclock-active-button-background","PM"===this.amOrPm),$(this.amButton[0].childNodes[1]).toggleClass("lolliclock-active-button-text","AM"===this.amOrPm),$(this.pmButton[0].childNodes[1]).toggleClass("lolliclock-active-button-text","PM"===this.amOrPm))},LolliClock.prototype.locate=function(){var element=this.element,popover=this.popover,popoverMargin=8,leftOffset=element.offset().left+(element.outerWidth()-popover.width())/2,maxLeft=$(window).width()-popover.width()-popoverMargin,minLeft=popoverMargin,maxTop=$(window).height()+$(window).scrollTop()-popoverMargin-popover.height(),minTop=popoverMargin+$(window).scrollTop(),topOffset=element.offset().top,styles={};styles.top=minTop>topOffset?minTop:topOffset>maxTop?maxTop:topOffset,styles.left=minLeft>leftOffset?minLeft:leftOffset>maxLeft?maxLeft:leftOffset,popover.css(styles),popover.show()},LolliClock.prototype.show=function(){function timeToDate(time){var parts=time.split(":");if(2===parts.length){var hours=+parts[0],minAM=parts[1].split(" ");if(2===minAM.length){var mins=minAM[0];return"PM"===minAM[1]&&(hours+=12),new Date(1970,1,1,hours,mins)}}return new Date("x")}function isValidTime(time){return!isNaN(timeToDate(time).getTime())}if(!this.isShown){raiseCallback(this.options.beforeShow);var self=this;this.isAppended||($(document.body).append(this.popover),this.isAppended=!0,$(window).on("resize.lolliclock"+this.id,function(){self.isShown&&self.locate()}),$(window).on("scroll.lolliclock",function(){self.isShown&&self.locate()}),this.AmPmButtons.on("click",function(e){self.changeAmPm(e.currentTarget.children[1].innerHTML)}),this.spanMinutes.on("click",function(){self.toggleView("minutes")}),this.spanHours.on("click",function(){self.toggleView("hours")}),this.spanAmPm.on("click",function(){self.changeAmPm()})),self.locate(),this.plate.addClass("animate"),this.header.addClass("animate"),this.popover.addClass("animate"),this.AmPmButtons.addClass("animate"),this.spanNewTime.addClass("animate"),this.spanOldTime.addClass("animate"),!this.options.autoclose&&this.closeButtons.addClass("animate"),this.plate.on("webkitAnimationEnd animationend MSAnimationEnd oanimationend",function(){self.plate.removeClass("animate"),self.header.removeClass("animate"),self.popover.removeClass("animate"),self.AmPmButtons.removeClass("animate"),self.spanNewTime.removeClass("animate"),self.spanOldTime.removeClass("animate"),!self.options.autoclose&&self.closeButtons.removeClass("animate"),self.plate.off("webkitAnimationEnd animationend MSAnimationEnd oanimationend")});var value,inputValue=this.input.prop("value"),defaultValue=this.options.startTime,placeholderValue=this.input.prop("placeholder");value=inputValue&&isValidTime(inputValue)?timeToDate(inputValue):"now"===defaultValue?new Date:defaultValue&&isValidTime(defaultValue)?timeToDate(defaultValue):placeholderValue&&isValidTime(placeholderValue)?timeToDate(placeholderValue):new Date,this.options.hour24?this.hours=value.getHours():(this.hours=value.getHours()%12,this.amOrPm=value.getHours()>11?"AM":"PM"),this.minutes=value.getMinutes(),this.changeAmPm(),self.toggleView("minutes"),self.toggleView("hours"),self.isShown=!0,$(document).on("click.lolliclock."+this.id+" focusin.lolliclock."+this.id,function(e){var target=$(e.target);0===target.closest(self.popover).length&&0===target.closest(self.input).length&&self.done()}),$(document).on("keyup.lolliclock."+this.id,function(e){27===e.keyCode&&self.hide()}),raiseCallback(this.options.afterShow)}},LolliClock.prototype.hide=function(){raiseCallback(this.options.beforeHide);var self=this;self.popover.addClass("animate-out"),self.plate.addClass("animate-out"),self.header.addClass("animate-out"),self.AmPmButtons.addClass("animate-out"),!self.options.autoclose&&self.closeButtons.addClass("animate-out"),this.popover.on("webkitAnimationEnd animationend MSAnimationEnd oanimationend",function(){$(self.spanHours[0].childNodes[0]).html(""),$(self.spanMinutes[0].childNodes[0]).html(""),self.popover.removeClass("animate-out"),self.plate.removeClass("animate-out"),self.header.removeClass("animate-out"),self.AmPmButtons.removeClass("animate-out"),!self.options.autoclose&&self.closeButtons.removeClass("animate-out"),self.popover.off("webkitAnimationEnd animationend MSAnimationEnd oanimationend"),$(document).off("click.lolliclock."+self.id+" focusin.lolliclock."+self.id),$(document).off("keyup.lolliclock."+self.id),self.popover.hide(),raiseCallback(self.options.afterHide)}),self.isShown=!1},LolliClock.prototype.toggleView=function(view,delay){var isHours="hours"===view,nextView=isHours?this.hoursView:this.minutesView,hideView=isHours?this.minutesView:this.hoursView;if(this.currentView=view,this.spanHours.toggleClass("lolliclock-primary-text",isHours),this.spanMinutes.toggleClass("lolliclock-primary-text",!isHours),hideView.addClass("lolliclock-dial-out"),nextView.css("visibility","visible").removeClass("lolliclock-dial-out"),this.resetClock(delay),clearTimeout(this.toggleViewTimer),this.toggleViewTimer=setTimeout(function(){hideView.css("visibility","hidden")},duration),isHours)this.plate.off(mousemoveEvent);else{var self=this;this.plate.on(mousemoveEvent,function(e){var offset=self.plate.offset(),x0=offset.left+dialRadius,y0=offset.top+dialRadius,dx=e.pageX-x0,dy=e.pageY-y0,z=Math.sqrt(dx*dx+dy*dy);z>outSizeRadius-tickRadius&&outSizeRadius+tickRadius>z?$(document.body).addClass("lolliclock-clickable"):$(document.body).removeClass("lolliclock-clickable")})}},LolliClock.prototype.resetClock=function(delay){var view=this.currentView,outSizeMode=!0,value=this[view],isHours="hours"===view;isHours?(unit=Math.PI/6,0!==value&&12>=value&&this.options.hour24&&(outSizeMode=!1)):unit=Math.PI/30;var radian=value*unit,x=Math.sin(radian)*radius,y=-Math.cos(radian)*radius,self=this;delay?(self.canvas.addClass("lolliclock-canvas-out"),setTimeout(function(){self.canvas.removeClass("lolliclock-canvas-out"),self.setHand(x,y,outSizeMode)},delay)):this.setHand(x,y,outSizeMode)},LolliClock.prototype.setHand=function(x,y,outSizeMode){function cleanupAnimation($obj){$obj.on("webkitAnimationEnd animationend MSAnimationEnd oanimationend",function(){$oldTime.html(value),$oldTime.removeClass("old-down old-up"),$newTime.removeClass("new-down new-up"),$oldTime.off("webkitAnimationEnd animationend MSAnimationEnd oanimationend")})}var value,radian=Math.atan2(-x,y)+Math.PI,isHours="hours"===this.currentView,unit=Math.PI/(isHours?6:30);if(outSizeMode&&this.options.hour24&&isHours?(value=Math.round(radian/unit),12===value||0===value?value=0:value+=12):value=Math.round(radian/unit),radian=value*unit,isHours)0!==value||this.options.hour24&&outSizeMode||(value=12),this.fg.style.visibility="hidden";else{var isOnNum=value%5===0;isOnNum?this.fg.style.visibility="hidden":this.fg.style.visibility="visible",60===value&&(value=0)}this[this.currentView]!==value&&vibrate&&this.options.vibrate&&(this.vibrateTimer||(navigator[vibrate](10),this.vibrateTimer=setTimeout($.proxy(function(){this.vibrateTimer=null},this),100))),this[this.currentView]=value;var $oldTime,$newTime;isHours?($oldTime=$(this.spanHours[0].childNodes[0]),$newTime=$(this.spanHours[0].childNodes[1]),this.options.hour24&&(value=leadingZero(value))):($oldTime=$(this.spanMinutes[0].childNodes[0]),$newTime=$(this.spanMinutes[0].childNodes[1]),value=leadingZero(value)),cleanupAnimation($oldTime),value<+$oldTime.html()?($newTime.html($oldTime.html()),$oldTime.html(value),$newTime.addClass("new-down"),$oldTime.addClass("old-down")):(value>+$oldTime.html()||!$oldTime.html())&&($newTime.html(value),$oldTime.addClass("old-up"),$newTime.addClass("new-up")),this.g.insertBefore(this.hand,this.bearing),this.g.insertBefore(this.bg,this.fg),this.bg.setAttribute("class","lolliclock-canvas-bg");var r=radius;outSizeMode&&(r=outSizeRadius);var cx=Math.sin(radian)*r,cy=-Math.cos(radian)*r;this.hand.setAttribute("x2",Math.sin(radian)*(r-tickRadius)),this.hand.setAttribute("y2",-Math.cos(radian)*(r-tickRadius)),this.bg.setAttribute("cx",cx),this.bg.setAttribute("cy",cy),this.fg.setAttribute("cx",cx),this.fg.setAttribute("cy",cy)},LolliClock.prototype.done=function(){raiseCallback(this.options.beforeDone);var last=this.input.prop("value"),value="";value=this.options.hour24?leadingZero(this.hours)+":"+leadingZero(this.minutes):this.hours+":"+leadingZero(this.minutes)+" "+this.amOrPm,value!==last&&(this.input.prop("value",value),this.input.trigger("input"),this.input.trigger("change")),this.hide()},LolliClock.prototype.remove=function(){this.element.removeData("lolliclock"),this.input.off("focus.lolliclock click.lolliclock"),this.isShown&&this.hide(),this.isAppended&&($(window).off("resize.lolliclock"+this.id),$(window).off("scroll.lolliclock"+this.id),this.popover.remove())},$.fn.lolliclock=function(option){var args=Array.prototype.slice.call(arguments,1);return this.each(function(){var $this=$(this),data=$this.data("lolliclock");if(data)"function"==typeof data[option]&&data[option].apply(data,args);else{var options=$.extend({},LolliClock.DEFAULTS,$this.data(),"object"==typeof option&&option);$this.data("lolliclock",new LolliClock($this,options))}})}}();var textEditorModule=angular.module("TextEditor",[]);textEditorModule.constant("ICONS",{quote:"format_quote",bold:"format_bold",italics:"format_italic",underline:"format_underline",ul:"format_list_bulleted",ol:"format_list_numbered",redo:"redo",undo:"undo",clear:"format_clear",justifyLeft:"format_align_left",justifyCenter:"format_align_center",justifyRight:"format_align_right",justifyFull:"format_align_justify",html:"code",insertImage:"insert_photo",insertLink:"insert_link"}),textEditorModule.config(["$provide",function($provide){$provide.decorator("taOptions",["$delegate",function(taOptions){return taOptions.toolbar=[["h1","h2","h3","h4","h5","h6","p","pre","quote","bold","italics","underline","ul","ol","redo","undo","clear","justifyLeft","justifyCenter","justifyRight","justifyFull","html","insertImage","insertLink"]],taOptions}]),$provide.decorator("taTools",["$delegate",function(taTools){return taTools.quote.iconclass="material-icons",taTools.bold.iconclass="material-icons",taTools.italics.iconclass="material-icons",taTools.underline.iconclass="material-icons",taTools.ul.iconclass="material-icons",taTools.ol.iconclass="material-icons",taTools.undo.iconclass="material-icons",taTools.redo.iconclass="material-icons",taTools.clear.iconclass="material-icons",taTools.justifyLeft.iconclass="material-icons",taTools.justifyRight.iconclass="material-icons",taTools.justifyCenter.iconclass="material-icons",taTools.justifyFull.iconclass="material-icons",taTools.html.iconclass="material-icons",taTools.insertLink.iconclass="material-icons",taTools.insertImage.iconclass="material-icons",taTools}])}]);var fileDirective=angular.module("FileDirectives",[]);fileDirective.directive("fileModel",["$parse",function($parse){return{restrict:"A",link:function($scope,element,attrs){var model=$parse(attrs.fileModel),modelSetter=model.assign;element.bind("change",function(){var file=element[0].files[0];$scope.$apply(function(){modelSetter($scope,file)})})}}}]),fileDirective.directive("fileThumbnail",function(){return{restrict:"A",link:function($scope,element,attrs){element.bind("change",function(){var reader=new FileReader,file=element[0].files[0];$scope.images.name=file.name,reader.onload=function(theFile){return function(event){var image=document.getElementById(attrs.fileThumbnail);image.src=event.target.result}}(file),reader.readAsDataURL(file)})}}});var timeDirective=angular.module("TimeDirectives",[]);timeDirective.directive("strToTime",function(){return{require:"ngModel",link:function($scope,element,attrs,ngModelController){ngModelController.$parsers.push(function(data){return data?("0"+data.getHours().toString()).slice(-2)+":"+("0"+data.getMinutes().toString()).slice(-2):""}),ngModelController.$formatters.push(function(data){if(!data)return null;var d=new Date(1970,1,1),splitted=data.split(":");return d.setHours(splitted[0]),d.setMinutes(splitted[1]),d})}}});var notificationProvider=angular.module("NotificationProviders",[]);notificationProvider.provider("NotificationProvider",[function(){var settings={styling:"bootstrap3"};this.setDefaults=function(defaults){settings=defaults},PNotify.desktop.permission(),this.$get=[function(){return{getSettings:function(){return settings},notice:function(content){var hash=angular.copy(settings);return hash.type="notice",hash.text=content,this.notify(hash)},info:function(content){var hash=angular.copy(settings);return hash.type="info",hash.text=content,this.notify(hash)},success:function(content){var hash=angular.copy(settings);return hash.type="success",hash.text=content,this.notify(hash)},error:function(content){var hash=angular.copy(settings);return hash.type="error",hash.text=content,this.notify(hash)},notify:function(hash){hash.mobile={swipe_dismiss:!0,styling:!0};var notification=new PNotify(hash);notification.get().click(function(){notification.remove()})}}}]}]);var recipeFilter=angular.module("RecipeFilters",[]);recipeFilter.filter("mainImage",["RecipeService",function(RecipeService){return function(input){return RecipeService.getImages(input).main.href}}]),recipeFilter.filter("capitalize",function(){return function(input){return input?input.charAt(0).toUpperCase()+input.substr(1).toLowerCase():""}}),recipeFilter.filter("humanized",function(){return function(input){switch(input){case"EASY":return"Fácil";case"MEDIUM":return"Media";case"HARD":return"Difícil";default:return""}}}),recipeFilter.filter("duration",function(){return function(input){var hour=moment.duration(input).hours(),minute=moment.duration(input).minutes(),duration="";return hour>0&&(duration=moment.duration(hour,"hours").humanize(),minute>0&&(duration+=" y ")),duration+=moment.duration(minute,"minutes").humanize()}}),recipeFilter.filter("searchFor",["RecipeService","$rootScope","$scope","NotificationProvider",function(RecipeService,$rootScope,$scope,NotificationProvider){return function(result,search){if(!search)return result;var result=[];search=search.toLowerCase(),$rootScope.progressBarActivated=!0,$scope.pagination.search=search,RecipeService.search($scope.pagination,function(response){var responseData=response.data;$scope.recipes=responseData.data,$scope.total=responseData.total,$scope.current=responseData["link-self"],responseData["link-prev"]&&($scope.prev=responseData["link-prev"]),responseData["link-next"]&&($scope.next=responseData["link-next"]),$rootScope.progressBarActivated=!1},function(response){NotificationProvider.notify({title:"Un error ha ocurrido",text:"Ha ocurrido un error mientras se cargaban las recetas. Por favor, intentelo más tarde.",type:"error",addclass:"custom-error-notify",icon:"material-icons md-light",styling:"fontawesome"}),$(".ui-pnotify.custom-error-notify .material-icons").html("warning"),$rootScope.error={icon:"error_outline",title:"Algo ha ido mal",msg:"Ha ocurrido un error mientras se cargaban las recetas."},$rootScope.errorMsg=!0,$rootScope.progressBarActivated=!1})}}]);var authServices=angular.module("AuthServices",["ngResource"]);authServices.factory("AuthService",["$http","$rootScope","$timeout","envService","$q",function($http,$rootScope,$timeout,envService,$q){var service={apiUrl:envService.read("apiUrl"),OK:200,UNAUTHORIZED:401,FORBIDDEN:403};return service.Login=function(email,password,expiration,callbackOk,callbackError){$http.post(service.apiUrl+"/auth/login",{email:email,password:password,setExpiration:expiration},{headers:{Accept:"application/json","Content-Type":"application/json"}}).then(function(response){callbackOk(response)},function(response){callbackError(response)})},service.Register=function(user,callbackOk,callbackError){$http.post(service.apiUrl+"/auth/register",user,{headers:{Accept:"application/json","Content-Type":"application/json"}}).then(function(response){callbackOk(response)},function(response){callbackError(response)})},service.SaveCredentials=function(token,user){$rootScope.globals={token:token,user:user},localStorage.globals=JSON.stringify($rootScope.globals)},service.ClearCredentials=function(){$rootScope.globals={},localStorage.removeItem("globals")},service.ParseJwt=function(token){var base64Url=token.split(".")[1],base64=base64Url.replace("-","+").replace("_","/");return JSON.parse(atob(base64))},service.GetJwt=function(){return $rootScope.globals?$rootScope.globals.token:null},service.IsAuthed=function(){var token=service.GetJwt();if(token){if(!$rootScope.globals.user.setExpiration)return!0;var params=service.ParseJwt(token);return Math.round((new Date).getTime()/1e3)<=params.exp?!0:(service.ClearCredentials(),!1)}return!1},service.IsAnonymous=function(){var deferred=$q.defer();return null==service.GetJwt()?deferred.resolve(service.OK):deferred.reject(service.FORBIDDEN),deferred.promise},service.IsAuthenticated=function(){var deferred=$q.defer();return service.IsAuthed()?deferred.resolve(service.OK):deferred.reject(service.UNAUTHORIZED),deferred.promise},service.IsMyRecipe=function(slug){var deferred=$q.defer();return $http({method:"HEAD",url:service.apiUrl+"/recipes/"+slug+"/mine",timeout:deferred.promise}).then(function(){deferred.resolve(service.OK)},function(){deferred.reject(service.UNAUTHORIZED)}),deferred.promise},service}]);var categoryService=angular.module("CategoryServices",["ngResource"]);categoryService.factory("CategoryService",["$http","$rootScope","envService","$q",function($http,$rootScope,envService,$q){var service={apiUrl:envService.read("apiUrl")};return service.all=function(callbackOk,callbackError){$http.get(service.apiUrl+"/categories",{headers:{Accept:"application/json","Content-Type":"application/json"}}).then(function(response){callbackOk(response)},function(response){callbackError(response)})},service}]);var ingredientService=angular.module("IngredientServices",["ngResource"]);ingredientService.factory("IngredientService",["$http","$rootScope","envService","$q",function($http,$rootScope,envService,$q){var service={apiUrl:envService.read("apiUrl")};return service.add=function(id,ingredient,callbackOk,callbackError){return $http.post(service.apiUrl+"/recipes/"+id+"/ingredient",ingredient,{headers:{Accept:"application/json","Content-Type":"application/json"}}).then(function(response){return callbackOk(response)},function(response){return callbackError(response)})},service["delete"]=function(id,ingredientId,callbackOk,callbackError){return $http["delete"](service.apiUrl+"/recipes/"+id+"/ingredient/"+ingredientId,{headers:{Accept:"application/json","Content-Type":"application/json"}}).then(function(response){return callbackOk(response);
},function(response){return callbackError(response)})},service}]);var recipeService=angular.module("RecipeServices",["ngResource"]);recipeService.factory("RecipeService",["$http","$rootScope","envService","$q",function($http,$rootScope,envService,$q){var service={apiUrl:envService.read("apiUrl"),regexMainImage:/^main\..+$/,charmap:{" ":" ","¡":"!","¢":"c","£":"lb","¥":"yen","¦":"|","§":"SS","¨":'"',"©":"(c)","ª":"a","«":"<<","¬":"not","­":"-","®":"(R)","°":"^0","±":"+/-","²":"^2","û":"^u","ü":'"u',"ð":"d","³":"^3","´":"'","µ":"u","¶":"P","·":".","¸":",","¹":"^1","º":"o","»":">>","¼":" 1/4 ","½":" 1/2 ","¾":" 3/4 ","¿":"?","À":"`A","Á":"'A","Â":"^A","Ã":"~A","â":"^a","á":"'a","Ä":'"A',"Å":"A","Æ":"AE","Ç":"C","È":"`E","É":"'E","Ê":"^E","Ë":'"E',"Ì":"`I","Í":"'I","Î":"^I","Ï":'"I',"Ð":"D","Ñ":"~N","Ò":"`O","Ó":"'O","í":"'i","î":"^i","ï":'"i',"à":"`a","Ô":"^O","Õ":"~O","Ö":'"O',"×":"x","Ø":"O","Ù":"`U","Ú":"'U","Û":"^U","Ü":'"U',"Ý":"'Y","ã":"~a","ä":'"a',"å":"a","æ":"ae","ç":"c","è":"`e","é":"'e","ê":"^e","ë":'"e',"ì":"`i","ñ":"~n","ò":"`o","ó":"'o","ô":"^o","õ":"~o","ö":'"o',"÷":":","ø":"o","ù":"`u","ú":"'u","þ":"th","ÿ":'"y',"Ā":"A","ā":"a","Ă":"A","ă":"a","Ą":"A","ą":"a","Ć":"'C","ć":"'c","Ċ":"C","ċ":"c","Č":"C","č":"c","Ď":"D","ď":"d","Đ":"D","đ":"d","Ē":"E","ē":"e","ĕ":"e","Ė":"E","ė":"e","Ę":"E","ę":"e","Ě":"E","ě":"e","Ĝ":"^G","ĝ":"^g","Ğ":"G","Ġ":"G","ġ":"g","Ģ":"G","ģ":"g","Ĥ":"^H","ĥ":"^h","Ħ":"H","ħ":"h","Ĩ":"~I","ß":"ss","ĩ":"~i","Ī":"I","ī":"i","Ĭ":"I","ĭ":"i","Į":"I","į":"i","İ":"I","ı":"i","Ĳ":"IJ","ĳ":"ij","Ĵ":"^J","ĵ":"^j","Ķ":"K","ķ":"k","Ĺ":"L","ĺ":"l","Ļ":"L","ļ":"l","Ľ":"L","ŀ":"l","Ł":"L","ł":"l","Ń":"'N","ń":"'n","Ņ":"N","ņ":"n","Ň":"N","ň":"n","ŉ":"'n","ō":"o","Ŏ":"O","ŏ":"o","Ő":'"O',"ő":'"o',"Œ":"OE","œ":"oe","Ŕ":"'R","ŕ":"'r","Ŗ":"R","ŗ":"r","Ŷ":"^Y","Ō":"O","ľ":"l","Ŀ":"L","ğ":"g","Ĕ":"E","Ĉ":"^C","ĉ":"^c","ý":"'y","Ř":"R","ř":"r","Ś":"'S","ś":"'s","Ŝ":"^S","ŝ":"^s","Ş":"S","ş":"s","Š":"S","š":"s","Ţ":"T","ţ":"t","Ť":"T","ť":"t","Ŧ":"T","ŧ":"t","Ũ":"~U","ũ":"~u","Ū":"U","ū":"u","Ŭ":"U","ŭ":"u","Ů":"U","ů":"u","Ű":'"U',"ű":'"u',"Ų":"U","ų":"u","Ŵ":"^W","ŵ":"^w","ŷ":"^y","Ÿ":'"Y',"Ź":"'Z","ź":"'z","Ż":"Z","ż":"z","Ž":"Z","ž":"z","ſ":"s","Þ":"Th"}};return service.search=function(pagination,callbackOk,callbackError){$http.get(service.apiUrl+"/recipes",{headers:{Accept:"application/json","Content-Type":"application/json"},params:pagination}).then(function(response){callbackOk(response)},function(response){callbackError(response)})},service.get=function(slug,callbackOk,callbackError){$http.get(service.apiUrl+"/recipes/"+slug,{headers:{Accept:"application/json","Content-Type":"application/json"}}).then(function(response){callbackOk(response)},function(response){callbackError(response)})},service.getImages=function(recipe){for(var mainImage=recipe.media.filter(function(obj){return null!==service.regexMainImage.exec(obj.filename)})[0],main=mainImage?{id:mainImage.id,title:mainImage.filename,href:service.apiUrl+"/media/"+recipe.id+"/"+mainImage.filename}:{href:"http://lorempixel.com/g/480/480/food/Placeholder"},gallery=[],i=0;i<recipe.media.length;i++){var image=recipe.media[i],filename=image.filename.substr(0,image.filename.lastIndexOf("."));image!==mainImage&&gallery.push({id:image.id,title:filename,href:service.apiUrl+"/media/"+recipe.id+"/"+image.filename})}return{main:main,gallery:gallery}},service.getSlug=function(s){if(!s)return"";for(var ch,cp,ascii=[],i=0;i<s.length;i++)(cp=s.charCodeAt(i))<384&&(ch=String.fromCharCode(cp),ascii.push(service.charmap[ch]||ch));return s=ascii.join(""),s=s.replace(/[^\w\s-]/g,"").trim().toLowerCase(),s.replace(/[-\s]+/g,"-")},service.checkSlug=function(slug){var deferredAbort=$q.defer(),request=$http({method:"HEAD",url:service.apiUrl+"/recipes/"+slug+"/check",timeout:deferredAbort.promise}),promise=request.then(function(response){return response},function(response){return response});return promise.abort=function(){deferredAbort.resolve()},promise["finally"](function(){promise.abort=angular.noop,deferredAbort=request=promise=null}),promise},service.checkSlugWithId=function(slug,id){var deferredAbort=$q.defer(),request=$http({method:"HEAD",url:service.apiUrl+"/recipes/"+slug+"/check/"+id,timeout:deferredAbort.promise}),promise=request.then(function(response){return response},function(response){return response});return promise.abort=function(){deferredAbort.resolve()},promise["finally"](function(){promise.abort=angular.noop,deferredAbort=request=promise=null}),promise},service.getNewTags=function(array){var a=[];for(var el in array)array[el].type&&a.push(array[el].type);return a},service.create=function(recipe,callbackOk,callbackError){$http.post(service.apiUrl+"/recipes",recipe,{headers:{Accept:"application/json","Content-Type":"application/json"}}).then(function(response){callbackOk(response)},function(response){callbackError(response)})},service.edit=function(recipe,callbackOk,callbackError){$http.put(service.apiUrl+"/recipes/"+recipe.id,recipe,{headers:{Accept:"application/json","Content-Type":"application/json"}}).then(function(response){callbackOk(response)},function(response){callbackError(response)})},service.uploadFile=function(file,id,isMain,isMultiple,callbackOk,callbackError){var fd=new FormData;if(file instanceof Array)for(var i=0;i<file.length;i++)fd.append("file",file[i]);else fd.append("file",file);fd.append("is_main",isMain),fd.append("is_multiple",isMultiple),$http.post(service.apiUrl+"/media/"+id,fd,{transformRequest:angular.identity,headers:{"Content-Type":void 0}}).then(function(response){callbackOk(response)},function(response){callbackError(response)})},service.deleteFile=function(id,callbackOk,callbackError){$http["delete"](service.apiUrl+"/media/"+id,{headers:{Accept:"application/json","Content-Type":"application/json"}}).then(function(response){callbackOk(response)},function(response){callbackError(response)})},service["delete"]=function(id,callbackOk,callbackError){$http["delete"](service.apiUrl+"/recipes/"+id,{headers:{Accept:"application/json","Content-Type":"application/json"}}).then(function(response){callbackOk(response)},function(response){callbackError(response)})},service}]);var tagService=angular.module("TagServices",["ngResource"]);tagService.factory("TagService",["$http","$rootScope","envService","$q",function($http,$rootScope,envService,$q){var service={apiUrl:envService.read("apiUrl")};return service.all=function(search,callbackOk,callbackError){return $http.get(service.apiUrl+"/tags",{headers:{Accept:"application/json","Content-Type":"application/json"},params:{search:search}}).then(function(response){return callbackOk(response)},function(response){return callbackError(response)})},service}]);