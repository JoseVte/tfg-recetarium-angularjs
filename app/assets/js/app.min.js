'use strict';

var recetarium = angular.module('recetariumApp', [
    'ngRoute',
    'ngMaterial',
    'ui.router',
    'HomeController',
    'AuthServices',
    'AuthController',
]);

// Routes
recetarium.config(['$routeProvider', '$locationProvider', function($routeProvider, $locationProvider) {
    //$locationProvider.hashPrefix(); // Removes index.html in URL
    $routeProvider
        .when('/', { templateUrl: 'views/home.html', controller: ''})
        .when('/login', { templateUrl: 'views/auth/login.html', controller: 'Login' })
        .otherwise({ redirectTo: '/' });
}]);

recetarium.config(['$httpProvider', function($httpProvider) {
        $httpProvider.defaults.useXDomain = true;
        delete $httpProvider.defaults.headers.common['X-Requested-With'];
    }
]);

var authController = angular.module('AuthController', []);

authController.controller('Login',
    ['$scope', '$rootScope', '$location', 'AuthService',
    function ($scope, $rootScope, $location, AuthService) {
        $scope.login = function () {
            $scope.dataLoading = true;
            AuthService.Login($scope.email, $scope.password, function (response) {
                console.log(response);
                $location.path('/');
            }, function (response) {
                console.error(response);
                $scope.dataLoading = false;
            });
        };
    }]
);

var homeController = angular.module('HomeController', []);

homeController.controller('Home',
    ['$scope', '$rootScope', '$location',
    function ($scope, $rootScope, $location) {}
]);

var authServices = angular.module('AuthServices', ['ngResource']);

authServices.factory('AuthService',
    ['$http', '$rootScope', '$timeout',
    function ($http, $rootScope, $timeout) {
        var service = {};

        service.Login = function (email, password, callbackOk, callbackError) {
            $http.post(
                'http://localhost:9000/auth/login',
                { email: email, password: password },
                { headers: {'Accept': 'application/json', 'Content-Type': 'application/json'} }
            ).then(function (response) {
                callbackOk(response);
            }, function (response) {
                callbackError(response);
            });
        };

        return service;
    }]
);
